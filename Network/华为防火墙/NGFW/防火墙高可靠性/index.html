<!-- build time:Wed Dec 27 2023 18:05:50 GMT+0800 (Central Standard Time) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="余星酒" href="http://example.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="余星酒" href="http://example.com/atom.xml"><link rel="alternate" type="application/json" title="余星酒" href="http://example.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="网络设备,华为防火墙"><link rel="canonical" href="http://example.com/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/"><title>防火墙高可靠性 - 基础 - 华为防火墙 - 网络 | 余星酒 = 余星酒 = 痴看年少风雨疾，一转本生蹉跎游</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">防火墙高可靠性</h1><div class="meta"><span class="item" title="创建时间：2023-07-28 17:43:00"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2023-07-28T17:43:00+08:00">2023-07-28</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">余星酒</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giclg5ms2rj20zk0m8u0x.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipey84bjtj20zk0m8hdt.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gicm0n457cj20zk0m8e81.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giclga70tsj20zk0m84mr.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipeu7txpzj20zk0m81kx.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gipetlbztpj20zk0m84qp.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Network/" itemprop="item" rel="index" title="分类于 网络"><span itemprop="name">网络</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/" itemprop="item" rel="index" title="分类于 华为防火墙"><span itemprop="name">华为防火墙</span></a><meta itemprop="position" content="2"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/%E5%9F%BA%E7%A1%80/" itemprop="item" rel="index" title="分类于 基础"><span itemprop="name">基础</span></a><meta itemprop="position" content="3"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://example.com/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="余星酒"><meta itemprop="description" content="痴看年少风雨疾，一转本生蹉跎游, 欢迎参观我的笔记空间 ~ 这里主要会记录一些安全相关的学习笔记 🌸"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="余星酒"></span><div class="body md" itemprop="articleBody"><p>如何保证网络的不间断传输成为网络发展过程中急需解决的一个问题，防火墙部署在企业网络出口处，内外网之间的业务都会通过防火墙转发，&lt;font color=&quot;#ff0000&quot;&gt; 如果防火墙出现故障，便会导致内外网之间的业务全部中断，提高防火墙高可靠性是保证网络稳定的必要条件 &lt;/font&gt;</p><h1 id="ip-link"><a class="anchor" href="#ip-link">#</a> IP-Link</h1><ul><li>IP-Link =&gt; &lt;font color=&quot;#ff0000&quot;&gt; IP 链路探测 &lt;/font&gt;</li></ul><p>IP-Link 是指 FW 通过 &lt;font color=&quot;#ff0000&quot;&gt; 向指定的目的 IP 周期性（5 秒）发送探测报文并等待应答 &lt;/font&gt;，来判断链路是否发生故障，&lt;font color=&quot;#ff0000&quot;&gt; 而且 IP-Link 只需要一端配置即可 &lt;/font&gt;</p><ol><li>FW 发送探测报文后，&lt;font color=&quot;#ff0000&quot;&gt; 在三个探测周期（默认为 15 秒）内未收到响应报文，则认为当前链路发生故障 &lt;/font&gt;，IP-Link 状态变为 Down，随后 FW 会进行 IP-Link Down 相关的后续操作（路由切换、双机热备主备切换等）</li><li>当链路从故障中恢复，FW 能连续收到 3 个响应报文，则认为链路故障消除，IP-Link 变为 Up（即 IP-Link 不会立即变为 Up，而是等三个探测周期 - 15 秒才会变为 Up）</li></ol><p><strong>作用</strong></p><p>IP-Link 主要用于业务链路正常与否的自动侦测，可以检测到与 FW 不直接相连的链路状态，保证业务持续通畅</p><h2 id="ip-link-探测模式"><a class="anchor" href="#ip-link-探测模式">#</a> IP-Link 探测模式</h2><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230224160450.png"></p><p><strong>1. ICMP 模式</strong></p><p>防火墙向需要探测的 IP 地址周期性 &lt;font color=&quot;#ff0000&quot;&gt; 发送 ping 报文 &lt;/font&gt;，检测是否能够连续收到对端的回应报文，ICMP 探测方式可以同于探测非直连的链路</p><p><strong>2. ARP 模式</strong></p><p>防火墙向需要探测的 IP 地址周期性 &lt;font color=&quot;#ff0000&quot;&gt; 发送 arp 报文 &lt;/font&gt;，检查是否能连续收到对端的 arp 应答报文，ARP 探测方式只支持探测直连链路（或中间经过二层设备转发）</p><h2 id="与静态路由联动"><a class="anchor" href="#与静态路由联动">#</a> 与静态路由联动</h2><p>当 IP-link 自动侦测发现链路故障时，FW 会对自身的静态路由进行相应的调整，保证每次用到的链路是最高优先级和链路可达的，以保持业务的持续流通</p><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230224160220.png"></p><h1 id="bfd"><a class="anchor" href="#bfd">#</a> BFD</h1><p>双向转发检测 BFD 用于快速检测系统之间的通信故障，并在出现故障时通知上层协议（联动），但是 BFD 需要设备双方都配置 BFD 才行</p><h2 id="检测模式"><a class="anchor" href="#检测模式">#</a> 检测模式</h2><p><strong>异步模式</strong></p><p>系统之间会按照协商好的周期发送 BFD 控制报文，如果某个系统在检测时间内没有收到对端发来的 BFD 控制报文，就宣告 BFD 会话状态为 Down<br><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230224183000.png"></p><h2 id="bfd-会话"><a class="anchor" href="#bfd-会话">#</a> BFD 会话</h2><h3 id="会话建立"><a class="anchor" href="#会话建立">#</a> 会话建立</h3><p>BFD 通过控制报文中的 My Discriminator（本地标识符）和 Your Discriminator（远端标识符）区分不同的会话</p><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230224183650.png"></p><h3 id="会话状态"><a class="anchor" href="#会话状态">#</a> 会话状态</h3><p>BFD 会话有四种状态 ：Down、Init、Up、AdminDown</p><ol><li>Down ：会话处于 Down 状态或刚刚创建</li><li>Init ：已经能够与对端系统通信，本端希望使会话进入 Up 状态</li><li>Up ：会话已经建立成功</li><li>AdminDown ：会话处于管理性的 Down 状态</li></ol><p>发送方在发送 BFD 控制报文时会在 Sta 字段填入本地当前的会话状态，在接收方根据收到的 BFD 控制报文的 Sta 字段以及本端当前会话状态来进行状态机的迁移</p><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230224184353.png"></p><h2 id="bfd-与-ip-link-区别"><a class="anchor" href="#bfd-与-ip-link-区别">#</a> BFD 与 IP-Link 区别</h2><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230224184607.png"></p><h1 id="vrrp"><a class="anchor" href="#vrrp">#</a> VRRP</h1><p>局域网中的用户终端通常采用配置一个默认网关的形式访问外部网络，如果默认网关设备发生故障，那么所有用户终端访问外部网络的流量将会中断，可以通过部署多个网关的方式来解决单点故障，但是需要解决多个网关之间的冲突问题</p><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230224215552.png"></p><p>&lt;font color=&quot;#ff0000&quot;&gt;VRRP - 虚拟路由器冗余协议 &lt;/font&gt;，既能实现网关的备份，又能解决多个网关之间互相冲突的问题，从而提高网络的可靠性</p><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230224222052.png"></p><h2 id="基本概念"><a class="anchor" href="#基本概念">#</a> 基本概念</h2><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230224221938.png"></p><ol><li>VRRP 路由器<br>运行 VRRP 协议的路由器，如 R1 和 R2，VRRP 是配置在路由器网关接口上的，而且也是基于接口来工作的</li><li>VRID<br>一个 VRRP 组（VRRP Group）由多台协同工作的路由器（的接口）组成，使用相同的 VRID（虚拟路由器标识符）进行标识，属于同一个 VRRP 组的路由器之间交互 VRRP 协议报文并产生一台虚拟的路由器（一个 VRRP 组中只能出现一台 Master 路由器负责转发客户端的数据报文）</li><li>虚拟路由器<br>VRRP 为每一个组抽象出一台虚拟路由器，该路由器并非真实存在的物理设备，而是由 VRRP 虚拟出来的逻辑设备，一个 VRRP 组只会产生一台虚拟路由器</li><li>虚拟 IP 地址及虚拟 MAC 地址<br>虚拟路由器拥有自己的 IP 地址以及 MAC 地址，其中 IP 地址由网络管理员在配置 VRRP 时指定，一台虚拟路由器可以有一个或多个 IP 地址，通常情况下用户使用该地址作为网关地址，而虚拟 MAC 地址的格式是 &quot;0000-5e00-01xx&quot;，其中 xx 为 VRID</li><li>Master 路由器<br>在一个 VRRP 组中承担报文转发任务，在每一个 VRRP 组中，&lt;font color=&quot;#ff0000&quot;&gt; 只有 Master 路由器才会响应针对虚拟 IP 地址的 ARP Request，Master 路由器会以一定的时间间隔周期性地发送 VRRP 报文 &lt;/font&gt;，并通知同一个 VRRP 组中的 Backup 路由器关于自己的存活情况</li><li>Backup 路由器<br>也称为备份路由器，Backup 路由器将会实时侦听 Master 路由器发送出来的 VRRP 报文，它随时准备接替 Master 路由器的工作</li><li>Priority<br>优先级值时选举 Master 路由器和 Backup 路由器的一句，优先级取值范围 0~255（默认 100）值越大越优先，值相等则比较接口 IP 地址大小，越大越优先</li><li>定时器<br>ADVER_INTERVAL 定时器 (通告定时器) ：Master 发送 VRRP 通告报文时间周期，缺省值为 1 秒<br>MASTER_DOWN 定时器：Backup 设备监听该定时器 (Master 设备) 超时后，会变为 Master 状态<br>MASTER_DOWN = （3*ADVER_INTERVAL）+ Skew_time（偏移时间），其中 Skew_Time = (256-Priority)/256</li></ol><h2 id="vrrp-状态机"><a class="anchor" href="#vrrp-状态机">#</a> VRRP 状态机</h2><p>VRRP 协议状态机有三种状态 ：Initialize（初始状态）、Master（活动状态）、Backup（备份状态）</p><p><strong>Initialize</strong> ： 设备初始化或故障的时候<br><strong>Master</strong> ：承担虚拟路由器的功能，数据最终从该设备转发<br><strong>Backup</strong> ：监听 Master 设备</p><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230224231445.png"><br><strong>Master 状态</strong></p><ol><li>定期（ADVER_INTERVAL）发送 VRRP 报文</li><li>以虚拟 MAC 地址响应对虚拟 IP 地址的 ARP 请求</li><li>转发目的 MAC 地址为虚拟 MAC 地址的 IP 报文</li><li>默认允许 ping 通虚拟 IP 地址</li><li>当多条设备同时为 Master 时，若设备收到与自己优先级相同的报文时，会进一步比较 IP 地址大小，越大越优先</li></ol><p><strong>Backup 状态</strong></p><ol start="6"><li>接收 Master 设备发送的 VRRP 报文，判断 Master 设备的状态是否正常</li><li>对虚拟 IP 地址的 ARP 请求不做响应</li><li>丢弃目的 MAC 地址为虚拟 MAC 地址的 IP 报文</li><li>丢弃目的 IP 地址为虚拟 IP 地址的 IP 报文</li><li>如果收到优先级和自己相同时比较 IP（大的为 Master），若比自己优先级大（依然是 Backup），或者 MASTER_DOWN 定时器超时时变为 Master</li></ol><h2 id="主备选举"><a class="anchor" href="#主备选举">#</a> 主备选举</h2><h3 id="优先级不同时"><a class="anchor" href="#优先级不同时">#</a> 优先级不同时</h3><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230225093931.png"></p><ol><li>R1 的接口 VRRP 优先级为 200，R2 的接口优先级为 100，两台设备完成初始化后首先切换至</li><li>R1 与 R2 根据各自 MASTER_DOWN 定时器超时时间由 Backup 切换到 Master 状态，这里 R1 比 R2 更快切换至 Master 状态</li><li>R1 和 R2 通过互相发送 VRRP 报文进行 Master 选举，优先级更高的选举为 Master 设备，R1 变成 Master 路由器</li><li>R1 被选举成为 Master 路由器后，立即发送免费 ARP 报文将虚拟 MAC 地址告诉与它连接的设备的和主机</li></ol><h3 id="优先级相同时"><a class="anchor" href="#优先级相同时">#</a> 优先级相同时</h3><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230225094538.png"></p><ol><li>R1 与 R2 的接口 VRRP 优先级都是 200，两台设备完成初始化后首先切换至 Backup 状态</li><li>由于优先级相同，R1 与 R2 的 MASTER_DOWN 定时器超时后，同时由 Backup 状态切换至 Master 状态</li><li>R1 与 R2 交换 VRRP 报文，优先级一样，通过比较接口 IP 地址选举 Master 路由器，R2 比 R1 大，这里 R2 为 Master 路由器</li><li>R2 被选举 Master 路由器后，立即发送免费 ARP 报文将虚拟 MAC 地址通告与它连接的设备和主机</li></ol><h3 id="接口-ip-和虚拟-ip-一致"><a class="anchor" href="#接口-ip-和虚拟-ip-一致">#</a> 接口 IP 和虚拟 IP 一致</h3><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230225094908.png"></p><p>当路由器接口被置为 VRRP 的 IP 地址拥有者时（接口 IP 与 Virtual IP 相同）路由器无需等待任何定时器超时，可以直接切换至 Master 状态</p><ol><li>R1 与 R2 接口 VRRP 优先级都为默认（100），但是 R1 接口 IP 与 Virtual IP 相同</li><li>R1 直接切换至 Master，成为 Master 路由器</li></ol><h2 id="主备切换时间"><a class="anchor" href="#主备切换时间">#</a> 主备切换时间</h2><h3 id="master-主动退出"><a class="anchor" href="#master-主动退出">#</a> Master 主动退出</h3><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230225095743.png"></p><ol><li>Master 主动退出时会发送一个 VRRP 报文（包含优先级 = 0）</li><li>Backup 收到后，经过 Skew_time 时间，转变为 Master</li></ol><h3 id="master-设备链路故障"><a class="anchor" href="#master-设备链路故障">#</a> Master 设备 / 链路故障</h3><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230225095932.png"></p><ol><li>Master 发生故障，无法发送 VRRP 报文</li><li>Backup 若是在（3*ADVER_INTERVAL）+ Skew_time 时间内，没收到 VRRP 报文就会变为 Master</li></ol><h2 id="主备回切"><a class="anchor" href="#主备回切">#</a> 主备回切</h2><ol><li>正常情况下 Master 设备负责转发用户报文</li><li>当 Master 出现故障时，网络会重新进行 VRRP 主备选举，此时 Backup 变为 Master</li><li>当原先 Master 设备故障恢复后，网络重新进行 VRRP 主备选举，重新变为 Master，但是这个 &lt;font color=&quot;#ff0000&quot;&gt; 前提是抢占模式是开启的 &lt;/font&gt;</li></ol><h3 id="抢占模式"><a class="anchor" href="#抢占模式">#</a> 抢占模式</h3><ol><li>抢占模式（默认激活） ：如果 Backup 路由器激活了抢占功能，那么当它发现 Master 路由器的优先级比自己更低时，将立即切换至 Master 状态，成为新的 Master 路由器</li><li>非抢占模式 ：如果 Backup 路由器没有激活该功能，那么即使发现 Master 路由器的优先级比自己更低，也只能保持 Backup 状态，直到 Master 路由器失效（故障）</li></ol><h2 id="负载分担"><a class="anchor" href="#负载分担">#</a> 负载分担</h2><p>通过创建多个虚拟路由器，每个物理路由器在不同的 VRRP 组中扮演不同的角色（在 VRID 1 中是 Master，在 VRID 2 中是 Backup），不同的虚拟路由器的 Vitual IP 作为不同的内网网关地址可以实现流量转发负载分担</p><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230225101120.png"></p><h1 id="双机热备"><a class="anchor" href="#双机热备">#</a> 双机热备</h1><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230304103252.png"></p><p>传统的组网方式，内部用户和外部用户的交互报文全部通过 FireWall，如果 FireWall 出现故障，内部网络中所有以 FireWall 作为默认网关的主机与外部网络之间的通讯将中断，通讯可靠性无法保证</p><p>可以使用前面的 VRRP 来为防火墙上多个区域提供双机备份功能，但是在此基础上还需要在每一台防火墙上配置多个 VRRP 备份组</p><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230226153547.png"><br>&lt;font color=&quot;#ff0000&quot;&gt; 但是传统的 VRRP 方式无法实现主、备用防火墙状态的一致性 &lt;/font&gt;<br><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230226153714.png"><br>PC1 和 Server 正常通过 Master 去访问公网，公网传输也是通过 Master 去传输数据，但是当数据经过 Master 时是正常的，数据返回时 Master 突然发生异常，出现了故障，那么此时的 Master 变为了 Backup，流量是经过 Master 传输的，但是另一台防火墙上并不存在 Session 会话，导致数据无法正常回传给 PC 和 Server</p><h2 id="vgmp"><a class="anchor" href="#vgmp">#</a> VGMP</h2><p>为了保证所有 VRRP 备份组切换的一致性，在 VRRP 的基础上进行了扩展，推出了 VGMP 来弥补此局限，统一管理所有的 VRRP<br><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230226154131.png"></p><h3 id="vgmp-介绍"><a class="anchor" href="#vgmp-介绍">#</a> VGMP 介绍</h3><p>VGMP 是将同一台防火墙上的多个 VRRP 备份组都加入到一个 VRRP 管理组，&lt;font color=&quot;#ff0000&quot;&gt; 由管理组统一管理所有的 VRRP 备份组 &lt;/font&gt;，通过 &lt; font color=&quot;#ff0000&quot;&gt; 统一控制各 VRRP 备份组状态的切换 &lt;/font&gt;，&lt;font color=&quot;#ff0000&quot;&gt; 来保证管理组内的所有 VRRP 备份组状态一致 &lt;/font&gt;</p><p>每台防火墙上有两个 VGMP 组，分别是 Active 和 Standby ，每个组又有 4 种状态，&lt;font color=&quot;#ff0000&quot;&gt;initialize、load-balance、active、standby&lt;/font&gt;，VGMP 组优先级决定了 VGMP 组的状态</p><h3 id="vgmp-优先级"><a class="anchor" href="#vgmp-优先级">#</a> VGMP 优先级</h3><p><strong>VGMP 初始化优先级和 CPU 个数有关</strong></p><table><thead><tr><th>类型</th><th>型号</th><th>初始优先级</th></tr></thead><tbody><tr><td>单 CPU 机型</td><td>除 USG6635E/6640E-K/6655E、USG6680E 和 USG6712E/6716E 外</td><td>45000</td></tr><tr><td>双 CPU 机型</td><td>USG6635E/6640E-K/6655E、USG6680E 和 USG6712E/6716E</td><td>45002</td></tr></tbody></table><p><strong>VGMP 组和 VRRP 的优先级是不可配置的</strong> =&gt; 最终是通过 VGMP 优先级（45000/45002）来决定谁主谁备</p><p>VRRP 的状态不由自己决定，由 VGMP 状态决定，实际上，FW 的 VRRP 优先级时不可配置的，FW 启动双机热备后，VRRP 优先级固定为 120，设备正常启动后，会根据设备的硬件配置自动生成一个 VGMP 组优先级（初始化优先级）</p><p>VGMP 组有 4 中状态 ：<strong>initialize、load-balance、active、standby</strong></p><ol><li>设备自身的 VGMP 组优先级 &lt;font color=&quot;#ff0000&quot;&gt; 等于 &lt;/font &gt; 对端设备的 VGMP 组优先级时，设备的 VGMP 组状态为 &lt; font color=&quot;#ff0000&quot;&gt;load-balance&lt;/font&gt;，而 &lt; font color=&quot;#ff0000&quot;&gt;load-balance 的备份组状态由管理员的配置决定 &lt;/font&gt;</li><li>设备自身的 VGMP 组优先级 &lt;font color=&quot;#ff0000&quot;&gt; 大于 &lt;/font &gt; 对端设备的 VGMP 组优先级时，设备的 VGMP 组状态为 &lt; font color=&quot;#ff0000&quot;&gt;active&lt;/font&gt;，而 &lt; font color=&quot;#ff0000&quot;&gt;active 的备份组状态都是 Master&lt;/font&gt;</li><li>设备自身的 VGMP 组优先级 &lt;font color=&quot;#ff0000&quot;&gt; 小于 &lt;/font &gt; 对端设备的 VGMP 组优先级时，设备的 VGMP 组状态为 standby，而 &lt; font color=&quot;#ff0000&quot;&gt;standby 的备份组状态都是 Backup&lt;/font&gt;</li><li>设备没有接收到对端设备的 VGMP 报文，无法了解到对端 VGMP 组优先级时，设备的 VGMP 组状态为 active（线故障）</li></ol><h3 id="vgmp-基本原理"><a class="anchor" href="#vgmp-基本原理">#</a> VGMP 基本原理</h3><p>状态为 active 的 VGMP 也会定期向对端发送 HELLO 报文（就是 VGMP 报文，1 秒 1 次，5 秒未收到就是故障）通知 Standby 端本身的运行状态（包括优先级、VRRP 成员状态等）</p><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230226160333.png"></p><h3 id="故障监控与切换"><a class="anchor" href="#故障监控与切换">#</a> 故障监控与切换</h3><p>故障切换是指双机热备组网中的一台 FW 发生故障，另一台设备接替故障 FW 处理业务，FW 通过设定不同的触发条件，对不同的故障事件进行监控，当故障发生时，能及时触发故障切换，保证业务不中断</p><p><strong>条件</strong></p><ol><li>心跳丢失</li></ol><p>FW 通过监控对端的心跳报文来判定对端设备是否存活，是否要进行故障切换，双击热备组网中的两台 FW 会通过心跳线互相发送心跳报文，心跳保温的发送周期默认为 1000ms，如果 FW 连续五个心跳周期没有收到对端的心跳报文，就会判断对端设备发生故障并触发故障切换（有可能心跳线故障、心跳接口故障、对端设备故障等）</p><ol start="2"><li>VGMP 组状态变化</li></ol><p>FW 通过心跳线接收对端设备的 VGMP 报文，了解对端设备的 VGMP 组优先级，并通过比较本端和丢单 VGMP 组优先级大小来确定是否要进行故障切换，当 DW 的接口或链路（联动 IP-Link/BFD）发生故障时，VGMP 组优先级会降低（减 2）如果低于对端设备优先级，本端的 VGMP 组状态会切换为 standby，同时 FW 向对端发送一个 VGMP 报文，通知对端进行故障切换</p><h3 id="故障行为"><a class="anchor" href="#故障行为">#</a> 故障行为</h3><ol><li>整机故障</li></ol><p>未故障设备会等待 5 个心跳周期后，VGMP 组状态切换为 active</p><ol start="2"><li>心跳线故障</li></ol><p>故障设备和未故障设备会等待 5 个心跳周期后，VGMP 组状态切换为 active</p><ol start="3"><li>VGMP 组监控的接口故障</li></ol><p>故障设备的 VGMP 组优先级降低，VGMP 组装填切换为 standby，发送 VGMP 报文通知对端进行故障切换，未故障设备收到对端设备通知故障切换的 VGMP 报文后，VGMP 组状态切换为 active</p><ol start="4"><li>VGMP 组监控的链路故障</li></ol><p>故障设备的 VGMP 组优先级降低，VGMP 组装填切换为 standby，发送 VGMP 报文通知对端进行故障切换，未故障设备收到对端设备通知故障切换的 VGMP 报文后，VGMP 组状态切换为 active</p><h3 id="vgmp-总结"><a class="anchor" href="#vgmp-总结">#</a> VGMP 总结</h3><ol><li>在 VGMP 中，Active 端发送 HELLO 报文（也叫 VGMP 报文，包含优先级、VRRP 成员状态等）Standby 端收到 HELLO 报文后，回应一个 ACK 消息（这个消息中也会携带本身的优先级、VRRP 成员状态等）</li><li>VGMP HELLO 报文发送周期缺省为 1 秒，当 Standby 端 5 个周期没有收到对端的 HELLO 报文时，会认为对端出现故障，从而将自己切换到 Active 状态（通过心跳线发送）</li><li>心跳线上还会发送心跳报文，1 秒一个，5 秒故障</li><li>故障会导致 VGMP 优先级降低</li></ol><p>&lt;font color=&quot;#ff0000&quot;&gt; 在双机热备组网中，当防火墙出现故障时，所有流量都将切换到备防火墙上，因为 USG 防火墙是状态防火墙，如果备防火墙上没有原来主防火墙上的会话表等连接状态数据，则切换到备防火墙的流量将无法通过防火墙，造成现有的连接终端，此时用户必须重新发起连接才行 &lt;/font&gt;</p><h2 id="hrp"><a class="anchor" href="#hrp">#</a> HRP</h2><p>HRP 协议用来实现防火墙双机之间动态状态数据（session）和关键配置命令的备份<br>HRP 模块提供了基础的数据备份机制和传输功能，各个应用模块收集本模块需要备份的数据，提交给 HRP 模块，HRP 模块负责将数据发送到对端防火墙的对应模块</p><p>备份内容 ：要备份的连接状态数据包括 TCP/UDP 会话表、ServerMap 表项、丰台黑名单、NO-PAT 表项、ARP 表项等<br>备份方向 ：防火墙上有状态为主（active）的 VGMP 管理组，向对端（standby）备份<br>备份通道 ：一般情况下，在两台设备上直连的端口作为备份通道，又是也称为心跳线（VGMP 的 HELLO 报文也通过该通道进行通信）</p><h3 id="心跳口"><a class="anchor" href="#心跳口">#</a> 心跳口</h3><p>HRP 心跳口共有五种状态</p><ol><li>Invalid（配置错误）</li><li>Down（本端物理 / 协议层 down）</li><li>Peerdown（对端 down）</li><li>Ready（准备称为 running）</li><li>Running（正常）</li></ol><h3 id="心跳线"><a class="anchor" href="#心跳线">#</a> 心跳线</h3><p>两台 FW 之间备份的数据是通过心跳口发送和接收的，是通过心跳链路（备份通道）传输的</p><ol><li>心跳接口必须是状态独立且具有 IP 地址的接口（三层接口、VLANIF）可以是一个物理接口，也可以是为了增加带宽，由多个物理口捆绑成的一个逻辑接口 Eth-Trunk</li><li>通常情况下备份数据流量约为业务流量的 20%~30%（不建议带宽地域峰值业务流量的 30%）</li></ol><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230226200207.png"></p><h3 id="心跳线总结"><a class="anchor" href="#心跳线总结">#</a> 心跳线总结</h3><p><strong>传递信息</strong></p><ol><li>心跳报文（HELLO 报文）：两台 FW 通过定期（默认周期为 1 秒）互相发送心跳报文检测对端设备是否存活</li><li>VGMP 报文 ：了解对端设备的 VGMP 组的状态，确定本端和对端设备当前状态是否稳定，是否要进行故障切换</li><li>配置和表项备份报文 ：用于两台 FW 同步配置命令和状态信息</li><li>心跳链路探测报文 ：用于检测对端设备的心跳口能否正常接收本端设备的报文，确定是否有心跳口可以使用</li><li>配置一致性检查报文 ：用于检测两台 FW 的关键配置是否一致（ANT、安全策略等）</li></ol><p>这些报文均不受 FW 的安全策略控制，因此不需要针对这些报文配置安全策略</p><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230226201752.png"><br><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230226201813.png"></p><h2 id="备份方式"><a class="anchor" href="#备份方式">#</a> 备份方式</h2><h3 id="自动备份"><a class="anchor" href="#自动备份">#</a> 自动备份</h3><p>自动备份默认开启，能够自动实时备份配置命令和周期性地备份状态信息，适用于各种双机热备组网，启动该功能后，主用设备会周期性地将备份的状态信息备份到备用设备上（建立一段时间后才会备份到备用设备，一般 10 秒左右）</p><p>不会备份如下会话</p><ol><li>到防火墙自身的会话（管理员登录防火墙时产生的会话，像 web 界面配置）</li><li>未完成 3 次握手的 TCP 半连接会话</li><li>只为 UDP 首包创建，而不被后续包匹配的会话</li></ol><h3 id="会话快速备份"><a class="anchor" href="#会话快速备份">#</a> 会话快速备份</h3><p>使用于负载分担的工作方式，以应对报文来回路径不一致的场景，启用会话快速备份功能后，主用设备会实时地将可以备份的会话（向自动备份不支持的会话）都同步到备用设备商，即在主用设备会话建立的时候立即将其实时备份到备用设备（无延时）</p><h3 id="手工批量备份"><a class="anchor" href="#手工批量备份">#</a> 手工批量备份</h3><p>手工批量备份需要管理员手工触发，适用于主设备之间配置不同步，需要手工同步的场景，执行手工批量备份命令后，主用设备会立即同步一次可以备份的状态信息到备用信息，而不必等到自动备份周期到来</p><h3 id="设备重启后主备-fw-配置的自动同步"><a class="anchor" href="#设备重启后主备-fw-配置的自动同步">#</a> 设备重启后主备 FW 配置的自动同步</h3><p>双机热备中，如果一台 FW 重启，重启期间业务都由另一台 FW 承载，在此期间，承载业务的 FW 上可能会新增、删除后修改配置，为了保证主备 FW 配置一致，在 FW 重启完成后，会自动从当前承载业务的 FW 上进行一次配置同步，仅会同步支持备份的配置（NAT、安全策略等），不支持像 OSPF、BGP 等，在配置同步期间，FW 上无法执行支持备份的配置命令</p><h2 id="link-group"><a class="anchor" href="#link-group">#</a> Link-Group</h2><p><strong>原理</strong></p><ol><li>将多个物理接口的状态互相绑定，组成一个逻辑组</li><li>如果组内任意接口出现故障，系统将组内其它接口状态设置为 Down</li><li>当组内所有接口恢复正常后，整个组内的接口状态才重新被设置为 Up</li></ol><p><strong>添加接口到组内</strong></p><p>进入接口内，输入 &lt;font color=&quot;#ff0000&quot;&gt;link-gourp ID 号 &lt;/font&gt;</p><p><strong>查看接口状态</strong></p><p>&lt;font color=&quot;#ff0000&quot;&gt;display link-group ID 号 &lt;/font&gt;</p><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230304113947.png"></p><ol><li>up : 接口处于 up 状态</li><li>fault : 接口因组内有其他的故障接口而强制变成 fault 状态</li><li>not available : 接口板不在位时，接口处于 not available 状态</li><li>Invalid : 接口索引错误时，处于 invalid 状态</li><li>wait-up : 接口正由 down 转为 up 的中间状态</li></ol><p>在双机热备中，只需要一个防火墙配置 Link-Group 即可</p><h2 id="eth-trunk"><a class="anchor" href="#eth-trunk">#</a> Eth-Trunk</h2><p>两台防火墙组成双机热备，要求能有冗余备份保证数据同步的可靠性</p><p>参考<strong>链路聚合</strong></p><h2 id="基本组网"><a class="anchor" href="#基本组网">#</a> 基本组网</h2><ol><li>主备模式</li><li>负载分担</li></ol><p>上下型业务接口工作在三层模式，连接二层设备时，需要在上下型的业务接口上配置 VRRP 备份组，使 VGMP 管理组能够通过 VRRP 备份组检测三层业务接口</p><p>双机热备组网常见的是防火墙采用路由模式，下行交换机双线上联到防火墙，正常情况下防火墙 A 为主，防火墙 A 上行或下行链路 down 掉后，防火墙 B 自动切换为主设备</p><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230226211259.png"></p><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230304110925.png"></p><ol><li>防火墙工作在三层模式，是指防火墙的各业务接口为三层接口需要配置 IP 地址</li><li>防火墙工作在二层模式，是指防火墙工作为透明模式，除 HRP 心跳口外，其余接口均不配置 IP 地址（备墙 vlan 处于禁用状态）</li></ol><h3 id="防火墙接口三层-接交换机"><a class="anchor" href="#防火墙接口三层-接交换机">#</a> 防火墙接口三层 - 接交换机</h3><p>FW 接口工作在三层，上下行连接交换机的组网中，配置 VRRP，通过 VRRP 直接监控机接口，如果接口故障，VRRP 状态变为初始化，然后上报 VGMP，VGMP 优先级 -2</p><h3 id="防火墙接口三层-接路由器"><a class="anchor" href="#防火墙接口三层-接路由器">#</a> 防火墙接口三层 - 接路由器</h3><p>FW 上下行连接路由器的组网中，由于路由器无法穿透 VRRP 组播报文，无法通过配置 VRRP 备份组的方式将接口加入 VGMP 管理组进行监控，此时需要配置 &lt;font color=&quot;#ff0000&quot;&gt;hrp track interface 接口号 &lt;/font&gt; 来试下 VGMP 组对接口状态的监控</p><ol><li>VGMP 组监控的接口发生故障时，本端 VGMP 组的优先级会降低（一个接口故障，优先级降低 2）</li><li>缺省情况下，没有设定 VGMP 组监控接口的功能缺省情况下，没有设定 VGMP 组监控接口的功能</li><li>VGMP 组不能监控子接口，对于监控的三层 GE 接口、二层 GE 接口、POS 接口、三层 Eth-Trunk 接口、二层 Eth-Trunk 接口、IP-Trunk 接口没有规格限制，设备上有多少接口都可以监控</li></ol><p><strong>主备如何选举</strong></p><p>因为 FW 接口没有配置 VRRP，而是直接通过检测接口状态，所以当优先级一样的情况下需要管理员手动指定状态</p><p>&lt;font color=&quot;#ff0000&quot;&gt;hrp standby-device&lt;/font&gt; 手动指定防火墙为备墙</p><p><strong>故障如何检测</strong></p><p>VGMP 直接检测，故障 - 2</p><p><strong>故障如何切换</strong></p><p>主墙优先级地域备墙，备墙切换为 active</p><p><strong>流量如何引导</strong></p><p>通过修改路由器的开销（备墙将路由器 cost 修改为 65500）</p><p>&lt;font color=&quot;#ff0000&quot;&gt;hrp adjust enable&lt;/font&gt; 启动根据主备状态调整 ospf、ospfv3 或 BGP 相关的 cost 值状态（默认开始）</p><h3 id="防火墙接口二层"><a class="anchor" href="#防火墙接口二层">#</a> 防火墙接口二层</h3><p>当 FW 的上下行业务接口工作在二层模式时，由于二层接口无法配置 IP 地址，因此无法在二层业务接口上配置 VRRP 备份组，这样就无法通过配置 VRRP 备份组的方式将接口加入到 VGMP 管理组，此时只能将上下行业务接口加入到同一 VLAN，通过 &lt;font color=&quot;#ff0000&quot;&gt;hrp track vlan vlan 号 &lt;/font&gt; 由 VGMP 管理组奸恶 VLAN 并监测二层业务接口状态</p><ol><li>配置 hrp trck vlan id 后，vlan 中每个接口故障，VGMP 管理组优先级降低 2</li><li>备用设备上配置 hrp track vlan id 后，该 vlan 就不能转发报文（vlan 禁用）</li></ol><h3 id="配合ip-link"><a class="anchor" href="#配合ip-link">#</a> 配合 Ip-Link</h3><p>当 FW 工作于双机热备场景时，IP-Link 自动侦测后发现链路故障影响主备业务，通过配置 VGMP 管理组绑定 IP-Link，FW 会对 VGMP 管理组的优先级进行调整，触发主备 FW 切换，从而保证业务能够持续流通</p><p>配置 VGMP 管理组监控 IP-Link 后，可以检测到与 FW 不直接相连的接口或链路状态，当位于 untrust 区域链路（接口）发生故障，启用 IP-Link 链路可大检查功能后，系统将会触发主备切换，此时双机热备系统会再根据网络中运行的不同路由协议调整路由，保证业务正常进行</p><p><strong>联动</strong></p><p>FW1 配置</p><pre><code>HRP_M[FW1]ip-link check enable 
HRP_M[FW1]ip-link name dx
HRP_M[FW1-iplink-dx]destination 100.100.100.100 interafce g1/0/3
HRP_M[FW1]hrp track ip-link dx
</code></pre><p>FW2 配置</p><pre><code>HRP_S[FW2]ip-link check enable 
HRP_S[FW2]ip-link name dx
HRP_S[FW2-iplink-dx]destination 100.100.100.100 interafce g1/0/3
HRP_S[FW2]hrp trrack ip-link dx
</code></pre><p><img data-src="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/20230304124948.png"></p><h3 id="搭配bfd"><a class="anchor" href="#搭配bfd">#</a> 搭配 BFD</h3><p>BFD 与双机热备联动就是通过 VGMP 管理组监控静态 BFD 会话，是 VGMP 管理组优先级随着 BFD 会话的状态而变化，从而引起设备的主备状态切换</p><p><strong>联动</strong></p><p>FW1 配置 (主) 前提是已经建立好 BFD</p><pre><code>hrp track bfd-session 10
</code></pre><div class="tags"><a href="/tags/%E7%BD%91%E7%BB%9C%E8%AE%BE%E5%A4%87/" rel="tag"><i class="ic i-tag"></i> 网络设备</a> <a href="/tags/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/" rel="tag"><i class="ic i-tag"></i> 华为防火墙</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2023-12-26 21:30:00" itemprop="dateModified" datetime="2023-12-26T21:30:00+08:00">2023-12-26</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="余星酒 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="余星酒 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="余星酒 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>余星酒 <i class="ic i-at"><em>@</em></i>余星酒</li><li class="link"><strong>本文链接：</strong> <a href="http://example.com/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/" title="防火墙高可靠性">http://example.com/Network/华为防火墙/NGFW/防火墙高可靠性/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclip4jbpj20zk0m87cv.jpg" title="防火墙安全策略"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 基础</span><h3>防火墙安全策略</h3></a></div><div class="item right"><a href="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E6%99%BA%E8%83%BD%E9%80%89%E8%B7%AF/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giciukx8a7j20zk0m8aio.jpg" title="防火墙智能选路"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 基础</span><h3>防火墙智能选路</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#ip-link"><span class="toc-number">1.</span> <span class="toc-text">IP-Link</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ip-link-%E6%8E%A2%E6%B5%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.1.</span> <span class="toc-text">IP-Link 探测模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8E%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E8%81%94%E5%8A%A8"><span class="toc-number">1.2.</span> <span class="toc-text">与静态路由联动</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#bfd"><span class="toc-number">2.</span> <span class="toc-text">BFD</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A3%80%E6%B5%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.1.</span> <span class="toc-text">检测模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bfd-%E4%BC%9A%E8%AF%9D"><span class="toc-number">2.2.</span> <span class="toc-text">BFD 会话</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D%E5%BB%BA%E7%AB%8B"><span class="toc-number">2.2.1.</span> <span class="toc-text">会话建立</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D%E7%8A%B6%E6%80%81"><span class="toc-number">2.2.2.</span> <span class="toc-text">会话状态</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bfd-%E4%B8%8E-ip-link-%E5%8C%BA%E5%88%AB"><span class="toc-number">2.3.</span> <span class="toc-text">BFD 与 IP-Link 区别</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#vrrp"><span class="toc-number">3.</span> <span class="toc-text">VRRP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5"><span class="toc-number">3.1.</span> <span class="toc-text">基本概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vrrp-%E7%8A%B6%E6%80%81%E6%9C%BA"><span class="toc-number">3.2.</span> <span class="toc-text">VRRP 状态机</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E5%A4%87%E9%80%89%E4%B8%BE"><span class="toc-number">3.3.</span> <span class="toc-text">主备选举</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%85%88%E7%BA%A7%E4%B8%8D%E5%90%8C%E6%97%B6"><span class="toc-number">3.3.1.</span> <span class="toc-text">优先级不同时</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%98%E5%85%88%E7%BA%A7%E7%9B%B8%E5%90%8C%E6%97%B6"><span class="toc-number">3.3.2.</span> <span class="toc-text">优先级相同时</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3-ip-%E5%92%8C%E8%99%9A%E6%8B%9F-ip-%E4%B8%80%E8%87%B4"><span class="toc-number">3.3.3.</span> <span class="toc-text">接口 IP 和虚拟 IP 一致</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E5%A4%87%E5%88%87%E6%8D%A2%E6%97%B6%E9%97%B4"><span class="toc-number">3.4.</span> <span class="toc-text">主备切换时间</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#master-%E4%B8%BB%E5%8A%A8%E9%80%80%E5%87%BA"><span class="toc-number">3.4.1.</span> <span class="toc-text">Master 主动退出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#master-%E8%AE%BE%E5%A4%87%E9%93%BE%E8%B7%AF%E6%95%85%E9%9A%9C"><span class="toc-number">3.4.2.</span> <span class="toc-text">Master 设备 &#x2F; 链路故障</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BB%E5%A4%87%E5%9B%9E%E5%88%87"><span class="toc-number">3.5.</span> <span class="toc-text">主备回切</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%A2%E5%8D%A0%E6%A8%A1%E5%BC%8F"><span class="toc-number">3.5.1.</span> <span class="toc-text">抢占模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%B4%9F%E8%BD%BD%E5%88%86%E6%8B%85"><span class="toc-number">3.6.</span> <span class="toc-text">负载分担</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%8C%E6%9C%BA%E7%83%AD%E5%A4%87"><span class="toc-number">4.</span> <span class="toc-text">双机热备</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#vgmp"><span class="toc-number">4.1.</span> <span class="toc-text">VGMP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#vgmp-%E4%BB%8B%E7%BB%8D"><span class="toc-number">4.1.1.</span> <span class="toc-text">VGMP 介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vgmp-%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">4.1.2.</span> <span class="toc-text">VGMP 优先级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vgmp-%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86"><span class="toc-number">4.1.3.</span> <span class="toc-text">VGMP 基本原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%85%E9%9A%9C%E7%9B%91%E6%8E%A7%E4%B8%8E%E5%88%87%E6%8D%A2"><span class="toc-number">4.1.4.</span> <span class="toc-text">故障监控与切换</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%85%E9%9A%9C%E8%A1%8C%E4%B8%BA"><span class="toc-number">4.1.5.</span> <span class="toc-text">故障行为</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#vgmp-%E6%80%BB%E7%BB%93"><span class="toc-number">4.1.6.</span> <span class="toc-text">VGMP 总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#hrp"><span class="toc-number">4.2.</span> <span class="toc-text">HRP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%83%E8%B7%B3%E5%8F%A3"><span class="toc-number">4.2.1.</span> <span class="toc-text">心跳口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%83%E8%B7%B3%E7%BA%BF"><span class="toc-number">4.2.2.</span> <span class="toc-text">心跳线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BF%83%E8%B7%B3%E7%BA%BF%E6%80%BB%E7%BB%93"><span class="toc-number">4.2.3.</span> <span class="toc-text">心跳线总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%87%E4%BB%BD%E6%96%B9%E5%BC%8F"><span class="toc-number">4.3.</span> <span class="toc-text">备份方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E5%A4%87%E4%BB%BD"><span class="toc-number">4.3.1.</span> <span class="toc-text">自动备份</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BC%9A%E8%AF%9D%E5%BF%AB%E9%80%9F%E5%A4%87%E4%BB%BD"><span class="toc-number">4.3.2.</span> <span class="toc-text">会话快速备份</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%8B%E5%B7%A5%E6%89%B9%E9%87%8F%E5%A4%87%E4%BB%BD"><span class="toc-number">4.3.3.</span> <span class="toc-text">手工批量备份</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E5%A4%87%E9%87%8D%E5%90%AF%E5%90%8E%E4%B8%BB%E5%A4%87-fw-%E9%85%8D%E7%BD%AE%E7%9A%84%E8%87%AA%E5%8A%A8%E5%90%8C%E6%AD%A5"><span class="toc-number">4.3.4.</span> <span class="toc-text">设备重启后主备 FW 配置的自动同步</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#link-group"><span class="toc-number">4.4.</span> <span class="toc-text">Link-Group</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#eth-trunk"><span class="toc-number">4.5.</span> <span class="toc-text">Eth-Trunk</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%BB%84%E7%BD%91"><span class="toc-number">4.6.</span> <span class="toc-text">基本组网</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E7%81%AB%E5%A2%99%E6%8E%A5%E5%8F%A3%E4%B8%89%E5%B1%82-%E6%8E%A5%E4%BA%A4%E6%8D%A2%E6%9C%BA"><span class="toc-number">4.6.1.</span> <span class="toc-text">防火墙接口三层 - 接交换机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E7%81%AB%E5%A2%99%E6%8E%A5%E5%8F%A3%E4%B8%89%E5%B1%82-%E6%8E%A5%E8%B7%AF%E7%94%B1%E5%99%A8"><span class="toc-number">4.6.2.</span> <span class="toc-text">防火墙接口三层 - 接路由器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%98%B2%E7%81%AB%E5%A2%99%E6%8E%A5%E5%8F%A3%E4%BA%8C%E5%B1%82"><span class="toc-number">4.6.3.</span> <span class="toc-text">防火墙接口二层</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E5%90%88ip-link"><span class="toc-number">4.6.4.</span> <span class="toc-text">配合 Ip-Link</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%90%AD%E9%85%8Dbfd"><span class="toc-number">4.6.5.</span> <span class="toc-text">搭配 BFD</span></a></li></ol></li></ol></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%89%E5%85%A8%E9%98%B2%E6%8A%A4/" rel="bookmark" title="防火墙安全防护">防火墙安全防护</a></li><li><a href="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/GREVPN/" rel="bookmark" title="GREVPN">GREVPN</a></li><li><a href="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E5%85%A5%E4%BE%B5%E6%A3%80%E6%B5%8B%E4%B8%8E%E9%98%B2%E5%BE%A1/" rel="bookmark" title="入侵检测与防御">入侵检测与防御</a></li><li><a href="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%BF%90%E7%BB%B4/" rel="bookmark" title="网络安全运维">网络安全运维</a></li><li><a href="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E5%8F%8D%E7%97%85%E6%AF%92/" rel="bookmark" title="反病毒">反病毒</a></li><li><a href="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99NAT%E5%8E%9F%E7%90%86/" rel="bookmark" title="防火墙NAT原理">防火墙NAT原理</a></li><li><a href="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E6%99%BA%E8%83%BD%E9%80%89%E8%B7%AF/" rel="bookmark" title="防火墙智能选路">防火墙智能选路</a></li><li class="active"><a href="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E9%AB%98%E5%8F%AF%E9%9D%A0%E6%80%A7/" rel="bookmark" title="防火墙高可靠性">防火墙高可靠性</a></li><li><a href="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5/" rel="bookmark" title="防火墙安全策略">防火墙安全策略</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="余星酒" data-src="/images/avatar.jpg"><p class="name" itemprop="name">余星酒</p><div class="description" itemprop="description">欢迎参观我的笔记空间 ~ 这里主要会记录一些安全相关的学习笔记 🌸</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">190</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">38</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">30</span> <span class="name">标签</span></a></div></nav><div class="social"></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/Network/%E5%8D%8E%E4%B8%BA%E9%98%B2%E7%81%AB%E5%A2%99/NGFW/%E9%98%B2%E7%81%AB%E5%A2%99%E6%99%BA%E8%83%BD%E9%80%89%E8%B7%AF/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Network/" title="分类于 网络">网络</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/" title="分类于 深信服设备">深信服设备</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/%E5%AE%9E%E9%AA%8C/" title="分类于 实验">实验</a></div><span><a href="/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/%E5%AE%9E%E9%AA%8C/AC/AC%E8%AE%A4%E8%AF%81%E6%A8%A1%E5%BC%8F/" title="AC认证模式">AC认证模式</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/System/" title="分类于 操作系统">操作系统</a> <i class="ic i-angle-right"></i> <a href="/categories/System/centos/" title="分类于 centos">centos</a></div><span><a href="/System/centos/Linux%E6%96%87%E4%BB%B6%E4%BC%A0%E8%BE%93%E6%9C%8D%E5%8A%A1/" title="Linux文件传输服务">Linux文件传输服务</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Program/" title="分类于 编程">编程</a> <i class="ic i-angle-right"></i> <a href="/categories/Program/Golang/" title="分类于 Golang">Golang</a> <i class="ic i-angle-right"></i> <a href="/categories/Program/Golang/%E5%B8%B8%E7%94%A8%E5%BA%93/" title="分类于 常用库">常用库</a></div><span><a href="/Program/golang/%E5%B8%B8%E7%94%A8%E5%BA%93/runtime/" title="runetime">runetime</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Network/" title="分类于 网络">网络</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/" title="分类于 深信服设备">深信服设备</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/AC/" title="分类于 AC">AC</a></div><span><a href="/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/%E6%B7%B1%E4%BF%A1%E6%9C%8D/AC/%E7%BB%88%E7%AB%AF%E6%A3%80%E6%9F%A5/" title="终端检查">终端检查</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/APT/" title="分类于 渗透测试">渗透测试</a> <i class="ic i-angle-right"></i> <a href="/categories/APT/%E5%B7%A5%E5%85%B7/" title="分类于 工具">工具</a></div><span><a href="/APT/%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8/Nmap/" title="Nmap">Nmap</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Program/" title="分类于 编程">编程</a> <i class="ic i-angle-right"></i> <a href="/categories/Program/Golang/" title="分类于 Golang">Golang</a> <i class="ic i-angle-right"></i> <a href="/categories/Program/Golang/%E5%9F%BA%E7%A1%80/" title="分类于 基础">基础</a></div><span><a href="/Program/golang/%E5%85%A5%E9%97%A8/%E6%B5%81%E7%A8%8B%E6%8E%A7%E5%88%B6/" title="流程控制">流程控制</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Network/" title="分类于 网络">网络</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/" title="分类于 深信服设备">深信服设备</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/%E5%AE%9E%E9%AA%8C/" title="分类于 实验">实验</a></div><span><a href="/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/%E5%AE%9E%E9%AA%8C/AF/%E5%8B%92%E7%B4%A2%E9%98%B2%E6%8A%A4/" title="勒索防护">勒索防护</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/System/" title="分类于 操作系统">操作系统</a> <i class="ic i-angle-right"></i> <a href="/categories/System/centos/" title="分类于 centos">centos</a></div><span><a href="/System/centos/Linux%E6%97%A5%E5%BF%97/" title="Linux日志">Linux日志</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Program/" title="分类于 编程">编程</a> <i class="ic i-angle-right"></i> <a href="/categories/Program/Golang/" title="分类于 Golang">Golang</a> <i class="ic i-angle-right"></i> <a href="/categories/Program/Golang/%E5%9F%BA%E7%A1%80/" title="分类于 基础">基础</a></div><span><a href="/Program/golang/%E5%85%A5%E9%97%A8/%E5%8C%85%E7%9A%84%E6%93%8D%E4%BD%9C/" title="包的操作">包的操作</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/System/" title="分类于 操作系统">操作系统</a> <i class="ic i-angle-right"></i> <a href="/categories/System/centos/" title="分类于 centos">centos</a></div><span><a href="/System/centos/Linux%E7%BD%91%E7%AB%99%E6%9C%8D%E5%8A%A1/" title="Linux网站服务">Linux网站服务</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">余星酒 @ 余星酒</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"Network/华为防火墙/NGFW/防火墙高可靠性/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->