<!-- build time:Wed Dec 27 2023 18:05:50 GMT+0800 (Central Standard Time) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="ä½™æ˜Ÿé…’" href="http://example.com/rss.xml"><link rel="alternate" type="application/atom+xml" title="ä½™æ˜Ÿé…’" href="http://example.com/atom.xml"><link rel="alternate" type="application/json" title="ä½™æ˜Ÿé…’" href="http://example.com/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="Golang,Golangå…¥é—¨è¿›é˜¶"><link rel="canonical" href="http://example.com/Program/golang/%E8%BF%9B%E9%98%B6/%E5%B9%B6%E5%8F%91/"><title>å¹¶å‘ - è¿›é˜¶ - Golang - ç¼–ç¨‹ | ä½™æ˜Ÿé…’ = ä½™æ˜Ÿé…’ = ç—´çœ‹å¹´å°‘é£é›¨ç–¾ï¼Œä¸€è½¬æœ¬ç”Ÿè¹‰è·æ¸¸</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">å¹¶å‘</h1><div class="meta"><span class="item" title="åˆ›å»ºæ—¶é—´ï¼š2023-01-23 08:56:49"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">å‘è¡¨äº</span> <time itemprop="dateCreated datePublished" datetime="2023-01-23T08:56:49+08:00">2023-01-23</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="åˆ‡æ¢å¯¼èˆªæ "><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">ä½™æ˜Ÿé…’</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giclwuom7cj20zk0m8dvn.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giclip4jbpj20zk0m87cv.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gicm0n457cj20zk0m8e81.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gicit31ffoj20zk0m8naf.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1giclhpw3lwj20zk0m8gvw.jpg"></li><li class="item" data-background-image="https://tva1.sinaimg.cn/large/6833939bly1gicis081o9j20zk0m8dmr.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">é¦–é¡µ</a></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Program/" itemprop="item" rel="index" title="åˆ†ç±»äº ç¼–ç¨‹"><span itemprop="name">ç¼–ç¨‹</span></a><meta itemprop="position" content="1"></span><i class="ic i-angle-right"></i> <span itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Program/Golang/" itemprop="item" rel="index" title="åˆ†ç±»äº Golang"><span itemprop="name">Golang</span></a><meta itemprop="position" content="2"></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/Program/Golang/%E8%BF%9B%E9%98%B6/" itemprop="item" rel="index" title="åˆ†ç±»äº è¿›é˜¶"><span itemprop="name">è¿›é˜¶</span></a><meta itemprop="position" content="3"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://example.com/Program/golang/%E8%BF%9B%E9%98%B6/%E5%B9%B6%E5%8F%91/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="ä½™æ˜Ÿé…’"><meta itemprop="description" content="ç—´çœ‹å¹´å°‘é£é›¨ç–¾ï¼Œä¸€è½¬æœ¬ç”Ÿè¹‰è·æ¸¸, æ¬¢è¿å‚è§‚æˆ‘çš„ç¬”è®°ç©ºé—´ ~ è¿™é‡Œä¸»è¦ä¼šè®°å½•ä¸€äº›å®‰å…¨ç›¸å…³çš„å­¦ä¹ ç¬”è®° ğŸŒ¸"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="ä½™æ˜Ÿé…’"></span><div class="body md" itemprop="articleBody"><h1 id="å¹¶å‘åŸºç¡€"><a class="anchor" href="#å¹¶å‘åŸºç¡€">#</a> å¹¶å‘åŸºç¡€</h1><p>å¹¶å‘å˜æˆå¼€å‘å°†ä¸€ä¸ªè¿‡ç¨‹æŒ‰ç…§å¹¶è¡Œç®—æ³•æ‹†åˆ†æˆå¤šä¸ªå¯ç‹¬ç«‹æ‰§è¡Œä»£ç å—</p><h2 id="é¡ºåº-å¹¶å‘ä¸å¹¶è¡Œ"><a class="anchor" href="#é¡ºåº-å¹¶å‘ä¸å¹¶è¡Œ">#</a> é¡ºåºã€å¹¶å‘ä¸å¹¶è¡Œ</h2><ol><li>é¡ºåºæ˜¯æŒ‡å‘èµ·æ‰§è¡Œçš„ç¨‹åºåªèƒ½æœ‰ä¸€ä¸ª</li><li>å¹¶å‘æ˜¯æŒ‡åŒæ—¶å‘èµ·æ‰§è¡Œï¼ˆåŒæ—¶å¤„ç†ï¼‰çš„ç¨‹åºå¯ä»¥æœ‰å¤šä¸ª</li><li>å¹¶è¡Œæ˜¯æŒ‡åŒæ—¶æ‰§è¡Œï¼ˆåŒæ—¶åšï¼‰çš„ç¨‹åºå¯ä»¥æœ‰å¤šä¸ª</li></ol><h1 id="ä¾‹ç¨‹"><a class="anchor" href="#ä¾‹ç¨‹">#</a> ä¾‹ç¨‹</h1><p>åœ¨ Go è¯­è¨€ä¸­æ¯ä¸ªå¹¶å‘æ‰§è¡Œçš„å•å…ƒå« Goroutineï¼Œä½¿ç”¨ <code>go</code> å…³é”®å­—åæ¥å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ª Goroutine</p><h2 id="ä¾‹ç¨‹çš„åˆ›å»º"><a class="anchor" href="#ä¾‹ç¨‹çš„åˆ›å»º">#</a> ä¾‹ç¨‹çš„åˆ›å»º</h2><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token keyword">func</span> <span class="token function">PrintString</span><span class="token punctuation">(</span>str <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%s => %d\n"</span><span class="token punctuation">,</span> str<span class="token punctuation">,</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token keyword">go</span> demo6<span class="token punctuation">.</span><span class="token function">PrintString</span><span class="token punctuation">(</span><span class="token string">"goroutine"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>	demo6<span class="token punctuation">.</span><span class="token function">PrintString</span><span class="token punctuation">(</span><span class="token string">"main"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="19"></td><td><pre>main => 1</pre></td></tr><tr><td data-num="20"></td><td><pre>main => 2</pre></td></tr><tr><td data-num="21"></td><td><pre>main => 3</pre></td></tr><tr><td data-num="22"></td><td><pre>main => 4</pre></td></tr><tr><td data-num="23"></td><td><pre>main => 5</pre></td></tr><tr><td data-num="24"></td><td><pre>main => 6</pre></td></tr><tr><td data-num="25"></td><td><pre>main => 7</pre></td></tr><tr><td data-num="26"></td><td><pre>main => 8</pre></td></tr><tr><td data-num="27"></td><td><pre>main => 9</pre></td></tr><tr><td data-num="28"></td><td><pre>goroutine => 1</pre></td></tr><tr><td data-num="29"></td><td><pre>*/</pre></td></tr></table></figure><blockquote><p>ä¸ºä»€ä¹ˆä¼šå‡ºç°ä¸Šè¿°æƒ…å†µï¼Œè¿™æ˜¯å› ä¸º <code>main</code> ä¸­æ˜¯ä¸»ä¾‹ç¨‹ï¼Œå½“ä¸»ä¾‹ç¨‹æ‰§è¡Œå®Œæˆåï¼Œå…¶ä»–ä¾‹ç¨‹ä¹Ÿä¼šè‡ªåŠ¨ç»“æŸï¼Œä¸ç®¡æ˜¯å¦æ­£åœ¨æ‰§è¡Œ</p></blockquote><h3 id="é—­åŒ…é™·é˜±"><a class="anchor" href="#é—­åŒ…é™·é˜±">#</a> é—­åŒ…é™·é˜±</h3><p>å› ä¸ºé—­åŒ…ä½¿ç”¨å‡½æ•°å¤–å˜é‡ï¼Œå½“ä¾‹ç¨‹æ‰§è¡Œæ—¶ï¼Œå¤–éƒ¨å˜é‡å·²ç»å‘ç”Ÿå˜åŒ–ï¼Œå¯¼è‡´æ‰“å°çš„å†…å®¹ä¸æ­£ç¡®ï¼Œå¯ä½¿ç”¨åœ¨åˆ›å»ºä¾‹ç¨‹æ—¶é€šè¿‡å‡½æ•°ä¼ é€’å‚æ•°ï¼ˆå€¼æ‹·è´ï¼‰æ–¹å¼é¿å…</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"time"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    </pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>		<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="21"></td><td><pre>10</pre></td></tr><tr><td data-num="22"></td><td><pre>10</pre></td></tr><tr><td data-num="23"></td><td><pre>10</pre></td></tr><tr><td data-num="24"></td><td><pre>10</pre></td></tr><tr><td data-num="25"></td><td><pre>10</pre></td></tr><tr><td data-num="26"></td><td><pre>6</pre></td></tr><tr><td data-num="27"></td><td><pre>10</pre></td></tr><tr><td data-num="28"></td><td><pre>10</pre></td></tr><tr><td data-num="29"></td><td><pre>8</pre></td></tr><tr><td data-num="30"></td><td><pre>10</pre></td></tr><tr><td data-num="31"></td><td><pre>*/</pre></td></tr></table></figure><blockquote><p>ä¸ºä»€ä¹ˆä¼šæ‰“å°å‡º 10ï¼Œè¿™æ˜¯å› ä¸ºä¾‹ç¨‹è¿˜æ²¡æœ‰å¯åŠ¨æ—¶ï¼Œæœ¬è¯¥æ‰“å° 1ï¼Œç»“æœå› ä¸ºå¾ªç¯å˜é‡å˜ä¸º 2ï¼Œå½“å˜é‡ä¸º 10 é€€å‡ºå¾ªç¯æ—¶ï¼Œä¾‹ç¨‹æ°å¥½å¯åŠ¨ï¼Œè¾“å‡º 10</p></blockquote><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"time"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>j <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>		<span class="token punctuation">&#125;</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="21"></td><td><pre>6</pre></td></tr><tr><td data-num="22"></td><td><pre>9</pre></td></tr><tr><td data-num="23"></td><td><pre>7</pre></td></tr><tr><td data-num="24"></td><td><pre>8</pre></td></tr><tr><td data-num="25"></td><td><pre>0</pre></td></tr><tr><td data-num="26"></td><td><pre>2</pre></td></tr><tr><td data-num="27"></td><td><pre>4</pre></td></tr><tr><td data-num="28"></td><td><pre>5</pre></td></tr><tr><td data-num="29"></td><td><pre>1</pre></td></tr><tr><td data-num="30"></td><td><pre>3</pre></td></tr><tr><td data-num="31"></td><td><pre>*/</pre></td></tr></table></figure><h2 id="ç­‰å¾…ä¾‹ç¨‹"><a class="anchor" href="#ç­‰å¾…ä¾‹ç¨‹">#</a> ç­‰å¾…ä¾‹ç¨‹</h2><p>main å‡½æ•°ä¹Ÿæ˜¯ç”±ä¸€ä¸ªä¾‹ç¨‹å¯åŠ¨æ‰§è¡Œï¼Œè¿™ä¸ªä¾‹ç¨‹ç§°ä¸ºä¸»ä¾‹ç¨‹ï¼Œå…¶ä»–çš„ä¾‹ç¨‹ç§°ä¸ºå·¥ä½œä¾‹ç¨‹ï¼Œä¸»ä¾‹ç¨‹ç»“æŸåå·¥ä½œä¾‹ç¨‹ä¹Ÿä¼šéšä¹‹é”€æ¯ï¼Œä½¿ç”¨ sync.WaitGroup æ¥ç»´æŠ¤æ‰§è¡Œä¾‹ç¨‹æ‰§è¡ŒçŠ¶æ€</p><h3 id="waitgroup"><a class="anchor" href="#waitgroup">#</a> WaitGroup</h3><blockquote><p>WaitGroup å®ç°åŒæ­¥</p><p>var wg sync.WaitGroup</p></blockquote><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">Add</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span> <span class="token comment">// æ·»åŠ  n ä¿¡å·</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å¤„ç†å®Œæˆä¸€ä¸ªä¿¡å·</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ç­‰å¾…è®¡æ•°å™¨å½’é›¶ï¼Œå½“æ‰€æœ‰ä¿¡å·å®Œæˆå¤„ç†å°±ç»“æŸ</span></pre></td></tr></table></figure><p>æŸ¥çœ‹æ·»åŠ  WaitGroup å’Œä¸æ·»åŠ  WaitGroup çš„åŒºåˆ«</p><p><strong>æ²¡æœ‰ä½¿ç”¨ WaitGroup</strong></p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">func</span> <span class="token function">send</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"i : %d\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>		<span class="token keyword">go</span> <span class="token function">send</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"end~~~"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre>i <span class="token punctuation">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="2"></td><td><pre>i <span class="token punctuation">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="3"></td><td><pre>end~~~</pre></td></tr></table></figure><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre>i <span class="token punctuation">:</span> <span class="token number">4</span></pre></td></tr><tr><td data-num="2"></td><td><pre>end~~~</pre></td></tr></table></figure><p><strong>ä½¿ç”¨ WaitGroup</strong></p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"sync"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">var</span> wp sync<span class="token punctuation">.</span>WaitGroup</pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">func</span> <span class="token function">send</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token keyword">defer</span> wp<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å®Œæˆä»»åŠ¡å°± - 1</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Send : "</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>		<span class="token keyword">go</span> <span class="token function">send</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>		wp<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// å¼€å¯ä¸€ä¸ªä»»åŠ¡å°± + 1</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	wp<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// ç­‰å¾…æ‰€æœ‰åæˆ</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"end~~~"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre>Send <span class="token punctuation">:</span>  <span class="token number">1</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Send <span class="token punctuation">:</span>  <span class="token number">9</span></pre></td></tr><tr><td data-num="3"></td><td><pre>Send <span class="token punctuation">:</span>  <span class="token number">7</span></pre></td></tr><tr><td data-num="4"></td><td><pre>Send <span class="token punctuation">:</span>  <span class="token number">3</span></pre></td></tr><tr><td data-num="5"></td><td><pre>Send <span class="token punctuation">:</span>  <span class="token number">8</span></pre></td></tr><tr><td data-num="6"></td><td><pre>Send <span class="token punctuation">:</span>  <span class="token number">0</span></pre></td></tr><tr><td data-num="7"></td><td><pre>Send <span class="token punctuation">:</span>  <span class="token number">2</span></pre></td></tr><tr><td data-num="8"></td><td><pre>Send <span class="token punctuation">:</span>  <span class="token number">4</span></pre></td></tr><tr><td data-num="9"></td><td><pre>Send <span class="token punctuation">:</span>  <span class="token number">5</span></pre></td></tr><tr><td data-num="10"></td><td><pre>Send <span class="token punctuation">:</span>  <span class="token number">6</span></pre></td></tr><tr><td data-num="11"></td><td><pre>end~~~</pre></td></tr></table></figure><h3 id="ç®¡é“å®ç°ç­‰å¾…"><a class="anchor" href="#ç®¡é“å®ç°ç­‰å¾…">#</a> ç®¡é“å®ç°ç­‰å¾…</h3><blockquote><p>ç®¡é“å¦‚æœèƒ½è¯»å–åˆ°æ•°æ®ï¼Œè¯´æ˜ä¾‹ç¨‹å·²ç»æ‰§è¡Œå®Œæˆ</p></blockquote><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre>	channel <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>index <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>			<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>				fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%dæ¬¡ => %d\n"</span><span class="token punctuation">,</span> index<span class="token punctuation">,</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>			channel <span class="token operator">&lt;-</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="16"></td><td><pre>		<span class="token punctuation">&#125;</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">2</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		<span class="token operator">&lt;-</span>channel</pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="25"></td><td><pre>1 æ¬¡ => 0</pre></td></tr><tr><td data-num="26"></td><td><pre>1 æ¬¡ => 1</pre></td></tr><tr><td data-num="27"></td><td><pre>1 æ¬¡ => 2</pre></td></tr><tr><td data-num="28"></td><td><pre>1 æ¬¡ => 3</pre></td></tr><tr><td data-num="29"></td><td><pre>0 æ¬¡ => 0</pre></td></tr><tr><td data-num="30"></td><td><pre>0 æ¬¡ => 1</pre></td></tr><tr><td data-num="31"></td><td><pre>0 æ¬¡ => 2</pre></td></tr><tr><td data-num="32"></td><td><pre>0 æ¬¡ => 3</pre></td></tr><tr><td data-num="33"></td><td><pre>*/</pre></td></tr></table></figure><p>è¿™é‡Œåˆ›å»ºäº† 3 ä¸ªä¾‹ç¨‹ï¼Œå…¶ä¸­æ¯ä¸ªä¾‹ç¨‹éƒ½æ´»é€šè¿‡ç®¡é“ä¼ é€’æ•°æ®ï¼Œæ­¤æ—¶åœ¨åˆ›å»º 3 ä¸ªç®¡é“è¯»å–ï¼Œå³å¯å®ç°ç­‰å¾…ä¾‹ç¨‹æ‰§è¡Œå®Œçš„æ•ˆæœ</p><h2 id="ä¾‹ç¨‹é—´é€šä¿¡"><a class="anchor" href="#ä¾‹ç¨‹é—´é€šä¿¡">#</a> ä¾‹ç¨‹é—´é€šä¿¡</h2><p>åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯å…±äº«æ•°æ®ã€åŒæ­¥ã€‘ï¼ˆäº’æ–¥é”ã€åŸå­æ“ä½œï¼‰ï¼Œä¸€ç§æ˜¯é€šé“ã€å¼‚æ­¥ã€‘ï¼ˆchannelï¼‰</p><h3 id="mutextäº’æ–¥é”å®ç°åŒæ­¥"><a class="anchor" href="#mutextäº’æ–¥é”å®ç°åŒæ­¥">#</a> Mutext äº’æ–¥é”å®ç°åŒæ­¥</h3><blockquote><p>var lock sync.Mutex</p><p>å¯ä»¥ä½¿ç”¨ Mutext äº’æ–¥é”çš„æ–¹å¼å®ç°åŒæ­¥</p></blockquote><p><strong>æ¡ˆä¾‹</strong>ï¼šå¤šä¸ªåç¨‹å»è®¿é—®å…±äº«èµ„æº</p><ol><li>ä½¿ç”¨ sync.WaitGroup</li></ol><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"sync"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token string">"time"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">var</span> i <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">100</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup</pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token keyword">func</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	i <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"i++ : "</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Millisecond <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">func</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	i <span class="token operator">-=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"i-- : "</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Millisecond <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>		wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>		<span class="token keyword">go</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>		wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>		<span class="token keyword">go</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"i : "</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><pre><code>i-- :  99
i++ :  101
i-- :  100
i++ :  101
i-- :  100
i :  101 // æœ€ç»ˆç»“æœå¯èƒ½ä¼šå‘ç”Ÿå¼‚å¸¸
</code></pre><ol start="2"><li>ä½¿ç”¨ sync.WaitGroup + sync.Mutex</li></ol><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"sync"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token string">"time"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">var</span> i <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">100</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">var</span> lock sync<span class="token punctuation">.</span>Mutex</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">func</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	lock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	i <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"i++ : "</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Millisecond <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	lock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">func</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	lock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	i <span class="token operator">-=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"i-- : "</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Millisecond <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>	lock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>		wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>		<span class="token keyword">go</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>		wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>		<span class="token keyword">go</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"i : "</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><pre><code>i-- :  100
i++ :  101
i-- :  100
i++ :  101
i-- :  100
i :  100
</code></pre><p>å¦‚æœåœ¨åŠ é”å’Œè§£é”ä¸­é—´çš„ä»£ç å‘ç”Ÿäº†é”™è¯¯ï¼Œå¯¼è‡´æ— æ³•åŠæ—¶è§£é”ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨ <code>defer</code> ï¼Œè¿˜æ˜¯ä¸è¡Œï¼Œå› ä¸º defer æ‰§è¡Œçš„åŸåˆ™æ˜¯å‡½æ•°ç»“æŸåæ‰ä¼šè°ƒç”¨ deferï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨åŒ¿åå‡½æ•°</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"sync"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token string">"time"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">var</span> i <span class="token builtin">int</span> <span class="token operator">=</span> <span class="token number">100</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup</pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">var</span> lock sync<span class="token punctuation">.</span>Mutex</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">func</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>		lock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>		i <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="18"></td><td><pre>		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"i++ : "</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Millisecond <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		<span class="token keyword">defer</span> lock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è¿™æ ·å°±å¯ä»¥åœ¨å‡½æ•°æ‰§è¡Œå®Œæˆåï¼Œè‡ªåŠ¨è°ƒç”¨ defer</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">func</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	<span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>		lock<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>		i <span class="token operator">-=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="29"></td><td><pre>		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"i-- : "</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Millisecond <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>		wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>		<span class="token keyword">defer</span> lock<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>	wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>		<span class="token keyword">go</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre>		<span class="token keyword">go</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"i : "</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="åŸå­æ“ä½œ"><a class="anchor" href="#åŸå­æ“ä½œ">#</a> åŸå­æ“ä½œ</h3><p>åŸºæœ¬çš„åŸå­æ“ä½œ</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"sync/atomic"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token string">"time"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">var</span> num <span class="token builtin">int32</span> <span class="token operator">=</span> <span class="token number">100</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">func</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	atomic<span class="token punctuation">.</span><span class="token function">AddInt32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>num<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">func</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	atomic<span class="token punctuation">.</span><span class="token function">AddInt32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>num<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		<span class="token keyword">go</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		<span class="token keyword">go</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>atomic æä¾›çš„åŸå­æ“ä½œèƒ½å¤Ÿç¡®ä¿ä»»ä¸€æ—¶åˆ»åªæœ‰ goroutine å¯¹å˜é‡è¿›è¡Œæ“ä½œï¼Œå–„ç”¨ atomic èƒ½å¤Ÿé¿å…ç¨‹åºä¸­å‡ºç°å¤§é‡çš„é”æ“ä½œ</p><p>atomic å¸¸è§æ“ä½œæœ‰</p><ol><li>å¢å‡</li><li>è½½å…¥</li><li>æ¯”è¾ƒå¹¶äº¤æ¢ cas</li><li>äº¤æ¢</li><li>å­˜å‚¨</li></ol><h4 id="å¢å‡æ“ä½œ"><a class="anchor" href="#å¢å‡æ“ä½œ">#</a> å¢å‡æ“ä½œ</h4><p>atomic åŒ…ä¸­æä¾›äº†å¦‚ä¸‹ä»¥ Add ä¸ºå‰ç¼€çš„å¢å‡æ“ä½œ</p><blockquote><p>AddInt32()</p><p>AddInt64()</p><p>AddUint32()</p><p>AddUint64()</p><p>AddUintptr()</p></blockquote><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"sync/atomic"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">var</span> num <span class="token builtin">int32</span> <span class="token operator">=</span> <span class="token number">100</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">func</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	atomic<span class="token punctuation">.</span><span class="token function">AddInt32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>num<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"num++ : "</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">func</span> <span class="token function">sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	atomic<span class="token punctuation">.</span><span class="token function">AddInt32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>num<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"num-- : "</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	<span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"num : "</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token function">sub</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"num : "</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="27"></td><td><pre>num++ :  101</pre></td></tr><tr><td data-num="28"></td><td><pre>num :  101</pre></td></tr><tr><td data-num="29"></td><td><pre>num-- :  100</pre></td></tr><tr><td data-num="30"></td><td><pre>num :  100</pre></td></tr><tr><td data-num="31"></td><td><pre>*/</pre></td></tr></table></figure><h4 id="è½½å…¥æ“ä½œ"><a class="anchor" href="#è½½å…¥æ“ä½œ">#</a> è½½å…¥æ“ä½œ</h4><blockquote><p>atomic.LoadInt32()</p><p>atomic.LoadInt64()</p><p>atomic.LoadUint32()</p><p>atomic.LoadUint64()</p><p>atomic.LoadPointer()</p><p>atomic.LoadUpointer()</p></blockquote><blockquote><p>atomic.StoreInt32()</p><p>atomic.StoreInt64()</p><p>atomic.StoreUint32()</p><p>atomic.StoreUint64()</p><p>atomic.StorePointer()</p><p>atomic.storeUintptr()</p></blockquote><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"sync/atomic"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">var</span> atomicLSNum <span class="token builtin">int32</span> <span class="token operator">=</span> <span class="token number">100</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	atomic<span class="token punctuation">.</span><span class="token function">LoadInt32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>atomicLSNum<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"atomicLSNum : "</span><span class="token punctuation">,</span> atomicLSNum<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	atomic<span class="token punctuation">.</span><span class="token function">StoreInt32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>atomicLSNum<span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"atomicLSNum : "</span><span class="token punctuation">,</span> atomicLSNum<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="18"></td><td><pre>atomicLSNum :  100</pre></td></tr><tr><td data-num="19"></td><td><pre>atomicLSNum :  250</pre></td></tr><tr><td data-num="20"></td><td><pre>*/</pre></td></tr></table></figure><h4 id="æ¯”è¾ƒå¹¶äº¤æ¢-cas"><a class="anchor" href="#æ¯”è¾ƒå¹¶äº¤æ¢-cas">#</a> æ¯”è¾ƒå¹¶äº¤æ¢ cas</h4><p>è¯¥æ“ä½œåœ¨è¿›è¡Œäº¤æ¢å‰é¦–å…ˆç¡®ä¿å˜é‡çš„å€¼æœªè¢«æ›´æ”¹ï¼Œå³ä»ç„¶ä¿æŒå‚æ•° old æ‰€è®°å½•çš„å€¼ï¼Œæ»¡è¶³æ­¤å‰æä¸‹æ‰è¿›è¡Œäº¤æ¢æ“ä½œï¼ŒCAS çš„åšæ³•ç±»ä¼¼æ“ä½œæ•°æ®åº“æ—¶å¸¸è§çš„ä¹è§‚é”æœºåˆ¶</p><blockquote><p>atomic.CompareAndSwapInt32()</p><p>atomic.CompareAndSwapInt64()</p><p>atomic.CompareAndSwapUint32()</p><p>atomic.CompareAndSwapUint64()</p><p>atomic.CompareAndSwapPointer()</p></blockquote><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"sync/atomic"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token keyword">var</span> i <span class="token builtin">int64</span> <span class="token operator">=</span> <span class="token number">123</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	ok <span class="token operator">:=</span> atomic<span class="token punctuation">.</span><span class="token function">CompareAndSwapInt64</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>i<span class="token punctuation">,</span> <span class="token number">123</span><span class="token punctuation">,</span> <span class="token number">321</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"bool : "</span><span class="token punctuation">,</span> ok<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"values : "</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="15"></td><td><pre>bool :  true</pre></td></tr><tr><td data-num="16"></td><td><pre>values :  321</pre></td></tr><tr><td data-num="17"></td><td><pre>*/</pre></td></tr></table></figure><h4 id="äº¤æ¢"><a class="anchor" href="#äº¤æ¢">#</a> äº¤æ¢</h4><blockquote><p>atomic.SwapInt32()</p><p>atomic.SwapInt54()</p><p>atomic.SwapUint32()</p><p>atomic.SwapUint64()</p><p>atomic.SwapPointer()</p><p>atomic.SwapUintptr()</p></blockquote><p>ç›¸å¯¹äº CASï¼Œæ˜æ˜¾æ­¤ç±»æ“ä½œæ›´ä¸ºæš´åŠ›ç›´æ¥ï¼Œå¹¶ä¸ç®¡å˜é‡çš„æ—§å€¼æ˜¯å¦è¢«æ”¹å˜ï¼Œç›´æ¥èµ‹äºˆæ–°å€¼ç„¶åè¿”å›è¢«æ›¿æ¢çš„å€¼</p><h4 id="å­˜å‚¨"><a class="anchor" href="#å­˜å‚¨">#</a> å­˜å‚¨</h4><p>ç¡®ä¿äº†å˜é‡çš„åŸå­æ€§ï¼Œé¿å…å…¶ä»–æ“ä½œè¯»åˆ°äº†ä¿®æ”¹å˜é‡è¿‡ç¨‹ä¸­çš„è„æ•°æ®</p><blockquote><p>atomic.StoreInte32()</p><p>atomic.StoreInte64()</p><p>atomic.StoreUinte32()</p><p>atomic.StoreUinte64()</p><p>atomic.StorePointer()</p><p>atomic.StoreUintptr()</p></blockquote><h1 id="channel"><a class="anchor" href="#channel">#</a> channel</h1><ol><li><p>Go æä¾›äº†ä¸€ç§ç§°ä¸ºé€šé“çš„æœºåˆ¶ï¼Œç”¨äºåœ¨ gorountine ä¹‹é—´å…±äº«æ•°æ®ï¼Œå½“ä½œä¸º goroutine æ‰§è¡Œå¹¶å‘æ´»åŠ¨æ—¶ï¼Œéœ€è¦åœ¨ goroutine ä¹‹é—´å…±äº«èµ„æºæˆ–æ•°æ®ï¼Œé€šé“å……å½“ goroutine ä¹‹é—´çš„ç®¡é“å¹¶æä¾›ä¸€ç§æœºåˆ¶æ¥ä¿è¯åŒæ­¥äº¤æ¢</p></li><li><p>éœ€è¦åœ¨å£°æ˜é€šé“æ—¶æŒ‡å®šæ•°æ®ç±»å‹ï¼Œå¯ä»¥å…±äº«å†…ç½®ã€å‘½åã€ç»“æ„å’Œå¼•ç”¨ç±»å‹çš„å€¼å’ŒæŒ‡é’ˆï¼Œæ•°æ®åœ¨é€šé“ä¸Šä¼ é€’ ï¼ˆåœ¨ä»»ä½•ç»™å®šæ—¶é—´åªæœ‰ä¸€ä¸ª goroutine å¯ä»¥è®¿é—®æ•°æ®é¡¹ï¼Œå› æ­¤æŒ‰ç…§è®¾è®¡ä¸ä¼šå‘ç”Ÿæ•°æ®ç«äº‰ï¼‰</p></li><li><p>æ ¹æ®æ•°æ®äº¤æ¢çš„è¡Œä¸ºï¼Œæœ‰ä¸¤ç§ç±»å‹çš„é€šé“ : <code>æ— ç¼“å†²é€šé“</code> å’Œ <code>ç¼“å†²é€šé“</code></p><ol><li>æ— ç¼“å†²é€šé“ç”¨äºæ‰§è¡Œ goroutine ä¹‹é—´çš„åŒæ­¥é€šä¿¡ï¼Œæ— ç¼“å†²é€šé“ä¿è¯åœ¨å‘é€å’Œæ¥æ”¶å‘ç”Ÿçš„ç¬é—´æ‰§è¡Œä¸¤ä¸ª goroutine ä¹‹é—´çš„äº¤æ¢</li><li>ç¼“å†²é€šé“ç”¨äºæ‰§è¡Œå¼‚æ­¥é€šä¿¡ï¼Œç¼“å†²é€šé“æ²¡æœ‰è¿™æ ·çš„ä¿è¯</li></ol></li></ol><h2 id="channelåˆ›å»º"><a class="anchor" href="#channelåˆ›å»º">#</a> channel åˆ›å»º</h2><blockquote><p>ä¸å¸¦ç¼“å†²åŒº</p><p>å†™å…¥æ—¶ï¼Œæ²¡æœ‰å…¶ä»–ä¾‹ç¨‹è¯»ï¼Œä¼šé˜»å¡ï¼Œè¯»å–æ—¶ï¼Œæ²¡æœ‰å…¶ä»–ä¾‹ç¨‹å†™ï¼Œä¼šé˜»å¡</p><p>å¸¦ç¼“å†²åŒº</p><p>å†™å…¥æ—¶ï¼Œç¼“å†²åŒºå·²æ»¡æ—¶ï¼Œæ²¡æœ‰å…¶ä»–ä¾‹ç¨‹è¯»ï¼Œä¼šé˜»å¡ï¼Œè¯»å–æ—¶ï¼Œæ²¡æœ‰æ•°æ®ï¼Œæ²¡æœ‰å…¶ä»–ä¾‹ç¨‹å†™ï¼Œä¼šé˜»å¡</p></blockquote><p>é€šé“ç”± make å‡½æ•°åˆ›å»ºï¼Œè¯¥å‡½æ•°æŒ‡å®š chan å…³é”®å­—å’Œé€šé“å…ƒç´ ç±»å‹</p><h3 id="æ— ç¼“å†²é€šé“"><a class="anchor" href="#æ— ç¼“å†²é€šé“">#</a> æ— ç¼“å†²é€šé“</h3><p>åœ¨æ— ç¼“å†²é€šé“ä¸­ï¼Œåœ¨æ¥æ”¶åˆ°ä»»ä½•å€¼ä¹‹å‰æ²¡æœ‰èƒ½åŠ›ä¿å­˜å®ƒï¼Œåœ¨è¿™ç§ç±»å‹çš„é€šé“ä¸­ï¼Œå‘é€å’Œæ¥æ”¶ goroutine åœ¨ä»»ä½•å‘é€æˆ–æ¥æ”¶æ“ä½œå®Œæˆä¹‹å‰çš„åŒä¸€æ—¶åˆ»éƒ½å‡†å¤‡å°±ä¼‘ï¼Œå¦‚æœä¸¤ä¸ª goroutine æ²¡æœ‰åœ¨åŒä¸€æ—¶åˆ»å‡†å¤‡å¥½ï¼Œåˆ™é€šé“ä¼šè®©æ‰§è¡Œå…¶å„è‡ªå‘é€æˆ–æ¥æ”¶æ“ä½œçš„ goroutine é¦–å…ˆç­‰å¾…ï¼ŒåŒæ­¥æ˜¯é€šé“ä¸Šå‘é€å’Œæ¥æ”¶ä¹‹é—´äº¤äº’çš„åŸºç¡€ï¼Œæ²¡æœ‰å¦ä¸€ä¸ªå°±ä¸å¯èƒ½å‘ç”Ÿ</p><p>åˆ›å»ºä¸€ä¸ªæ— ç¼“å†²é€šé“</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre>Unbuffered <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span></pre></td></tr></table></figure><h3 id="ç¼“å†²é€šé“"><a class="anchor" href="#ç¼“å†²é€šé“">#</a> ç¼“å†²é€šé“</h3><p>åœ¨ç¼“å†²é€šé“ä¸­ï¼Œæœ‰èƒ½åŠ›åœ¨æ¥æ”¶åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªå€¼ä¹‹å‰ä¿å­˜å®ƒä»¬ï¼Œåœ¨è¿™ç§ç±»å‹çš„é€šé“ä¸­ï¼Œä¸å¼ºåˆ¶ goroutine åœ¨åŒä¸€æ—¶åˆ»å‡†å¤‡å¥½æ‰§è¡Œå‘é€å’Œæ¥æ”¶ï¼Œå½“å‘é€æˆ–æ¥æ”¶é˜»å¡æ—¶ä¹Ÿæœ‰ä¸åŒçš„æ¡ä»¶ï¼Œåªæœ‰å½“é€šé“ä¸­æ²¡æœ‰è¦æ¥æ”¶çš„å€¼æ—¶ï¼Œæ¥æ”¶æ‰ä¼šé˜»å¡ï¼Œä»…å½“æ²¡æœ‰å¯ç”¨ç¼“å†²åŒºæ¥é˜²æ­¢æ­£åœ¨å‘é€çš„å€¼æ—¶ï¼Œå‘é€æ‰ä¼šé˜»å¡</p><p>åˆ›å»ºä¸€ä¸ªæœ‰ç¼“å­˜é€šé“</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre>buffered <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr></table></figure><p>ä½¿ç”¨å†…ç½®å‡½æ•° <code>make</code> åˆ›å»ºæ— ç¼“å†²é€šé“ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å…³é”®å­— <code>chan</code> ï¼Œ ç„¶åæ˜¯ <code>é€šé“å…è®¸äº¤æ¢çš„æ•°æ®ç±»å‹</code> ï¼ˆç¬¬ä¸‰ä¸ª <code>æ•°æ®å¤§å°</code> ï¼‰</p><h3 id="è¯»å†™ç®¡é“"><a class="anchor" href="#è¯»å†™ç®¡é“">#</a> è¯»å†™ç®¡é“</h3><p>é€šè¿‡å¦ä¸€ä¸ªç®¡é“å¯¹å…¶è¿›è¡Œèµ‹å€¼</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre>channel  <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token keyword">var</span> readonly <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span>  <span class="token comment">// åªè¯»</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">var</span> writeonly <span class="token keyword">chan</span><span class="token operator">&lt;-</span> <span class="token builtin">int</span> <span class="token comment">// åªå†™</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre>readonly <span class="token operator">=</span> channel</pre></td></tr><tr><td data-num="6"></td><td><pre>writeonly <span class="token operator">=</span> channel</pre></td></tr></table></figure><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre>	channel <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>	channel <span class="token operator">&lt;-</span> <span class="token number">2</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>	w <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>channel <span class="token keyword">chan</span><span class="token operator">&lt;-</span> <span class="token builtin">int</span><span class="token punctuation">,</span> num <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>		channel <span class="token operator">&lt;-</span> num</pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre>	r <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>channel <span class="token operator">&lt;-</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token operator">&lt;-</span>channel<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token function">r</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span> <span class="token comment">// 2</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	<span class="token function">w</span><span class="token punctuation">(</span>channel<span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token function">r</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span> <span class="token comment">// 12</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="channelè¿ç®—ç¬¦"><a class="anchor" href="#channelè¿ç®—ç¬¦">#</a> channel è¿ç®—ç¬¦</h2><ol><li>å°†å€¼å‘é€åˆ°é€šé“çš„ä»£ç å—è¿ç®—ç¬¦ <code>é€šé“å˜é‡ &lt;- å€¼</code></li></ol><pre><code>goroutine1 := make(chan string, 5) // åˆ›å»ºå­—ç¬¦ä¸²ç¼“å­˜é€šé“
goroutine1 &lt;- &quot;Hello&quot; // é€šè¿‡é€šé“å‘é€å­—ç¬¦ä¸²
</code></pre><ol start="2"><li>ä»é€šé“è·å–æ•°æ®çš„è¿ç®—ç¬¦ <code>æ¥æ”¶è€…å˜é‡ &lt;- é€šé“å˜é‡</code></li></ol><pre><code>data := &lt;- goroutine1 // ä»é€šé“è·å–å­—ç¬¦ä¸²
</code></pre><ol start="3"><li>å…³é—­ç®¡é“</li></ol><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">close</span><span class="token punctuation">(</span>goroutinel<span class="token punctuation">)</span></pre></td></tr></table></figure><h2 id="é€šé“çš„å‘é€å’Œæ¥æ”¶ç‰¹æ€§"><a class="anchor" href="#é€šé“çš„å‘é€å’Œæ¥æ”¶ç‰¹æ€§">#</a> é€šé“çš„å‘é€å’Œæ¥æ”¶ç‰¹æ€§</h2><ol><li>å¯¹äºåŒä¸€ä¸ªé€šé“ï¼Œå‘é€æ“ä½œä¹‹é—´æ˜¯äº’æ–¥çš„ï¼Œæ¥æ”¶æ“ä½œä¹‹é—´ä¹Ÿæ˜¯äº’æ–¥çš„</li><li>å‘é€æ“ä½œå’Œæ¥æ”¶æ“ä½œä¸­å¯¹å…ƒç´ å€¼çš„å¤„ç†éƒ½æ˜¯ä¸å¯åˆ†å‰²çš„</li><li>å‘é€æ“ä½œåœ¨å®Œå…¨å®Œæˆä¹‹å‰ä¼šè¢«é˜»å¡ï¼Œæ¥æ”¶æ“ä½œä¹Ÿæ˜¯å¦‚æ­¤</li></ol><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"math/rand"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token string">"time"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">var</span> values <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">func</span> <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	rand<span class="token punctuation">.</span><span class="token function">Seed</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">UnixNano</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	value <span class="token operator">:=</span> rand<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Send : "</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Millisecond <span class="token operator">*</span> <span class="token number">2000</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	values <span class="token operator">&lt;-</span> value</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	<span class="token keyword">go</span> <span class="token function">showMsg</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	value <span class="token operator">:=</span> <span class="token operator">&lt;-</span>values</pre></td></tr><tr><td data-num="22"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"Receive : "</span><span class="token punctuation">,</span> value<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>values<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre>Send <span class="token punctuation">:</span>  <span class="token number">9</span></pre></td></tr><tr><td data-num="2"></td><td><pre>Receive <span class="token punctuation">:</span>  <span class="token number">9</span></pre></td></tr></table></figure><p>ç®¡é“å…³é—­åï¼Œè¯»å–ç®¡é“è¿”å›æ•°æ®ï¼Œä¸åœ¨è¿›è¡Œé˜»å¡</p><p>åœ¨è¯»å–ç®¡é“çš„æ—¶å€™ï¼Œåˆ©ç”¨ç¬¬äºŒä¸ªå‚æ•°æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯å› ä¸ºç®¡é“å…³é—­å¯¼è‡´çš„è¿”å›ï¼Œç®¡é“å…³é—­è¿”å› false</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token boolean">_</span><span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span>channel</pre></td></tr></table></figure><h2 id="channeléå†"><a class="anchor" href="#channeléå†">#</a> channel éå†</h2><h3 id="iffor"><a class="anchor" href="#iffor">#</a> if+for</h3><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="4"></td><td><pre></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>		<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>			c <span class="token operator">&lt;-</span> i</pre></td></tr><tr><td data-num="12"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token keyword">for</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>		value<span class="token punctuation">,</span> ok <span class="token operator">:=</span> <span class="token operator">&lt;-</span>c</pre></td></tr><tr><td data-num="17"></td><td><pre>		<span class="token keyword">if</span> ok <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>		<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>			<span class="token keyword">break</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><pre><code>0
1
2
3
4
5
6
7
8
9
</code></pre><h3 id="range"><a class="anchor" href="#range">#</a> range</h3><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="6"></td><td><pre></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token keyword">var</span> c <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>		<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>			c <span class="token operator">&lt;-</span> i</pre></td></tr><tr><td data-num="14"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token keyword">for</span> value <span class="token operator">:=</span> <span class="token keyword">range</span> c <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><pre><code>0
1
2
3
4
5
6
7
8
9
</code></pre><h1 id="selectswitch"><a class="anchor" href="#selectswitch">#</a> select&amp;switch</h1><ol><li>select æ˜¯ Go ä¸­çš„ä¸€ä¸ªæ§åˆ¶ç»“æ„ï¼Œç±»ä¼¼ Switch è¯­å¥ï¼Œç”¨äºå¤„ç†å¼‚æ­¥ IO æ“ä½œï¼Œselect ä¼šç›‘å¬ case è¯­å¥ä¸­çš„ channel çš„è¯»å†™æ“ä½œï¼Œå½“ case ä¸­ channel è¯»å†™æ“ä½œä¸ºéé˜»å¡çŠ¶æ€ï¼ˆå³èƒ½è¯»å†™ï¼‰æ—¶ï¼Œå°†ä¼šè§¦å‘ç›¸åº”çš„åŠ¨ä½œ</li></ol><blockquote><p>select ä¸­çš„ case è¯­å¥å¿…é¡»æ˜¯ä¸€ä¸ª channel æ“ä½œ</p><p>select ä¸­çš„ default å­å¥æ€»æ˜¯å¯è¿è¡Œçš„</p></blockquote><ol start="2"><li><p>å¦‚æœæœ‰å¤šä¸ª case éƒ½å¯ä»¥è¿è¡Œï¼Œselect ä¼šéšæœºå…¬å¹³åœ°é€‰å‡ºä¸€ä¸ªæ‰§è¡Œï¼Œå…¶ä»–ä¸ä¼šæ‰§è¡Œ</p></li><li><p>å¦‚æœæ²¡æœ‰å¯è¿è¡Œçš„ case è¯­å¥ï¼Œä¸”æœ‰ default è¯­å¥ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œ default çš„åŠ¨ä½œ</p></li><li><p>å¦‚æœæ²¡æœ‰å¯è¿è¡Œçš„ case è¯­å¥ï¼Œä¸”æ²¡æœ‰ default è¯­å¥ï¼Œselect å°†é˜»å¡ï¼Œç›´åˆ°æŸä¸ª case é€šä¿¡å¯ä»¥è¿è¡Œ</p></li></ol><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"runtime"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token string">"time"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">var</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	chanInt    <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	chanString <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">string</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">var</span> num <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>	runtime<span class="token punctuation">.</span><span class="token function">GOMAXPROCS</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// ä½¿ç”¨ 3 æ ¸ CPU</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		chanInt <span class="token operator">&lt;-</span> <span class="token number">123</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		chanString <span class="token operator">&lt;-</span> <span class="token string">"Hello"</span></pre></td></tr><tr><td data-num="22"></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>chanInt<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>		<span class="token function">close</span><span class="token punctuation">(</span>chanString<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	<span class="token keyword">for</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>		<span class="token keyword">select</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>		<span class="token keyword">case</span> r <span class="token operator">:=</span> <span class="token operator">&lt;-</span>chanInt<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="28"></td><td><pre>			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"chanInt : %d\n"</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>		<span class="token keyword">case</span> r <span class="token operator">:=</span> <span class="token operator">&lt;-</span>chanString<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="30"></td><td><pre>			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"chanString : %s\n"</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>			num<span class="token operator">++</span></pre></td></tr><tr><td data-num="32"></td><td><pre>		<span class="token keyword">default</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="33"></td><td><pre>			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"defaultâ€¦â€¦â€¦â€¦"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Millisecond <span class="token operator">*</span> <span class="token number">20</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>		<span class="token keyword">if</span> num <span class="token operator">==</span> <span class="token number">5</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>			<span class="token keyword">break</span></pre></td></tr><tr><td data-num="38"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre></pre></td></tr><tr><td data-num="41"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><pre><code>defaultâ€¦â€¦â€¦â€¦
chanInt : 123
chanString : Hello
chanString : 
chanString : 
chanString : 
chanInt : 0
chanString : 
</code></pre><h1 id="time"><a class="anchor" href="#time">#</a> time</h1><p><code>time.After()</code> å’Œ <code>time.Tick()</code> è¿™ä¸¤ä¸ªå‡½æ•°éƒ½ä¼šè¿”å›ä¸€ä¸ªåªè¯»ç®¡é“ <code>&lt;-chan Time</code></p><h2 id="timeafter"><a class="anchor" href="#timeafter">#</a> time.After()</h2><blockquote><p>é—´éš” n ç§’åç»“æŸ</p></blockquote><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"time"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token operator">&lt;-</span>time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="15"></td><td><pre>2022-12-01 13:48:56.1661171 +0800 CST m=+0.002714901</pre></td></tr><tr><td data-num="16"></td><td><pre>2022-12-01 13:48:58.1781814 +0800 CST m=+2.014779201</pre></td></tr><tr><td data-num="17"></td><td><pre>*/</pre></td></tr></table></figure><p><strong>æ¨¡æ‹Ÿè§„å®šæ—¶é—´å†…åœæ­¢</strong></p><ol><li>ä½¿ç”¨ä¸€ä¸ªä¾‹ç¨‹ç›‘è§†å¦å¤–ä¸€ä¸ª</li></ol><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"math/rand"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token string">"time"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	result <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	timeout <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>		timeout <span class="token operator">&lt;-</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>		r <span class="token operator">:=</span> rand<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> time<span class="token punctuation">.</span><span class="token function">Duration</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>		result <span class="token operator">&lt;-</span> r</pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre></pre></td></tr><tr><td data-num="25"></td><td><pre>	<span class="token keyword">select</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>		<span class="token keyword">case</span> v <span class="token operator">:=</span> <span class="token operator">&lt;-</span>result <span class="token punctuation">:</span></pre></td></tr><tr><td data-num="27"></td><td><pre>			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>		<span class="token keyword">case</span> v<span class="token operator">:=</span> <span class="token operator">&lt;-</span>timeout<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="29"></td><td><pre>			fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å·²ç»è¶…æ—¶ %#v\n"</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ol start="2"><li>ä½¿ç”¨ time.After () å®ç°æ­¤åŠŸèƒ½</li></ol><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"math/rand"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token string">"time"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	result <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>		r <span class="token operator">:=</span> rand<span class="token punctuation">.</span><span class="token function">Intn</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>		time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> time<span class="token punctuation">.</span><span class="token function">Duration</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>		result <span class="token operator">&lt;-</span> r</pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token keyword">select</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	<span class="token keyword">case</span> v <span class="token operator">:=</span> <span class="token operator">&lt;-</span>time<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"å·²ç»è¶…æ—¶ %#v\n"</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token keyword">case</span> v <span class="token operator">:=</span> <span class="token operator">&lt;-</span>result<span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="timetick"><a class="anchor" href="#timetick">#</a> time.Tick()</h2><blockquote><p>å®šæ—¶ n ç§’æ‰§è¡Œ</p></blockquote><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"time"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">func</span> <span class="token function">timeTicker</span><span class="token punctuation">(</span>interval time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token operator">&lt;-</span><span class="token keyword">chan</span> time<span class="token punctuation">.</span>Time <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	channel <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>		<span class="token keyword">for</span> <span class="token punctuation">&#123;</span> <span class="token comment">// å®šæ—¶ interval ç§’åå¾€ç®¡é“å†™å…¥æ•°æ®     </span></pre></td></tr><tr><td data-num="12"></td><td><pre>			time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>			channel <span class="token operator">&lt;-</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	<span class="token keyword">return</span> channel</pre></td></tr><tr><td data-num="17"></td><td><pre></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token keyword">for</span> t <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token function">timeTicker</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// å¾ªç¯è¯»å–è·å–é€šé“ä¸­çš„æ•°æ®</span></pre></td></tr><tr><td data-num="22"></td><td><pre>		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="26"></td><td><pre>2023-09-03 21:25:10.4093187 +0800 CST m=+1.007206901</pre></td></tr><tr><td data-num="27"></td><td><pre>2023-09-03 21:25:11.4185214 +0800 CST m=+2.016409601</pre></td></tr><tr><td data-num="28"></td><td><pre>2023-09-03 21:25:12.4324947 +0800 CST m=+3.030382901</pre></td></tr><tr><td data-num="29"></td><td><pre>2023-09-03 21:25:13.4425494 +0800 CST m=+4.040437601</pre></td></tr><tr><td data-num="30"></td><td><pre>â€¦â€¦â€¦â€¦â€¦â€¦</pre></td></tr><tr><td data-num="31"></td><td><pre>*/</pre></td></tr></table></figure><h2 id="timeticker"><a class="anchor" href="#timeticker">#</a> time.Ticker</h2><p><code>time.Ticker</code> æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œ <code>time.NewTicker()</code> åˆ›å»ºä¸€ä¸ª Tickerï¼Œä¹Ÿæ˜¯æ¯é—´éš” n ç§’æ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœæƒ³è¦éå†å°±å¿…é¡»å¾—æ‹¿åˆ°å…¶å¯¹åº”çš„ç®¡é“ <code>Ticker.C</code> ï¼Œå¦‚æœæƒ³è¦åœ¨æŸä¸€æ—¶åˆ»å…³é—­ï¼Œå¯ä»¥ä½¿ç”¨ <code>Ticker.Stop()</code></p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"time"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	conster <span class="token operator">:=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	timer <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">NewTicker</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// æ¯å»¶è¿Ÿ 1 ç§’æ‰§è¡Œ</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token keyword">for</span> <span class="token boolean">_</span> <span class="token operator">=</span> <span class="token keyword">range</span> timer<span class="token punctuation">.</span>C <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>		<span class="token keyword">if</span> conster <span class="token operator">&lt;=</span> <span class="token number">5</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>conster<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>		<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>			timer<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å…³é—­ Ticker</span></pre></td></tr><tr><td data-num="17"></td><td><pre>			<span class="token keyword">break</span></pre></td></tr><tr><td data-num="18"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>		conster<span class="token operator">++</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="23"></td><td><pre>1</pre></td></tr><tr><td data-num="24"></td><td><pre>2</pre></td></tr><tr><td data-num="25"></td><td><pre>3</pre></td></tr><tr><td data-num="26"></td><td><pre>4</pre></td></tr><tr><td data-num="27"></td><td><pre>5</pre></td></tr><tr><td data-num="28"></td><td><pre>*/</pre></td></tr></table></figure><p>å®ç°ä¸€ä¸ªéšæœºå‘é€æ•°æ®</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"time"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">var</span> values <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	timer <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">NewTicker</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>		<span class="token keyword">for</span> <span class="token boolean">_</span> <span class="token operator">=</span> <span class="token keyword">range</span> timer<span class="token punctuation">.</span>C <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>			<span class="token keyword">select</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>			<span class="token keyword">case</span> values <span class="token operator">&lt;-</span> <span class="token number">1</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="16"></td><td><pre>			<span class="token keyword">case</span> values <span class="token operator">&lt;-</span> <span class="token number">2</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>			<span class="token keyword">case</span> values <span class="token operator">&lt;-</span> <span class="token number">3</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>	num <span class="token operator">:=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token keyword">for</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> values <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"v : "</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>		num <span class="token operator">+=</span> v</pre></td></tr><tr><td data-num="26"></td><td><pre>		<span class="token keyword">if</span> num <span class="token operator">>=</span> <span class="token number">12</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>			<span class="token keyword">break</span></pre></td></tr><tr><td data-num="29"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="33"></td><td><pre>v :  3</pre></td></tr><tr><td data-num="34"></td><td><pre>v :  1</pre></td></tr><tr><td data-num="35"></td><td><pre>v :  2</pre></td></tr><tr><td data-num="36"></td><td><pre>v :  2</pre></td></tr><tr><td data-num="37"></td><td><pre>v :  2</pre></td></tr><tr><td data-num="38"></td><td><pre>v :  2</pre></td></tr><tr><td data-num="39"></td><td><pre>12</pre></td></tr><tr><td data-num="40"></td><td><pre>*/</pre></td></tr></table></figure><h2 id="timetimer"><a class="anchor" href="#timetimer">#</a> time.Timer</h2><p>Timer é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å®šæ—¶å™¨çš„æ„æ€ï¼Œå¯ä»¥å®ç°ä¸€äº›å®šæ—¶æ“ä½œï¼Œå†…éƒ¨ä¹Ÿæ˜¯é€šè¿‡ channel æ¥å®ç°çš„</p><ol><li>ç›´æ¥å»¶æ—¶</li></ol><blockquote><p>ä½¿ç”¨ time.Sleep ()</p></blockquote><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"time"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">2022</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">13</span><span class="token punctuation">:</span><span class="token number">41</span><span class="token punctuation">:</span><span class="token number">20.9241654</span> <span class="token operator">+</span><span class="token number">0800</span> CST m<span class="token operator">=</span><span class="token operator">+</span><span class="token number">0.002567701</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">2022</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">13</span><span class="token punctuation">:</span><span class="token number">41</span><span class="token punctuation">:</span><span class="token number">22.9509834</span> <span class="token operator">+</span><span class="token number">0800</span> CST m<span class="token operator">=</span><span class="token operator">+</span><span class="token number">2.029385701</span></pre></td></tr></table></figure><p><code>&lt;-time.NewTimer().C</code></p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"time"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	timer <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">NewTimer</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token operator">&lt;-</span>timer<span class="token punctuation">.</span>C</pre></td></tr><tr><td data-num="12"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">2022</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">13</span><span class="token punctuation">:</span><span class="token number">45</span><span class="token punctuation">:</span><span class="token number">09.1506624</span> <span class="token operator">+</span><span class="token number">0800</span> CST m<span class="token operator">=</span><span class="token operator">+</span><span class="token number">0.002645601</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">2022</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">13</span><span class="token punctuation">:</span><span class="token number">45</span><span class="token punctuation">:</span><span class="token number">11.1736947</span> <span class="token operator">+</span><span class="token number">0800</span> CST m<span class="token operator">=</span><span class="token operator">+</span><span class="token number">2.025677901</span></pre></td></tr></table></figure><ol start="2"><li>åœæ­¢å®šæ—¶å™¨</li></ol><p>ä¸æ·»åŠ åœæ­¢å®šæ—¶å™¨</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"time"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	timer <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">NewTimer</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>		<span class="token operator">&lt;-</span>timer<span class="token punctuation">.</span>C</pre></td></tr><tr><td data-num="12"></td><td><pre>		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"func end..."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"main end..."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">func</span> end<span class="token operator">...</span></pre></td></tr><tr><td data-num="2"></td><td><pre>main end<span class="token operator">...</span></pre></td></tr></table></figure><p>æ·»åŠ åœæ­¢å®šæ—¶å™¨</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"time"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	timer <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">NewTimer</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>		<span class="token operator">&lt;-</span>timer<span class="token punctuation">.</span>C</pre></td></tr><tr><td data-num="12"></td><td><pre>		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"func end..."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	stop <span class="token operator">:=</span> timer<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	<span class="token keyword">if</span> stop <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"timer stop..."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"main end..."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre>timer stop<span class="token operator">...</span></pre></td></tr><tr><td data-num="2"></td><td><pre>main end<span class="token operator">...</span></pre></td></tr></table></figure><p>é‡æ–°è®¾ç½®å®šæ—¶å™¨</p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"time"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	timer <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">NewTimer</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token comment">// è®¾ç½®å»¶æ—¶ä¸º 5 ç§’</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	timer<span class="token punctuation">.</span><span class="token function">Reset</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span>            <span class="token comment">// é‡æ–°è®¾ç½®å»¶æ—¶ä¸º 3 ç§’</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token operator">&lt;-</span>timer<span class="token punctuation">.</span>C</pre></td></tr><tr><td data-num="13"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">2022</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">13</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">:</span><span class="token number">26.8418402</span> <span class="token operator">+</span><span class="token number">0800</span> CST m<span class="token operator">=</span><span class="token operator">+</span><span class="token number">0.002787201</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">2022</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">01</span> <span class="token number">13</span><span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">:</span><span class="token number">29.863725</span> <span class="token operator">+</span><span class="token number">0800</span> CST m<span class="token operator">=</span><span class="token operator">+</span><span class="token number">3.024672001</span></pre></td></tr></table></figure><h1 id="å¯¹è±¡æ± "><a class="anchor" href="#å¯¹è±¡æ± ">#</a> å¯¹è±¡æ± </h1><h2 id="syncpool"><a class="anchor" href="#syncpool">#</a> sync.Pool</h2><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"strconv"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token string">"sync"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">type</span> proxy <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	index <span class="token builtin">int</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	addr  <span class="token builtin">string</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">func</span> <span class="token function">getAddr</span><span class="token punctuation">(</span>url <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	urls <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	str <span class="token operator">:=</span> <span class="token string">"192.168.1."</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>		urls <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>urls<span class="token punctuation">,</span> str<span class="token operator">+</span>strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	<span class="token keyword">return</span> urls</pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	urls <span class="token operator">:=</span> <span class="token function">getAddr</span><span class="token punctuation">(</span><span class="token string">"http://www.baidu.com"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	i <span class="token operator">:=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	pool <span class="token operator">:=</span> sync<span class="token punctuation">.</span>Pool<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>		New<span class="token punctuation">:</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>			i<span class="token operator">++</span></pre></td></tr><tr><td data-num="29"></td><td><pre>			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">"new : "</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>			<span class="token keyword">return</span> <span class="token operator">&amp;</span>proxy<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>				i<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="32"></td><td><pre>				urls<span class="token punctuation">[</span>i<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="33"></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>		<span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="35"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>	proxy_test <span class="token operator">:=</span> pool<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// è·å–å¯¹è±¡æ± ä¸­çš„å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰ä¼š new ä¸€ä¸ª</span></pre></td></tr><tr><td data-num="37"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>proxy_test<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>	pool<span class="token punctuation">.</span><span class="token function">Put</span><span class="token punctuation">(</span>proxy_test<span class="token punctuation">)</span> <span class="token comment">// å°†è·å–çš„å¯¹è±¡è¿”å›åˆ›å»ºçš„å¯¹è±¡æ± </span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre>	proxy_test <span class="token operator">=</span> pool<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>proxy_test<span class="token punctuation">)</span> <span class="token comment">// å†æ¬¡è·å–å¯¹è±¡æ—¶ï¼Œä¼šå»å¯¹è±¡æ± æ‰¾ï¼Œé‡Œé¢å­˜åœ¨ä¸€ä¸ªåˆšåˆšæ”¾å›å»çš„å°±ä¸ä¼šå† new ä¸€ä¸ª</span></pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre>	proxy_test <span class="token operator">=</span> pool<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// å–å‡ºåå†æ¬¡ Get, æ²¡æœ‰æ‰¾åˆ°å°±ä¼šå†æ¬¡ new</span></pre></td></tr><tr><td data-num="44"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>proxy_test<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token comment">/*</span></pre></td></tr><tr><td data-num="48"></td><td><pre>new :  1</pre></td></tr><tr><td data-num="49"></td><td><pre>&amp;&#123;1 192.168.1.1&#125;</pre></td></tr><tr><td data-num="50"></td><td><pre>&amp;&#123;1 192.168.1.1&#125;</pre></td></tr><tr><td data-num="51"></td><td><pre>new :  2        </pre></td></tr><tr><td data-num="52"></td><td><pre>&amp;&#123;2 192.168.1.2&#125;</pre></td></tr><tr><td data-num="53"></td><td><pre>*/</pre></td></tr></table></figure><h1 id="æ¡ˆä¾‹"><a class="anchor" href="#æ¡ˆä¾‹">#</a> æ¡ˆä¾‹</h1><h2 id="ä½¿ç”¨waitgroupå®ç°ç»Ÿè®¡è¡Œæ•°"><a class="anchor" href="#ä½¿ç”¨waitgroupå®ç°ç»Ÿè®¡è¡Œæ•°">#</a> ä½¿ç”¨ WaitGroup å®ç°ç»Ÿè®¡è¡Œæ•°</h2><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"bufio"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token string">"io/fs"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token string">"os"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token string">"path/filepath"</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token string">"strings"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token string">"sync"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token string">"sync/atomic"</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token keyword">func</span> <span class="token function">readLine</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>	ctx <span class="token operator">:=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre>	scanner <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewScanner</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	<span class="token keyword">for</span> scanner<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>		s <span class="token operator">:=</span> scanner<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>		s <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">TrimSpace</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>		<span class="token keyword">if</span> s <span class="token operator">==</span> <span class="token string">""</span> <span class="token operator">||</span> strings<span class="token punctuation">.</span><span class="token function">HasPrefix</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"//"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// åˆ¤æ–­è¡Œä¸ä¸ºç©ºï¼Œä¸”ä¸åŒ…å« // æ³¨é‡Š</span></pre></td></tr><tr><td data-num="28"></td><td><pre>			<span class="token keyword">continue</span></pre></td></tr><tr><td data-num="29"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>		ctx <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="31"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>	<span class="token keyword">return</span> ctx</pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre>	p<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> filepath<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>	dir <span class="token operator">:=</span> <span class="token string">"."</span></pre></td></tr><tr><td data-num="39"></td><td><pre>	<span class="token keyword">var</span> tools <span class="token builtin">int64</span> <span class="token operator">=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="40"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%T\n"</span><span class="token punctuation">,</span> tools<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>	<span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup</pre></td></tr><tr><td data-num="42"></td><td><pre></pre></td></tr><tr><td data-num="43"></td><td><pre>	filepath<span class="token punctuation">.</span><span class="token function">Walk</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">,</span> info fs<span class="token punctuation">.</span>FileInfo<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>		path <span class="token operator">=</span> filepath<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> path<span class="token punctuation">)</span> <span class="token comment">// æ‹¼æ¥è·¯å¾„</span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre>		<span class="token keyword">if</span> filepath<span class="token punctuation">.</span><span class="token function">Ext</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">".go"</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>info<span class="token punctuation">.</span><span class="token function">IsDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// åˆ¤æ–­æ˜¯å¦ä¸º go æ–‡ä»¶ï¼Œä¸”ä¸æ˜¯ç›®å½•</span></pre></td></tr><tr><td data-num="47"></td><td><pre>			wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// æ·»åŠ ä¿¡å·</span></pre></td></tr><tr><td data-num="48"></td><td><pre>			<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="49"></td><td><pre>				atomic<span class="token punctuation">.</span><span class="token function">AddInt64</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tools<span class="token punctuation">,</span> <span class="token function">int64</span><span class="token punctuation">(</span><span class="token function">readLine</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// åŸå­æ“ä½œï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŠ é”è§£é”æ¥ä¿è¯å‡†ç¡®</span></pre></td></tr><tr><td data-num="50"></td><td><pre>				wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// åˆ é™¤ä¿¡å·</span></pre></td></tr><tr><td data-num="51"></td><td><pre>			<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="52"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">nil</span></pre></td></tr><tr><td data-num="54"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="55"></td><td><pre></pre></td></tr><tr><td data-num="56"></td><td><pre>	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="57"></td><td><pre></pre></td></tr><tr><td data-num="58"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>tools<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="59"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="ä½¿ç”¨ç®¡é“å®ç°ç»Ÿè®¡è¡Œæ•°"><a class="anchor" href="#ä½¿ç”¨ç®¡é“å®ç°ç»Ÿè®¡è¡Œæ•°">#</a> ä½¿ç”¨ç®¡é“å®ç°ç»Ÿè®¡è¡Œæ•°</h2><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"bufio"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token string">"io/fs"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token string">"os"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token string">"path/filepath"</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	<span class="token string">"strings"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	<span class="token string">"sync"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token string">"sync/atomic"</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token comment">// æµ‹è¯•æ³¨é‡Š</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">func</span> <span class="token function">readLine</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>	ctx <span class="token operator">:=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>	scanner <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewScanner</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	<span class="token keyword">for</span> scanner<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>		s <span class="token operator">:=</span> scanner<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>		s <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">TrimSpace</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>		<span class="token keyword">if</span> s <span class="token operator">==</span> <span class="token string">""</span> <span class="token operator">||</span> strings<span class="token punctuation">.</span><span class="token function">HasPrefix</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"//"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>			<span class="token keyword">continue</span></pre></td></tr><tr><td data-num="30"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>		ctx <span class="token operator">+=</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="32"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>	<span class="token keyword">return</span> ctx</pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre></pre></td></tr><tr><td data-num="39"></td><td><pre>	p<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> filepath<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre>	dir <span class="token operator">:=</span> <span class="token string">"."</span></pre></td></tr><tr><td data-num="41"></td><td><pre>	tools <span class="token operator">:=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="42"></td><td><pre>	<span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup</pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"%T\n"</span><span class="token punctuation">,</span> tools<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre>	channel <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="47"></td><td><pre>	exit <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">bool</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre>	filepath<span class="token punctuation">.</span><span class="token function">Walk</span><span class="token punctuation">(</span>dir<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">,</span> info fs<span class="token punctuation">.</span>FileInfo<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>		path <span class="token operator">=</span> filepath<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="51"></td><td><pre></pre></td></tr><tr><td data-num="52"></td><td><pre>		<span class="token keyword">if</span> filepath<span class="token punctuation">.</span><span class="token function">Ext</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">".go"</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>info<span class="token punctuation">.</span><span class="token function">IsDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>			wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="54"></td><td><pre>			<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="55"></td><td><pre>				c <span class="token operator">:=</span> <span class="token function">readLine</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="56"></td><td><pre>				channel <span class="token operator">&lt;-</span> c <span class="token comment">// å°†è¿”å›ç»“æœä¼ é€’åˆ°é€šé“ä¸­</span></pre></td></tr><tr><td data-num="57"></td><td><pre>				wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="58"></td><td><pre>			<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="59"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="60"></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">nil</span></pre></td></tr><tr><td data-num="61"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="62"></td><td><pre></pre></td></tr><tr><td data-num="63"></td><td><pre>	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>		<span class="token keyword">for</span> e <span class="token operator">:=</span> <span class="token keyword">range</span> channel <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="65"></td><td><pre>			tools <span class="token operator">+=</span> e</pre></td></tr><tr><td data-num="66"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>		exit <span class="token operator">&lt;-</span> <span class="token boolean">false</span> <span class="token comment">// é€šè¿‡å°†æ•°æ®ä¼ å…¥ç®¡é“ï¼Œæ¥è¾¾åˆ°æ— æ³•è®©ä¸»ä¾‹ç¨‹ç»“æŸ</span></pre></td></tr><tr><td data-num="68"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="69"></td><td><pre></pre></td></tr><tr><td data-num="70"></td><td><pre>	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="71"></td><td><pre>    <span class="token function">close</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span> <span class="token comment">// åœ¨ wg.Wait () ä¹‹åå…³é—­ channel é€šé“ï¼Œç¡®ä¿åœ¨ filepath.Walk æ‰§è¡Œå®Œæˆåå…³é—­é€šé“</span></pre></td></tr><tr><td data-num="72"></td><td><pre></pre></td></tr><tr><td data-num="73"></td><td><pre>    <span class="token operator">&lt;-</span>exit <span class="token comment">// ç¡®ä¿éä¾‹ç¨‹èƒ½å¤Ÿåœ¨ä¸»ä¾‹ç¨‹ç»“æŸä¹‹å‰å®Œæˆï¼Œ&lt;-exit ä¼šä¸€ç›´å µå¡ï¼Œç›´åˆ°æ²¡æœ‰æ•°æ®å†™å…¥</span></pre></td></tr><tr><td data-num="74"></td><td><pre></pre></td></tr><tr><td data-num="75"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>tools<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="76"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="å®ç°å®šæ—¶å™¨"><a class="anchor" href="#å®ç°å®šæ—¶å™¨">#</a> å®ç°å®šæ—¶å™¨</h2><blockquote><p>å®šæ—¶ 10 ç§’åç»“æŸ</p></blockquote><ul><li>time.After()</li></ul><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"time"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">func</span> <span class="token function">timeAfter</span><span class="token punctuation">(</span>interval time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token operator">&lt;-</span><span class="token keyword">chan</span> time<span class="token punctuation">.</span>Time <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	channel <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>		<span class="token keyword">for</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>			time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>interval<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>			channel <span class="token operator">&lt;-</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token keyword">return</span> channel</pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	endTime <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token keyword">for</span> tAfter <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token function">timeAfter</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>tAfter<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>		<span class="token keyword">if</span> tAfter<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>endTime<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>			<span class="token keyword">break</span> <span class="token comment">// è·³å‡ºå¾ªç¯åï¼Œä¸»ä¾‹ç¨‹å®Œæˆæ‰§è¡Œï¼Œå·¥ä½œä¾‹ç¨‹ç»“æŸ</span></pre></td></tr><tr><td data-num="27"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ul><li>close (channel) ä»…é™å†™é€šé“ï¼Œè¯»é€šé“æ— æ„ä¹‰</li></ul><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>	endTime <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="3"></td><td><pre>	<span class="token keyword">for</span> tAfter <span class="token operator">:=</span> <span class="token keyword">range</span> <span class="token function">timeTicker</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>tAfter<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="5"></td><td><pre>		<span class="token keyword">if</span> tAfter<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>endTime<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token function">close</span><span class="token punctuation">(</span>tAfter<span class="token punctuation">)</span> <span class="token comment">// ä»…é™å†™é€šé“ï¼Œè¯»é€šé“æ— æ„ä¹‰</span></pre></td></tr><tr><td data-num="7"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><ul><li>time.Ticker.Stop()</li></ul><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"time"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	endTime <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">Now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	ticker <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">NewTicker</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>Second <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre>	<span class="token keyword">defer</span> ticker<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	<span class="token keyword">for</span> now <span class="token operator">:=</span> <span class="token keyword">range</span> ticker<span class="token punctuation">.</span>C <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="15"></td><td><pre>		<span class="token keyword">if</span> now<span class="token punctuation">.</span><span class="token function">After</span><span class="token punctuation">(</span>endTime<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>			<span class="token keyword">break</span></pre></td></tr><tr><td data-num="17"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="å¯¹è±¡æ± -2"><a class="anchor" href="#å¯¹è±¡æ± -2">#</a> å¯¹è±¡æ± </h2><blockquote><p>å®šä¹‰ä¸€ä¸ª worker æ± ï¼Œç”±æ± è¿›è¡Œæ‰§è¡Œï¼Œå½“ä»»åŠ¡æ‰§è¡Œå®Œæˆåå¯ä»¥è·å¾—ä»»åŠ¡ç»“æœï¼Œå† worker ä¸­å¯ä»¥å¹¶å‘æ‰§è¡Œä»»åŠ¡ï¼Œå¹¶å‘æ•°é‡å¯ä»¥æŒ‡å®š</p></blockquote><p><code>worker.go</code></p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> pool</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"log"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"math"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token string">"sync"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">type</span> Task <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token comment">// å®šä¹‰ worker æ± </span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">type</span> Pool <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	worker  <span class="token builtin">int</span>              <span class="token comment">// å®šä¹‰å¹¶å‘æ•°é‡</span></pre></td></tr><tr><td data-num="15"></td><td><pre>	tasks   <span class="token operator">*</span>Queue           <span class="token comment">// ä»»åŠ¡é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	events  <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>    <span class="token comment">// ä»»åŠ¡é€šçŸ¥ç®¡é“</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	Results <span class="token keyword">chan</span> <span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// æ•°æ®ç®¡é“</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	wg      sync<span class="token punctuation">.</span>WaitGroup   <span class="token comment">// ç­‰å¾…ç»„</span></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre></pre></td></tr><tr><td data-num="21"></td><td><pre><span class="token comment">// åˆ›å»º worker æ± </span></pre></td></tr><tr><td data-num="22"></td><td><pre></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token keyword">func</span> <span class="token function">NewPool</span><span class="token punctuation">(</span>worker <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">*</span>Pool <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">&amp;</span>Pool<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>		worker<span class="token punctuation">:</span>  worker<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>		tasks<span class="token punctuation">:</span>   <span class="token function">NewQueue</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="27"></td><td><pre>		events<span class="token punctuation">:</span>  <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span>MaxInt32<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="28"></td><td><pre>		Results<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> worker<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="29"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Pool<span class="token punctuation">)</span> <span class="token function">AddTask</span><span class="token punctuation">(</span>task Task<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>	p<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span>      <span class="token comment">// å‘ä»»åŠ¡æ± æ·»åŠ ä»»åŠ¡</span></pre></td></tr><tr><td data-num="34"></td><td><pre>	p<span class="token punctuation">.</span>events <span class="token operator">&lt;-</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// é€šçŸ¥æ‰§è¡Œè¿›ç¨‹</span></pre></td></tr><tr><td data-num="35"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="36"></td><td><pre></pre></td></tr><tr><td data-num="37"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Pool<span class="token punctuation">)</span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> p<span class="token punctuation">.</span>worker<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>		p<span class="token punctuation">.</span>wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="40"></td><td><pre>		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// å¼€å§‹æ‰§è¡Œå¹¶å‘</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre>			<span class="token keyword">for</span> <span class="token keyword">range</span> p<span class="token punctuation">.</span>events <span class="token punctuation">&#123;</span> <span class="token comment">// ç”±äº events æ˜¯ä¸€ä¸ªç©ºç»“æ„ä½“ï¼Œæ‰€ä»¥æ— éœ€ä¼ å…¥å‚æ•°æ¥æ”¶ï¼Œåªéœ€è¦éå†ï¼ˆå¿½ç•¥ä»ç®¡é“ä¸­è¯»å–çš„æ•°æ®ï¼‰</span></pre></td></tr><tr><td data-num="43"></td><td><pre>				task<span class="token punctuation">,</span> err <span class="token operator">:=</span> p<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="44"></td><td><pre>				<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="45"></td><td><pre>					<span class="token keyword">continue</span></pre></td></tr><tr><td data-num="46"></td><td><pre>				<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>				log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"ç¬¬ %d ä¸ªä¾‹ç¨‹æ‰§è¡Œ : "</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="48"></td><td><pre></pre></td></tr><tr><td data-num="49"></td><td><pre>				<span class="token keyword">if</span> e<span class="token punctuation">,</span> ok <span class="token operator">:=</span> task<span class="token punctuation">.</span><span class="token punctuation">(</span>Task<span class="token punctuation">)</span><span class="token punctuation">;</span> ok <span class="token punctuation">&#123;</span> <span class="token comment">// é€šè¿‡æ–­è¨€å°†ç©ºæ¥å£ç±»å‹è½¬ä¸º Task ç±»å‹</span></pre></td></tr><tr><td data-num="50"></td><td><pre></pre></td></tr><tr><td data-num="51"></td><td><pre>					p<span class="token punctuation">.</span>Results <span class="token operator">&lt;-</span> <span class="token function">e</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// æ‰§è¡Œçš„ç»“æœæ”¾å…¥ Results ç®¡é“</span></pre></td></tr><tr><td data-num="52"></td><td><pre>				<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>			p<span class="token punctuation">.</span>wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="55"></td><td><pre>		<span class="token punctuation">&#125;</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="56"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="57"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="58"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Pool<span class="token punctuation">)</span> <span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>events<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="60"></td><td><pre>	p<span class="token punctuation">.</span>wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="61"></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>Results<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="62"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>queue.go</code></p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> pool</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"sync"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">const</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	defaultCap <span class="token operator">=</span> <span class="token number">1024</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="11"></td><td><pre></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token comment">// å®šä¹‰é˜Ÿåˆ—</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token keyword">type</span> Queue <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	elements <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// é˜Ÿåˆ—ä¸­çš„å…ƒç´ </span></pre></td></tr><tr><td data-num="15"></td><td><pre>	locker   sync<span class="token punctuation">.</span>Mutex    <span class="token comment">// å®šä¹‰å¹¶å‘å®‰å…¨é”</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	limit    <span class="token builtin">int</span>           <span class="token comment">// å®šä¹‰é˜Ÿåˆ—ä¸­å…ƒç´ ä¸Šé™</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre><span class="token keyword">func</span> <span class="token function">NewQueue</span><span class="token punctuation">(</span>limit <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">*</span>Queue <span class="token punctuation">&#123;</span> <span class="token comment">// åˆ›å»ºé˜Ÿåˆ—</span></pre></td></tr><tr><td data-num="20"></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">&amp;</span>Queue<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		elements<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> defaultCap<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>		limit<span class="token punctuation">:</span>    limit<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>q <span class="token operator">*</span>Queue<span class="token punctuation">)</span> <span class="token function">Add</span><span class="token punctuation">(</span>e <span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span> <span class="token comment">// é˜Ÿåˆ—æ·»åŠ å…ƒç´ </span></pre></td></tr><tr><td data-num="27"></td><td><pre>	<span class="token keyword">if</span> q<span class="token punctuation">.</span>limit <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token function">len</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>elements<span class="token punctuation">)</span> <span class="token operator">></span> q<span class="token punctuation">.</span>limit <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>		<span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"è¶…å‡ºèŒƒå›´"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>	q<span class="token punctuation">.</span>locker<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>	<span class="token keyword">defer</span> q<span class="token punctuation">.</span>locker<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>	q<span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>elements<span class="token punctuation">,</span> e<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">nil</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre></pre></td></tr><tr><td data-num="36"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>q <span class="token operator">*</span>Queue<span class="token punctuation">)</span> <span class="token function">Take</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// å–å‡ºé˜Ÿåˆ—å…ƒç´ </span></pre></td></tr><tr><td data-num="37"></td><td><pre>	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>elements<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">nil</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"å†…å®¹ä¸ºç©º"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>	e <span class="token operator">:=</span> q<span class="token punctuation">.</span>elements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="41"></td><td><pre>	q<span class="token punctuation">.</span>elements <span class="token operator">=</span> q<span class="token punctuation">.</span>elements<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="42"></td><td><pre>	<span class="token keyword">return</span> e<span class="token punctuation">,</span> <span class="token boolean">nil</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre></pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>q <span class="token operator">*</span>Queue<span class="token punctuation">)</span> <span class="token function">Len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">&#123;</span> <span class="token comment">// æŸ¥çœ‹é˜Ÿåˆ—å…ƒç´ é•¿åº¦</span></pre></td></tr><tr><td data-num="46"></td><td><pre>	<span class="token keyword">return</span> <span class="token function">len</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>elements<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>main.go</code></p><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"liangc.com/demo/demo9/pool"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token string">"sync"</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre>	<span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup</pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>	pool <span class="token operator">:=</span> pool<span class="token punctuation">.</span><span class="token function">NewPool</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre>	createTask <span class="token operator">:=</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>		<span class="token keyword">return</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">interface</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>			<span class="token keyword">return</span> i</pre></td></tr><tr><td data-num="17"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		pool<span class="token punctuation">.</span><span class="token function">AddTask</span><span class="token punctuation">(</span><span class="token function">createTask</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	pool<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="24"></td><td><pre>	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>		<span class="token keyword">for</span> result <span class="token operator">:=</span> <span class="token keyword">range</span> pool<span class="token punctuation">.</span>Results <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>			fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="27"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>		wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="29"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>	pool<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="33"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="å¤šçº¿ç¨‹å®ç°ç»Ÿè®¡è¡Œæ•°"><a class="anchor" href="#å¤šçº¿ç¨‹å®ç°ç»Ÿè®¡è¡Œæ•°">#</a> å¤šçº¿ç¨‹å®ç°ç»Ÿè®¡è¡Œæ•°</h2><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> pool</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"bufio"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token string">"os"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token string">"strings"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token string">"sync"</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">const</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	defaultCap <span class="token operator">=</span> <span class="token number">1024</span></pre></td></tr><tr><td data-num="13"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="14"></td><td><pre></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token keyword">type</span> Queue <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>	elements <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	locker   sync<span class="token punctuation">.</span>Mutex</pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token keyword">func</span> <span class="token function">NewQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>Queue <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">&amp;</span>Queue<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>		elements<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> defaultCap<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="23"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="25"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>q <span class="token operator">*</span>Queue<span class="token punctuation">)</span> <span class="token function">ReadLine</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	i <span class="token operator">:=</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="27"></td><td><pre>	file<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre>	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>		<span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"æ–‡ä»¶ä¸å­˜åœ¨"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>	scanner <span class="token operator">:=</span> bufio<span class="token punctuation">.</span><span class="token function">NewScanner</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="32"></td><td><pre>	<span class="token keyword">for</span> scanner<span class="token punctuation">.</span><span class="token function">Scan</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>		s <span class="token operator">:=</span> scanner<span class="token punctuation">.</span><span class="token function">Text</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="34"></td><td><pre>		s <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">TrimSpace</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>		<span class="token keyword">if</span> s <span class="token operator">==</span> <span class="token string">""</span> <span class="token operator">||</span> strings<span class="token punctuation">.</span><span class="token function">HasPrefix</span><span class="token punctuation">(</span>s<span class="token punctuation">,</span> <span class="token string">"//"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="36"></td><td><pre>			<span class="token keyword">continue</span></pre></td></tr><tr><td data-num="37"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>		i<span class="token operator">++</span></pre></td></tr><tr><td data-num="39"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>	q<span class="token punctuation">.</span>locker<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre>	<span class="token keyword">defer</span> q<span class="token punctuation">.</span>locker<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="42"></td><td><pre>	q<span class="token punctuation">.</span>elements <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>elements<span class="token punctuation">,</span> i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre>	<span class="token keyword">return</span> <span class="token boolean">nil</span></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="45"></td><td><pre></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>q <span class="token operator">*</span>Queue<span class="token punctuation">)</span> <span class="token function">Take</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>	<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>q<span class="token punctuation">.</span>elements<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>		<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">"å†…å®¹ä¸ºç©º"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>	e <span class="token operator">:=</span> q<span class="token punctuation">.</span>elements<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="51"></td><td><pre>	q<span class="token punctuation">.</span>elements <span class="token operator">=</span> q<span class="token punctuation">.</span>elements<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="52"></td><td><pre>	<span class="token keyword">return</span> e<span class="token punctuation">,</span> <span class="token boolean">nil</span></pre></td></tr><tr><td data-num="53"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> pool</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"math"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"sync"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token keyword">type</span> Pool <span class="token keyword">struct</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>	worker  <span class="token builtin">int</span></pre></td></tr><tr><td data-num="10"></td><td><pre>	tasks   <span class="token operator">*</span>Queue</pre></td></tr><tr><td data-num="11"></td><td><pre>	Results <span class="token keyword">chan</span> <span class="token builtin">int</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	events  <span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>	wg      sync<span class="token punctuation">.</span>WaitGroup</pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre></pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token keyword">func</span> <span class="token function">NewPool</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token operator">*</span>Pool <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token keyword">return</span> <span class="token operator">&amp;</span>Pool<span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>		worker<span class="token punctuation">:</span>  i<span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>		tasks<span class="token punctuation">:</span>   <span class="token function">NewQueue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		Results<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> i<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>		events<span class="token punctuation">:</span>  <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span> math<span class="token punctuation">.</span>MaxInt32<span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="23"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="24"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Pool<span class="token punctuation">)</span> <span class="token function">AddTask</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre>	err <span class="token operator">:=</span> p<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">ReadLine</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="26"></td><td><pre>	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="27"></td><td><pre>		<span class="token keyword">return</span></pre></td></tr><tr><td data-num="28"></td><td><pre>	<span class="token punctuation">&#125;</span> <span class="token comment">// å‘ä»»åŠ¡æ± æ·»åŠ ä»»åŠ¡</span></pre></td></tr><tr><td data-num="29"></td><td><pre>	p<span class="token punctuation">.</span>events <span class="token operator">&lt;-</span> <span class="token keyword">struct</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">// é€šçŸ¥æ‰§è¡Œè¿›ç¨‹</span></pre></td></tr><tr><td data-num="30"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre></pre></td></tr><tr><td data-num="32"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Pool<span class="token punctuation">)</span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>	<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> p<span class="token punctuation">.</span>worker<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>		p<span class="token punctuation">.</span>wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="35"></td><td><pre>		<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span>i <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span> <span class="token comment">// å¼€å§‹æ‰§è¡Œå¹¶å‘</span></pre></td></tr><tr><td data-num="36"></td><td><pre>			<span class="token keyword">for</span> <span class="token keyword">range</span> p<span class="token punctuation">.</span>events <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>				task<span class="token punctuation">,</span> err <span class="token operator">:=</span> p<span class="token punctuation">.</span>tasks<span class="token punctuation">.</span><span class="token function">Take</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="38"></td><td><pre>				<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>					<span class="token keyword">continue</span></pre></td></tr><tr><td data-num="40"></td><td><pre>				<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>				p<span class="token punctuation">.</span>Results <span class="token operator">&lt;-</span> task</pre></td></tr><tr><td data-num="42"></td><td><pre>			<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="43"></td><td><pre>			p<span class="token punctuation">.</span>wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="44"></td><td><pre>		<span class="token punctuation">&#125;</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="45"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="46"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="47"></td><td><pre><span class="token keyword">func</span> <span class="token punctuation">(</span>p <span class="token operator">*</span>Pool<span class="token punctuation">)</span> <span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="48"></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>events<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="49"></td><td><pre>	p<span class="token punctuation">.</span>wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="50"></td><td><pre>	<span class="token function">close</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>Results<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="51"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><figure class="highlight go"><figcaption data-lang="go"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">package</span> main</pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">import</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>	<span class="token string">"fmt"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>	<span class="token string">"io/fs"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>	<span class="token string">"liangc.com/object/object4/pool"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>	<span class="token string">"path/filepath"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>	<span class="token string">"sync"</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="10"></td><td><pre></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>	pool <span class="token operator">:=</span> pool<span class="token punctuation">.</span><span class="token function">NewPool</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="13"></td><td><pre></pre></td></tr><tr><td data-num="14"></td><td><pre>	<span class="token keyword">var</span> <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="15"></td><td><pre>		maxLine <span class="token builtin">int</span></pre></td></tr><tr><td data-num="16"></td><td><pre>		wg      sync<span class="token punctuation">.</span>WaitGroup</pre></td></tr><tr><td data-num="17"></td><td><pre>	<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="18"></td><td><pre>	file<span class="token punctuation">,</span> err <span class="token operator">:=</span> filepath<span class="token punctuation">.</span><span class="token function">Abs</span><span class="token punctuation">(</span><span class="token string">"H:\\Object\\GoObject"</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="19"></td><td><pre>	<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>		fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="21"></td><td><pre>	<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre>	filepath<span class="token punctuation">.</span><span class="token function">Walk</span><span class="token punctuation">(</span>file<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">,</span> info fs<span class="token punctuation">.</span>FileInfo<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>		<span class="token keyword">if</span> filepath<span class="token punctuation">.</span><span class="token function">Ext</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">".go"</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>info<span class="token punctuation">.</span><span class="token function">IsDir</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>			pool<span class="token punctuation">.</span><span class="token function">AddTask</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="25"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="26"></td><td><pre>		<span class="token keyword">return</span> <span class="token boolean">nil</span></pre></td></tr><tr><td data-num="27"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="28"></td><td><pre></pre></td></tr><tr><td data-num="29"></td><td><pre>	pool<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="30"></td><td><pre>	wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="31"></td><td><pre>	<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>		<span class="token keyword">for</span> result <span class="token operator">:=</span> <span class="token keyword">range</span> pool<span class="token punctuation">.</span>Results <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>			maxLine <span class="token operator">+=</span> result</pre></td></tr><tr><td data-num="34"></td><td><pre>		<span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>		wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="36"></td><td><pre>	<span class="token punctuation">&#125;</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="37"></td><td><pre></pre></td></tr><tr><td data-num="38"></td><td><pre>	pool<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="39"></td><td><pre></pre></td></tr><tr><td data-num="40"></td><td><pre>	wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="41"></td><td><pre></pre></td></tr><tr><td data-num="42"></td><td><pre>	fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>maxLine<span class="token punctuation">)</span></pre></td></tr><tr><td data-num="43"></td><td><pre></pre></td></tr><tr><td data-num="44"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><div class="tags"><a href="/tags/Golang/" rel="tag"><i class="ic i-tag"></i> Golang</a> <a href="/tags/Golang%E5%85%A5%E9%97%A8%E8%BF%9B%E9%98%B6/" rel="tag"><i class="ic i-tag"></i> Golangå…¥é—¨è¿›é˜¶</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">æ›´æ–°äº</span> <time title="ä¿®æ”¹æ—¶é—´ï¼š2023-12-26 19:44:05" itemprop="dateModified" datetime="2023-12-26T19:44:05+08:00">2023-12-26</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> èµèµ</button><p>è¯·æˆ‘å–[èŒ¶]~(ï¿£â–½ï¿£)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="ä½™æ˜Ÿé…’ å¾®ä¿¡æ”¯ä»˜"><p>å¾®ä¿¡æ”¯ä»˜</p></div><div><img data-src="/images/alipay.png" alt="ä½™æ˜Ÿé…’ æ”¯ä»˜å®"><p>æ”¯ä»˜å®</p></div><div><img data-src="/images/paypal.png" alt="ä½™æ˜Ÿé…’ è´å®"><p>è´å®</p></div></div></div><div id="copyright"><ul><li class="author"><strong>æœ¬æ–‡ä½œè€…ï¼š </strong>ä½™æ˜Ÿé…’ <i class="ic i-at"><em>@</em></i>ä½™æ˜Ÿé…’</li><li class="link"><strong>æœ¬æ–‡é“¾æ¥ï¼š</strong> <a href="http://example.com/Program/golang/%E8%BF%9B%E9%98%B6/%E5%B9%B6%E5%8F%91/" title="å¹¶å‘">http://example.com/Program/golang/è¿›é˜¶/å¹¶å‘/</a></li><li class="license"><strong>ç‰ˆæƒå£°æ˜ï¼š </strong>æœ¬ç«™æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/Program/golang/%E8%BF%9B%E9%98%B6/web%E5%BC%80%E5%8F%91/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipetv6p75j20zk0m8x6p.jpg" title="webå¼€å‘"><span class="type">ä¸Šä¸€ç¯‡</span> <span class="category"><i class="ic i-flag"></i> è¿›é˜¶</span><h3>webå¼€å‘</h3></a></div><div class="item right"><a href="/APT/web%E6%B8%97%E9%80%8F/CSRF/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva1.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1gipetv6p75j20zk0m8x6p.jpg" title="CSRF"><span class="type">ä¸‹ä¸€ç¯‡</span> <span class="category"><i class="ic i-flag"></i> webæ¸—é€</span><h3>CSRF</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="æ–‡ç« ç›®å½•"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E5%9F%BA%E7%A1%80"><span class="toc-number">1.</span> <span class="toc-text">å¹¶å‘åŸºç¡€</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%BA%E5%BA%8F-%E5%B9%B6%E5%8F%91%E4%B8%8E%E5%B9%B6%E8%A1%8C"><span class="toc-number">1.1.</span> <span class="toc-text">é¡ºåºã€å¹¶å‘ä¸å¹¶è¡Œ</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BE%8B%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">ä¾‹ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%8B%E7%A8%8B%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="toc-number">2.1.</span> <span class="toc-text">ä¾‹ç¨‹çš„åˆ›å»º</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AD%E5%8C%85%E9%99%B7%E9%98%B1"><span class="toc-number">2.1.1.</span> <span class="toc-text">é—­åŒ…é™·é˜±</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%AD%89%E5%BE%85%E4%BE%8B%E7%A8%8B"><span class="toc-number">2.2.</span> <span class="toc-text">ç­‰å¾…ä¾‹ç¨‹</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#waitgroup"><span class="toc-number">2.2.1.</span> <span class="toc-text">WaitGroup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%A1%E9%81%93%E5%AE%9E%E7%8E%B0%E7%AD%89%E5%BE%85"><span class="toc-number">2.2.2.</span> <span class="toc-text">ç®¡é“å®ç°ç­‰å¾…</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BE%8B%E7%A8%8B%E9%97%B4%E9%80%9A%E4%BF%A1"><span class="toc-number">2.3.</span> <span class="toc-text">ä¾‹ç¨‹é—´é€šä¿¡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mutext%E4%BA%92%E6%96%A5%E9%94%81%E5%AE%9E%E7%8E%B0%E5%90%8C%E6%AD%A5"><span class="toc-number">2.3.1.</span> <span class="toc-text">Mutext äº’æ–¥é”å®ç°åŒæ­¥</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E5%AD%90%E6%93%8D%E4%BD%9C"><span class="toc-number">2.3.2.</span> <span class="toc-text">åŸå­æ“ä½œ</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A2%9E%E5%87%8F%E6%93%8D%E4%BD%9C"><span class="toc-number">2.3.2.1.</span> <span class="toc-text">å¢å‡æ“ä½œ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%BD%E5%85%A5%E6%93%8D%E4%BD%9C"><span class="toc-number">2.3.2.2.</span> <span class="toc-text">è½½å…¥æ“ä½œ</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AF%94%E8%BE%83%E5%B9%B6%E4%BA%A4%E6%8D%A2-cas"><span class="toc-number">2.3.2.3.</span> <span class="toc-text">æ¯”è¾ƒå¹¶äº¤æ¢ cas</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BA%A4%E6%8D%A2"><span class="toc-number">2.3.2.4.</span> <span class="toc-text">äº¤æ¢</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%98%E5%82%A8"><span class="toc-number">2.3.2.5.</span> <span class="toc-text">å­˜å‚¨</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#channel"><span class="toc-number">3.</span> <span class="toc-text">channel</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#channel%E5%88%9B%E5%BB%BA"><span class="toc-number">3.1.</span> <span class="toc-text">channel åˆ›å»º</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E7%BC%93%E5%86%B2%E9%80%9A%E9%81%93"><span class="toc-number">3.1.1.</span> <span class="toc-text">æ— ç¼“å†²é€šé“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BC%93%E5%86%B2%E9%80%9A%E9%81%93"><span class="toc-number">3.1.2.</span> <span class="toc-text">ç¼“å†²é€šé“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%BB%E5%86%99%E7%AE%A1%E9%81%93"><span class="toc-number">3.1.3.</span> <span class="toc-text">è¯»å†™ç®¡é“</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#channel%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-number">3.2.</span> <span class="toc-text">channel è¿ç®—ç¬¦</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E9%81%93%E7%9A%84%E5%8F%91%E9%80%81%E5%92%8C%E6%8E%A5%E6%94%B6%E7%89%B9%E6%80%A7"><span class="toc-number">3.3.</span> <span class="toc-text">é€šé“çš„å‘é€å’Œæ¥æ”¶ç‰¹æ€§</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#channel%E9%81%8D%E5%8E%86"><span class="toc-number">3.4.</span> <span class="toc-text">channel éå†</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#iffor"><span class="toc-number">3.4.1.</span> <span class="toc-text">if+for</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#range"><span class="toc-number">3.4.2.</span> <span class="toc-text">range</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#selectswitch"><span class="toc-number">4.</span> <span class="toc-text">select&amp;switch</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#time"><span class="toc-number">5.</span> <span class="toc-text">time</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#timeafter"><span class="toc-number">5.1.</span> <span class="toc-text">time.After()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#timetick"><span class="toc-number">5.2.</span> <span class="toc-text">time.Tick()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#timeticker"><span class="toc-number">5.3.</span> <span class="toc-text">time.Ticker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#timetimer"><span class="toc-number">5.4.</span> <span class="toc-text">time.Timer</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E6%B1%A0"><span class="toc-number">6.</span> <span class="toc-text">å¯¹è±¡æ± </span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#syncpool"><span class="toc-number">6.1.</span> <span class="toc-text">sync.Pool</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">7.</span> <span class="toc-text">æ¡ˆä¾‹</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8waitgroup%E5%AE%9E%E7%8E%B0%E7%BB%9F%E8%AE%A1%E8%A1%8C%E6%95%B0"><span class="toc-number">7.1.</span> <span class="toc-text">ä½¿ç”¨ WaitGroup å®ç°ç»Ÿè®¡è¡Œæ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E7%AE%A1%E9%81%93%E5%AE%9E%E7%8E%B0%E7%BB%9F%E8%AE%A1%E8%A1%8C%E6%95%B0"><span class="toc-number">7.2.</span> <span class="toc-text">ä½¿ç”¨ç®¡é“å®ç°ç»Ÿè®¡è¡Œæ•°</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="toc-number">7.3.</span> <span class="toc-text">å®ç°å®šæ—¶å™¨</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9%E8%B1%A1%E6%B1%A0-2"><span class="toc-number">7.4.</span> <span class="toc-text">å¯¹è±¡æ± </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%AE%9E%E7%8E%B0%E7%BB%9F%E8%AE%A1%E8%A1%8C%E6%95%B0"><span class="toc-number">7.5.</span> <span class="toc-text">å¤šçº¿ç¨‹å®ç°ç»Ÿè®¡è¡Œæ•°</span></a></li></ol></li></ol></div><div class="related panel pjax" data-title="ç³»åˆ—æ–‡ç« "><ul><li><a href="/Program/golang/%E8%BF%9B%E9%98%B6/%E6%8E%A5%E5%8F%A3%E4%B8%8E%E5%8F%8D%E5%B0%84/" rel="bookmark" title="æ¥å£ä¸åå°„">æ¥å£ä¸åå°„</a></li><li><a href="/Program/golang/%E8%BF%9B%E9%98%B6/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/" rel="bookmark" title="æ–‡ä»¶æ“ä½œ">æ–‡ä»¶æ“ä½œ</a></li><li><a href="/Program/golang/%E8%BF%9B%E9%98%B6/IO%E6%B5%81/" rel="bookmark" title="IOæµ">IOæµ</a></li><li><a href="/Program/golang/%E8%BF%9B%E9%98%B6/web%E5%BC%80%E5%8F%91/" rel="bookmark" title="webå¼€å‘">webå¼€å‘</a></li><li class="active"><a href="/Program/golang/%E8%BF%9B%E9%98%B6/%E5%B9%B6%E5%8F%91/" rel="bookmark" title="å¹¶å‘">å¹¶å‘</a></li><li><a href="/Program/golang/%E8%BF%9B%E9%98%B6/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" rel="bookmark" title="ç½‘ç»œç¼–ç¨‹">ç½‘ç»œç¼–ç¨‹</a></li></ul></div><div class="overview panel" data-title="ç«™ç‚¹æ¦‚è§ˆ"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="ä½™æ˜Ÿé…’" data-src="/images/avatar.jpg"><p class="name" itemprop="name">ä½™æ˜Ÿé…’</p><div class="description" itemprop="description">æ¬¢è¿å‚è§‚æˆ‘çš„ç¬”è®°ç©ºé—´ ~ è¿™é‡Œä¸»è¦ä¼šè®°å½•ä¸€äº›å®‰å…¨ç›¸å…³çš„å­¦ä¹ ç¬”è®° ğŸŒ¸</div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">190</span> <span class="name">æ–‡ç« </span></a></div><div class="item categories"><a href="/categories/"><span class="count">38</span> <span class="name">åˆ†ç±»</span></a></div><div class="item tags"><a href="/tags/"><span class="count">30</span> <span class="name">æ ‡ç­¾</span></a></div></nav><div class="social"></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>é¦–é¡µ</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>å…³äº</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>æ–‡ç« </a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>å½’æ¡£</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>åˆ†ç±»</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>æ ‡ç­¾</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/Program/golang/%E8%BF%9B%E9%98%B6/web%E5%BC%80%E5%8F%91/" rel="prev" title="ä¸Šä¸€ç¯‡"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/APT/web%E6%B8%97%E9%80%8F/CSRF/" rel="next" title="ä¸‹ä¸€ç¯‡"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>éšæœºæ–‡ç« </h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/Network/" title="åˆ†ç±»äº ç½‘ç»œ">ç½‘ç»œ</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/" title="åˆ†ç±»äº ç½‘ç»œåŸºç¡€">ç½‘ç»œåŸºç¡€</a></div><span><a href="/Network/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/HCIA/%E4%BB%A5%E5%A4%AA%E7%BD%91%E4%BA%A4%E6%8D%A2%E5%9F%BA%E7%A1%80/" title="ä»¥å¤ªç½‘äº¤æ¢åŸºç¡€">ä»¥å¤ªç½‘äº¤æ¢åŸºç¡€</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/APT/" title="åˆ†ç±»äº æ¸—é€æµ‹è¯•">æ¸—é€æµ‹è¯•</a> <i class="ic i-angle-right"></i> <a href="/categories/APT/%E9%9D%B6%E5%9C%BA/" title="åˆ†ç±»äº é¶åœº">é¶åœº</a></div><span><a href="/APT/%E9%9D%B6%E5%9C%BAwp/%E9%9D%B6%E5%9C%BA/vulnhub/Doubletrouble-1/" title="Doubletrouble-1">Doubletrouble-1</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Program/" title="åˆ†ç±»äº ç¼–ç¨‹">ç¼–ç¨‹</a> <i class="ic i-angle-right"></i> <a href="/categories/Program/Golang/" title="åˆ†ç±»äº Golang">Golang</a> <i class="ic i-angle-right"></i> <a href="/categories/Program/Golang/%E5%9F%BA%E7%A1%80/" title="åˆ†ç±»äº åŸºç¡€">åŸºç¡€</a></div><span><a href="/Program/golang/%E5%85%A5%E9%97%A8/%E7%BB%93%E6%9E%84%E4%BD%93/" title="ç»“æ„ä½“">ç»“æ„ä½“</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Network/" title="åˆ†ç±»äº ç½‘ç»œ">ç½‘ç»œ</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/" title="åˆ†ç±»äº æ·±ä¿¡æœè®¾å¤‡">æ·±ä¿¡æœè®¾å¤‡</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/AC/" title="åˆ†ç±»äº AC">AC</a></div><span><a href="/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/%E6%B7%B1%E4%BF%A1%E6%9C%8D/AC/%E8%AE%A4%E8%AF%86AC/" title="è®¤è¯†AC">è®¤è¯†AC</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/" title="åˆ†ç±»äº ä»£ç å®¡è®¡">ä»£ç å®¡è®¡</a> <i class="ic i-angle-right"></i> <a href="/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80/" title="åˆ†ç±»äº Javaå®‰å…¨åŸºç¡€">Javaå®‰å…¨åŸºç¡€</a></div><span><a href="/APT/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/Java%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/%E5%AE%A1%E8%AE%A1%E5%9F%BA%E7%A1%80/%E7%B1%BB%E5%8A%A8%E6%80%81%E5%8A%A0%E8%BD%BD/" title="ç±»åŠ¨æ€åŠ è½½">ç±»åŠ¨æ€åŠ è½½</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Network/" title="åˆ†ç±»äº ç½‘ç»œ">ç½‘ç»œ</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/" title="åˆ†ç±»äº æ·±ä¿¡æœè®¾å¤‡">æ·±ä¿¡æœè®¾å¤‡</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/%E5%AE%9E%E9%AA%8C/" title="åˆ†ç±»äº å®éªŒ">å®éªŒ</a></div><span><a href="/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/%E5%AE%9E%E9%AA%8C/VPN/%E7%AD%96%E7%95%A5%E7%BB%84%E7%AE%A1%E7%90%86/" title="ç­–ç•¥ç»„ç®¡ç†">ç­–ç•¥ç»„ç®¡ç†</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Network/" title="åˆ†ç±»äº ç½‘ç»œ">ç½‘ç»œ</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/" title="åˆ†ç±»äº æ·±ä¿¡æœè®¾å¤‡">æ·±ä¿¡æœè®¾å¤‡</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/AF/" title="åˆ†ç±»äº AF">AF</a></div><span><a href="/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/%E6%B7%B1%E4%BF%A1%E6%9C%8D/AF/AF%E9%83%A8%E7%BD%B2/" title="AFéƒ¨ç½²">AFéƒ¨ç½²</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Network/" title="åˆ†ç±»äº ç½‘ç»œ">ç½‘ç»œ</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/" title="åˆ†ç±»äº æ·±ä¿¡æœè®¾å¤‡">æ·±ä¿¡æœè®¾å¤‡</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/%E5%AE%9E%E9%AA%8C/" title="åˆ†ç±»äº å®éªŒ">å®éªŒ</a></div><span><a href="/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/%E9%98%B6%E6%AE%B5%E6%B5%8B%E8%AF%95/AC/" title="AC">AC</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Network/" title="åˆ†ç±»äº ç½‘ç»œ">ç½‘ç»œ</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/" title="åˆ†ç±»äº æ·±ä¿¡æœè®¾å¤‡">æ·±ä¿¡æœè®¾å¤‡</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/AC/" title="åˆ†ç±»äº AC">AC</a></div><span><a href="/Network/%E6%B7%B1%E4%BF%A1%E6%9C%8D%E8%AE%BE%E5%A4%87/%E6%B7%B1%E4%BF%A1%E6%9C%8D/AC/%E7%BB%88%E7%AB%AF%E6%A3%80%E6%9F%A5/" title="ç»ˆç«¯æ£€æŸ¥">ç»ˆç«¯æ£€æŸ¥</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/Network/" title="åˆ†ç±»äº ç½‘ç»œ">ç½‘ç»œ</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/" title="åˆ†ç±»äº ç½‘ç»œåŸºç¡€">ç½‘ç»œåŸºç¡€</a> <i class="ic i-angle-right"></i> <a href="/categories/Network/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E5%AE%9E%E9%AA%8C/" title="åˆ†ç±»äº å®éªŒ">å®éªŒ</a></div><span><a href="/Network/%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80/%E9%98%B6%E6%AE%B5%E6%B5%8B%E8%AF%95/%E5%AE%9E%E9%AA%8C/" title="å®éªŒ">å®éªŒ</a></span></li></ul></div><div><h2>æœ€æ–°è¯„è®º</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 â€“ <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">ä½™æ˜Ÿé…’ @ ä½™æ˜Ÿé…’</span></div><div class="powered-by">åŸºäº <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"Program/golang/è¿›é˜¶/å¹¶å‘/",favicon:{show:"ï¼ˆâ—Â´3ï½€â—ï¼‰ã‚„ã‚Œã‚„ã‚Œã ãœ",hide:"(Â´Ğ”ï½€)å¤§å¤‰ã ï¼"},search:{placeholder:"æ–‡ç« æœç´¢",empty:"å…³äº ã€Œ ${query} ã€ï¼Œä»€ä¹ˆä¹Ÿæ²¡æœåˆ°",stats:"${time} ms å†…æ‰¾åˆ° ${hits} æ¡ç»“æœ"},valine:!0,fancybox:!0,copyright:'å¤åˆ¶æˆåŠŸï¼Œè½¬è½½è¯·éµå®ˆ <i class="ic i-creative-commons"></i>BY-NC-SA åè®®ã€‚',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->